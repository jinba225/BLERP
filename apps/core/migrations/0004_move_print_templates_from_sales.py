# Generated by Django 4.2.7 on 2025-11-13 13:42
# Modified to rename tables from sales_ to core_

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('core', '0003_notification'),
        ('sales', '0011_defaulttemplatemapping_alter_printtemplate_options_and_more'),
    ]

    operations = [
        migrations.SeparateDatabaseAndState(
            state_operations=[
                # State: å‘Šè¯‰ Django è¿™äº›æ¨¡å‹ç°åœ¨åœ¨ core app ä¸­
                migrations.CreateModel(
                    name='PrintTemplate',
                    fields=[
                        ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                        ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='åˆ›å»ºæ—¶é—´')),
                        ('updated_at', models.DateTimeField(auto_now=True, verbose_name='æ›´æ–°æ—¶é—´')),
                        ('is_deleted', models.BooleanField(default=False, verbose_name='æ˜¯å¦åˆ é™¤')),
                        ('deleted_at', models.DateTimeField(blank=True, null=True, verbose_name='åˆ é™¤æ—¶é—´')),
                        ('name', models.CharField(max_length=100, verbose_name='æ¨¡æ¿åç§°')),
                        ('template_category', models.CharField(choices=[('sales', 'ğŸ“Š é”€å”®ç±»'), ('purchase', 'ğŸ›’ é‡‡è´­ç±»'), ('inventory', 'ğŸ“¦ åº“å­˜ç±»'), ('finance', 'ğŸ’° è´¢åŠ¡ç±»'), ('other', 'ğŸ“‹ å…¶ä»–ç±»')], db_index=True, default='sales', help_text='æ¨¡æ¿æ‰€å±çš„å¤§ç±»ï¼ŒåŒç±»åˆ«çš„æ¨¡æ¿å¯ä»¥å…±äº«ä½¿ç”¨', max_length=20, verbose_name='æ¨¡æ¿ç±»åˆ«')),
                        ('suitable_for', models.JSONField(blank=True, default=list, help_text='JSONæ•°ç»„æ ¼å¼ï¼Œä¾‹å¦‚ï¼š["quote", "sales_order"]ã€‚ç”¨äºåœ¨æ‰“å°æ—¶ä¼˜å…ˆæ˜¾ç¤ºæ›´ç›¸å…³çš„æ¨¡æ¿', verbose_name='é€‚ç”¨å•æ®ç±»å‹')),
                        ('is_active', models.BooleanField(default=True, verbose_name='æ˜¯å¦å¯ç”¨')),
                        ('company_name', models.CharField(default='BetterLaser æ¿€å…‰ç§‘æŠ€æœ‰é™å…¬å¸', max_length=200, verbose_name='å…¬å¸åç§°')),
                        ('company_address', models.CharField(blank=True, max_length=500, verbose_name='å…¬å¸åœ°å€')),
                        ('company_phone', models.CharField(blank=True, max_length=50, verbose_name='è”ç³»ç”µè¯')),
                        ('company_email', models.CharField(blank=True, max_length=100, verbose_name='ç”µå­é‚®ç®±')),
                        ('company_logo', models.ImageField(blank=True, null=True, upload_to='print_templates/logos/', verbose_name='å…¬å¸Logo')),
                        ('layout_config', models.JSONField(default=dict, verbose_name='å¸ƒå±€é…ç½®')),
                        ('custom_css', models.TextField(blank=True, help_text='è‡ªå®šä¹‰CSSæ ·å¼', verbose_name='è‡ªå®šä¹‰æ ·å¼')),
                        ('notes', models.TextField(blank=True, verbose_name='å¤‡æ³¨')),
                        ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='åˆ›å»ºäºº')),
                        ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL, verbose_name='åˆ é™¤äºº')),
                        ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL, verbose_name='æ›´æ–°äºº')),
                    ],
                    options={
                        'verbose_name': 'æ‰“å°æ¨¡æ¿',
                        'verbose_name_plural': 'æ‰“å°æ¨¡æ¿',
                        'db_table': 'core_print_template',
                        'ordering': ['template_category', 'name'],
                    },
                ),
                migrations.CreateModel(
                    name='DefaultTemplateMapping',
                    fields=[
                        ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                        ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='åˆ›å»ºæ—¶é—´')),
                        ('updated_at', models.DateTimeField(auto_now=True, verbose_name='æ›´æ–°æ—¶é—´')),
                        ('is_deleted', models.BooleanField(default=False, verbose_name='æ˜¯å¦åˆ é™¤')),
                        ('deleted_at', models.DateTimeField(blank=True, null=True, verbose_name='åˆ é™¤æ—¶é—´')),
                        ('document_type', models.CharField(choices=[('quote_domestic', 'æŠ¥ä»·å•-å›½å†…'), ('quote_overseas', 'æŠ¥ä»·å•-æµ·å¤–'), ('sales_order', 'é”€å”®è®¢å•'), ('delivery', 'å‘è´§å•'), ('sales_return', 'é”€å”®é€€è´§'), ('purchase_order', 'é‡‡è´­è®¢å•'), ('purchase_receipt', 'é‡‡è´­å…¥åº“'), ('purchase_return', 'é‡‡è´­é€€è´§'), ('stock_in', 'å…¥åº“å•'), ('stock_out', 'å‡ºåº“å•'), ('stock_transfer', 'è°ƒæ‹¨å•'), ('stock_check', 'ç›˜ç‚¹å•'), ('invoice', 'å‘ç¥¨'), ('payment', 'ä»˜æ¬¾å•'), ('receipt', 'æ”¶æ¬¾å•')], db_index=True, help_text='ä¸ºè¯¥å•æ®ç±»å‹è®¾ç½®é»˜è®¤æ‰“å°æ¨¡æ¿', max_length=50, unique=True, verbose_name='å•æ®ç±»å‹')),
                        ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='åˆ›å»ºäºº')),
                        ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL, verbose_name='åˆ é™¤äºº')),
                        ('template', models.ForeignKey(blank=True, help_text='è¯¥å•æ®ç±»å‹çš„é»˜è®¤æ¨¡æ¿ï¼Œæ‰“å°æ—¶è‡ªåŠ¨é€‰ä¸­', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='default_for_documents', to='core.printtemplate', verbose_name='é»˜è®¤æ¨¡æ¿')),
                        ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL, verbose_name='æ›´æ–°äºº')),
                    ],
                    options={
                        'verbose_name': 'é»˜è®¤æ¨¡æ¿é…ç½®',
                        'verbose_name_plural': 'é»˜è®¤æ¨¡æ¿é…ç½®',
                        'db_table': 'core_default_template_mapping',
                        'ordering': ['document_type'],
                    },
                ),
                migrations.AddIndex(
                    model_name='printtemplate',
                    index=models.Index(fields=['template_category', 'is_active'], name='core_print__templat_e92d33_idx'),
                ),
            ],
            database_operations=[
                # Database: é‡å‘½åæ•°æ®åº“è¡¨
                migrations.RunSQL(
                    sql=[
                        # é‡å‘½å PrintTemplate è¡¨
                        "ALTER TABLE sales_print_template RENAME TO core_print_template;",
                        # é‡å‘½å DefaultTemplateMapping è¡¨
                        "ALTER TABLE sales_default_template_mapping RENAME TO core_default_template_mapping;",
                        # åˆ é™¤æ—§çš„ç´¢å¼•(å¦‚æœå­˜åœ¨)
                        "DROP INDEX IF EXISTS sales_print__templat_e92d33_idx;",
                        # åˆ›å»ºæ–°çš„ç´¢å¼•
                        "CREATE INDEX core_print__templat_e92d33_idx ON core_print_template (template_category, is_active);",
                    ],
                    reverse_sql=[
                        # å›æ»šï¼šé‡å‘½åå› sales è¡¨
                        "ALTER TABLE core_print_template RENAME TO sales_print_template;",
                        "ALTER TABLE core_default_template_mapping RENAME TO sales_default_template_mapping;",
                        # æ¢å¤æ—§çš„ç´¢å¼•
                        "DROP INDEX IF EXISTS core_print__templat_e92d33_idx;",
                        "CREATE INDEX sales_print__templat_e92d33_idx ON sales_print_template (template_category, is_active);",
                    ],
                ),
            ],
        ),
    ]
