{% extends "ecomm_sync/base.html" %}
{% load static %}

{% block page_title %}电商数据同步仪表盘{% endblock %}

{% block content %}
<div class="container">
    <!-- 统计卡片 -->
    <div class="card">
        <div class="card-header">
            <h1 class="card-title">同步概览</h1>
        </div>
        
        <div class="stats-grid">
            <!-- 总产品数 -->
            <div class="stat-card">
                <div class="stat-value">{{ stats.total_products }}</div>
                <div class="stat-label">总产品数</div>
            </div>
            
            <!-- 已同步 -->
            <div class="stat-card">
                <div class="stat-value">{{ stats.synced_products }}</div>
                <div class="stat-label">已同步产品</div>
            </div>
            
            <!-- 待同步 -->
            <div class="stat-card">
                <div class="stat-value">{{ stats.pending_products }}</div>
                <div class="stat-label">待同步产品</div>
            </div>
        </div>
    </div>
    
    <!-- 同步状态 -->
    <div class="card">
        <div class="card-header">
            <h1 class="card-title">同步状态</h1>
        </div>
        
        <div class="sync-status">
            <div class="status-card status-{{ sync_status.status }}">
                <div class="status-icon">
                    {% if sync_status.status == '正常运行' %}
                        <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    {% elif sync_status.status == '空闲' %}
                        <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    {% else %}
                        <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                    {% endif %}
                </div>
                <div class="status-info">
                    <strong>{{ sync_status.status }}</strong>
                </div>
                <div class="status-time">
                    {% if sync_status.last_sync %}
                        最后同步: {{ sync_status.last_sync|date:"Y-m-d H:i" }}
                    {% else %}
                        暂无同步记录
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- 最近同步 -->
    <div class="card">
        <div class="card-header">
            <h1 class="card-title">最近同步</h1>
        </div>
        
        <div class="sync-list">
            <table class="table">
                <thead>
                    <tr>
                        <th>时间</th>
                        <th>平台</th>
                        <th>类型</th>
                        <th>状态</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in recent_syncs %}
                    <tr>
                        <td>
                            {{ log.created_at|date:"Y-m-d H:i" }}
                        </td>
                        <td>
                            {{ log.platform }}
                        </td>
                        <td>
                            {{ log.log_type }}
                        </td>
                        <td>
                            <span class="status status-{{ log.status }}">
                                {{ log.get_log_type_display }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
</div>

<style>
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
    }
    
    .stat-card {
        background: var(--bg-color);
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0.08);
    }
    
    .stat-value {
        font-size: 32px;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 8px;
    }
    
    .stat-label {
        color: var(--text-light);
        font-size: 14px;
    }
    
    .sync-status {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 16px;
    }
    
    .status-card {
        padding: 24px;
        text-align: center;
    }
    
    .status-card.status-正常 {
        background: linear-gradient(135deg, #e8f5e8 0%, #d4e4d4 100%);
        color: white;
    }
    
    .status-card.status-空闲 {
        background: linear-gradient(135deg, #f8f9fa 0%, #dee2e6 100%);
        color: white;
    }
    
    .status-card .status-异常 {
        background: linear-gradient(135deg, #fee 0 0%, #e66b2 100%);
        color: white;
    }
    
    .status-icon {
        font-size: 48px;
        margin-bottom: 12px;
    }
    
    .status-info {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 8px;
    }
    
    .status-time {
        color: var(--text-light);
        font-size: 14px;
    }
    
    .sync-list {
        background: var(--bg-color);
        border-radius: 8px;
        padding: 24px;
        box-shadow: 0 2px 4px rgba(0, 0, 0.08);
    }
    
    .table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .table thead th {
        background-color: var(--bg-light);
        color: var(--text-light);
        font-weight: 600;
        text-align: left;
    }
    
    .table tbody tr {
        border-bottom: 1px solid #e5e7eb;
    }
    
    .table tbody tr:hover {
        background-color: var(--bg-light);
    }
    
    .status {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
    }
    
    .status.status-成功 {
        color: #10b981;
        background: #d1e7a9;
    }
    
    .status.失败 {
        color: #ef4444;
        background: #fee2e2;
    }
    
    .status.同步中 {
        color: #f59c0;
        background: #ffedd0;
    }
</style>
