{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ company_name }}{% endblock %}</title> <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%233b82f6' width='100' height='100' rx='15'/%3E%3Ctext x='50' y='70' text-anchor='middle' fill='white' font-size='50' font-weight='bold' font-family='sans-serif'%3EBL%3C/text%3E%3C/svg%3E"> <!-- ç«‹å³åº”ç”¨ä¸»é¢˜ï¼ˆé˜²æ­¢é—ªçƒï¼‰ -->
    <script>
        (function() {
            try {
                const validThemes = ['blue', 'yellow', 'red'];
                const defaultTheme = 'blue'; // è¿ç§»é€»è¾‘ï¼šå¦‚æœæ—§çš„ 'theme' é”®å­˜åœ¨ä¸”æœ‰æ•ˆï¼ˆä¸æ˜¯ Django admin çš„å€¼ï¼‰ï¼Œè¿ç§»åˆ° 'erp_theme'
                const oldTheme = localStorage.getItem('theme');
                if (oldTheme && validThemes.includes(oldTheme) && !localStorage.getItem('erp_theme')) {
                    localStorage.setItem('erp_theme', oldTheme);
                    // ä¸åˆ é™¤æ—§é”®ï¼Œè®© Django admin ç»§ç»­ä½¿ç”¨
                } // ä¼˜å…ˆä½¿ç”¨å†…å­˜ä¸­ä¿å­˜çš„ä¸»é¢˜ï¼ˆé˜²æ­¢è¢«è¦†ç›–ï¼‰
                let themeToApply = window.__validTheme; // å¦‚æœå†…å­˜ä¸­æ²¡æœ‰ï¼Œå†è¯»å– localStorageï¼ˆä½¿ç”¨ erp_theme é¿å…ä¸ Django admin å†²çªï¼‰
                if (!themeToApply) {
                    const savedTheme = localStorage.getItem('erp_theme');
                    themeToApply = (savedTheme && validThemes.includes(savedTheme)) ? savedTheme : defaultTheme;
                } // åªåœ¨ä¸»é¢˜æ— æ•ˆæ—¶æ‰å†™å…¥é»˜è®¤ä¸»é¢˜ï¼ˆä¸è¦†ç›–ç°æœ‰æœ‰æ•ˆä¸»é¢˜ï¼‰
                const currentSaved = localStorage.getItem('erp_theme');
                if (!currentSaved || !validThemes.includes(currentSaved)) {
                    localStorage.setItem('erp_theme', themeToApply);
                } document.documentElement.setAttribute('data-theme', themeToApply);
                window.__validTheme = themeToApply;
            } catch (e) {
                document.documentElement.setAttribute('data-theme', 'blue');
            }
        })();
    </script> <!-- Tailwind CSSï¼ˆç¼–è¯‘åçš„ç‰ˆæœ¬ï¼‰ -->
    <link rel="stylesheet" href="{% static 'css/output.css' %}"> <!-- ä¸»é¢˜è‰²æ ·å¼ -->
    <style>
        :root {
            --theme-50: 239, 246, 255;
            --theme-100: 219, 234, 254;
            --theme-200: 191, 219, 254;
            --theme-300: 147, 197, 253;
            --theme-400: 96, 165, 250;
            --theme-500: 59, 130, 246;
            --theme-600: 37, 99, 235;
            --theme-700: 29, 78, 216;
            --theme-800: 30, 64, 175;
            --theme-900: 30, 58, 138;
        } [data-theme="blue"] {
            --theme-50: 239, 246, 255;
            --theme-100: 219, 234, 254;
            --theme-200: 191, 219, 254;
            --theme-300: 147, 197, 253;
            --theme-400: 96, 165, 250;
            --theme-500: 59, 130, 246;
            --theme-600: 37, 99, 235;
            --theme-700: 29, 78, 216;
            --theme-800: 30, 64, 175;
            --theme-900: 30, 58, 138;
        } [data-theme="yellow"] {
            --theme-50: 254, 252, 232;
            --theme-100: 254, 249, 195;
            --theme-200: 254, 240, 138;
            --theme-300: 253, 224, 71;
            --theme-400: 250, 204, 21;
            --theme-500: 234, 179, 8;
            --theme-600: 202, 138, 4;
            --theme-700: 161, 98, 7;
            --theme-800: 133, 77, 14;
            --theme-900: 113, 63, 18;
        } [data-theme="red"] {
            --theme-50: 254, 242, 242;
            --theme-100: 254, 226, 226;
            --theme-200: 254, 202, 202;
            --theme-300: 252, 165, 165;
            --theme-400: 248, 113, 113;
            --theme-500: 239, 68, 68;
            --theme-600: 220, 38, 38;
            --theme-700: 185, 28, 28;
            --theme-800: 153, 27, 27;
            --theme-900: 127, 29, 29;
        } /* ä½¿ç”¨ä¸»é¢˜è‰²çš„ç±» - Background */
        .bg-theme-50 { background-color: rgb(var(--theme-50)); }
        .bg-theme-100 { background-color: rgb(var(--theme-100)); }
        .bg-theme-200 { background-color: rgb(var(--theme-200)); }
        .bg-theme-300 { background-color: rgb(var(--theme-300)); }
        .bg-theme-400 { background-color: rgb(var(--theme-400)); }
        .bg-theme-500 { background-color: rgb(var(--theme-500)); }
        .bg-theme-600 { background-color: rgb(var(--theme-600)); }
        .bg-theme-700 { background-color: rgb(var(--theme-700)); }
        .bg-theme-800 { background-color: rgb(var(--theme-800)); }
        .bg-theme-900 { background-color: rgb(var(--theme-900)); } /* Hover Background */
        .hover\:bg-theme-50:hover { background-color: rgb(var(--theme-50)); }
        .hover\:bg-theme-100:hover { background-color: rgb(var(--theme-100)); }
        .hover\:bg-theme-200:hover { background-color: rgb(var(--theme-200)); }
        .hover\:bg-theme-300:hover { background-color: rgb(var(--theme-300)); }
        .hover\:bg-theme-400:hover { background-color: rgb(var(--theme-400)); }
        .hover\:bg-theme-500:hover { background-color: rgb(var(--theme-500)); }
        .hover\:bg-theme-600:hover { background-color: rgb(var(--theme-600)); }
        .hover\:bg-theme-700:hover { background-color: rgb(var(--theme-700)); }
        .hover\:bg-theme-800:hover { background-color: rgb(var(--theme-800)); }
        .hover\:bg-theme-900:hover { background-color: rgb(var(--theme-900)); } /* Text Color */
        .text-theme-50 { color: rgb(var(--theme-50)); }
        .text-theme-100 { color: rgb(var(--theme-100)); }
        .text-theme-200 { color: rgb(var(--theme-200)); }
        .text-theme-300 { color: rgb(var(--theme-300)); }
        .text-theme-400 { color: rgb(var(--theme-400)); }
        .text-theme-500 { color: rgb(var(--theme-500)); }
        .text-theme-600 { color: rgb(var(--theme-600)); }
        .text-theme-700 { color: rgb(var(--theme-700)); }
        .text-theme-800 { color: rgb(var(--theme-800)); }
        .text-theme-900 { color: rgb(var(--theme-900)); } /* Hover Text */
        .hover\:text-theme-50:hover { color: rgb(var(--theme-50)); }
        .hover\:text-theme-100:hover { color: rgb(var(--theme-100)); }
        .hover\:text-theme-200:hover { color: rgb(var(--theme-200)); }
        .hover\:text-theme-300:hover { color: rgb(var(--theme-300)); }
        .hover\:text-theme-400:hover { color: rgb(var(--theme-400)); }
        .hover\:text-theme-500:hover { color: rgb(var(--theme-500)); }
        .hover\:text-theme-600:hover { color: rgb(var(--theme-600)); }
        .hover\:text-theme-700:hover { color: rgb(var(--theme-700)); }
        .hover\:text-theme-800:hover { color: rgb(var(--theme-800)); }
        .hover\:text-theme-900:hover { color: rgb(var(--theme-900)); } /* Border Color */
        .border-theme-50 { border-color: rgb(var(--theme-50)); }
        .border-theme-100 { border-color: rgb(var(--theme-100)); }
        .border-theme-200 { border-color: rgb(var(--theme-200)); }
        .border-theme-300 { border-color: rgb(var(--theme-300)); }
        .border-theme-400 { border-color: rgb(var(--theme-400)); }
        .border-theme-500 { border-color: rgb(var(--theme-500)); }
        .border-theme-600 { border-color: rgb(var(--theme-600)); }
        .border-theme-700 { border-color: rgb(var(--theme-700)); }
        .border-theme-800 { border-color: rgb(var(--theme-800)); }
        .border-theme-900 { border-color: rgb(var(--theme-900)); } /* Ring/Shadow */
        .ring-theme-50 { --tw-ring-color: rgb(var(--theme-50)); }
        .ring-theme-100 { --tw-ring-color: rgb(var(--theme-100)); }
        .ring-theme-200 { --tw-ring-color: rgb(var(--theme-200)); }
        .ring-theme-300 { --tw-ring-color: rgb(var(--theme-300)); }
        .ring-theme-400 { --tw-ring-color: rgb(var(--theme-400)); }
        .ring-theme-500 { --tw-ring-color: rgb(var(--theme-500)); }
        .ring-theme-600 { --tw-ring-color: rgb(var(--theme-600)); }
        .ring-theme-700 { --tw-ring-color: rgb(var(--theme-700)); }
        .ring-theme-800 { --tw-ring-color: rgb(var(--theme-800)); }
        .ring-theme-900 { --tw-ring-color: rgb(var(--theme-900)); } /* Focus Ring */
        .focus\:ring-theme-50:focus { --tw-ring-color: rgb(var(--theme-50)); }
        .focus\:ring-theme-100:focus { --tw-ring-color: rgb(var(--theme-100)); }
        .focus\:ring-theme-200:focus { --tw-ring-color: rgb(var(--theme-200)); }
        .focus\:ring-theme-300:focus { --tw-ring-color: rgb(var(--theme-300)); }
        .focus\:ring-theme-400:focus { --tw-ring-color: rgb(var(--theme-400)); }
        .focus\:ring-theme-500:focus { --tw-ring-color: rgb(var(--theme-500)); }
        .focus\:ring-theme-600:focus { --tw-ring-color: rgb(var(--theme-600)); }
        .focus\:ring-theme-700:focus { --tw-ring-color: rgb(var(--theme-700)); }
        .focus\:ring-theme-800:focus { --tw-ring-color: rgb(var(--theme-800)); }
        .focus\:ring-theme-900:focus { --tw-ring-color: rgb(var(--theme-900)); } /* Focus Border */
        .focus\:border-theme-50:focus { border-color: rgb(var(--theme-50)); }
        .focus\:border-theme-100:focus { border-color: rgb(var(--theme-100)); }
        .focus\:border-theme-200:focus { border-color: rgb(var(--theme-200)); }
        .focus\:border-theme-300:focus { border-color: rgb(var(--theme-300)); }
        .focus\:border-theme-400:focus { border-color: rgb(var(--theme-400)); }
        .focus\:border-theme-500:focus { border-color: rgb(var(--theme-500)); }
        .focus\:border-theme-600:focus { border-color: rgb(var(--theme-600)); }
        .focus\:border-theme-700:focus { border-color: rgb(var(--theme-700)); }
        .focus\:border-theme-800:focus { border-color: rgb(var(--theme-800)); }
        .focus\:border-theme-900:focus { border-color: rgb(var(--theme-900)); } /* åŠ¨æ€ä¸»é¢˜è‰²æŒ‰é’®æ ·å¼ */
        .btn-primary {
            background-color: rgb(var(--theme-600));
            color: white;
        }
        .btn-primary:hover {
            background-color: rgb(var(--theme-700));
        }
        .btn-primary:focus {
            --tw-ring-color: rgb(var(--theme-500));
        } .btn-secondary {
            background-color: rgb(var(--theme-50));
            color: rgb(var(--theme-700));
            border: 1px solid rgb(var(--theme-200));
        }
        .btn-secondary:hover {
            background-color: rgb(var(--theme-100));
        }
        .btn-secondary:focus {
            --tw-ring-color: rgb(var(--theme-500));
        }
    </style>

    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Custom CSS -->
    <style>
        /* Alpine.js x-cloak æŒ‡ä»¤æ ·å¼ */

        [x-cloak] { display: none !important; }

        /* å…¨å±€å›¾æ ‡æ ·å¼ç±» */
        .icon {
            display: inline-block;
            width: 1.25rem;  /* w-5 */
            height: 1.25rem; /* h-5 */
            vertical-align: middle;
            flex-shrink: 0;
            /* é˜²æ­¢ç»§æ‰¿çˆ¶å…ƒç´ çš„å­—ä½“å¤§å° */
            font-size: 1.25rem;
            /* ç¡®ä¿å°ºå¯¸å›ºå®šï¼Œä¸å— text-* ç±»å½±å“ */
            min-width: 1.25rem;
            min-height: 1.25rem;
            max-width: 1.25rem;
            max-height: 1.25rem;
        }
        .icon-sm {
            display: inline-block;
            width: 1rem;    /* w-4 */
            height: 1rem;   /* h-4 */
            vertical-align: middle;
            flex-shrink: 0;
            /* é˜²æ­¢ç»§æ‰¿çˆ¶å…ƒç´ çš„å­—ä½“å¤§å° */
            font-size: 1rem;
            /* ç¡®ä¿å°ºå¯¸å›ºå®šï¼Œä¸å— text-* ç±»å½±å“ */
            min-width: 1rem;
            min-height: 1rem;
            max-width: 1rem;
            max-height: 1rem;
        }
        .icon-lg {
            display: inline-block;
            width: 1.5rem;  /* w-6 */
            height: 1.5rem; /* h-6 */
            vertical-align: middle;
            flex-shrink: 0;
            /* é˜²æ­¢ç»§æ‰¿çˆ¶å…ƒç´ çš„å­—ä½“å¤§å° */
            font-size: 1.5rem;
            /* ç¡®ä¿å°ºå¯¸å›ºå®šï¼Œä¸å— text-* ç±»å½±å“ */
            min-width: 1.5rem;
            min-height: 1.5rem;
            max-width: 1.5rem;
            max-height: 1.5rem;
        }

        /* Alpine.js å¯æœç´¢ä¸‹æ‹‰æ¡†ç»„ä»¶æ ·å¼ */
        .searchable-select-wrapper {
            position: relative;
        }

        .searchable-select-input {
            width: 100%;
            padding: 0.625rem 0.75rem;  /* px-3 py-2 */
            border: 1px solid #d1d5db;  /* border-gray-300 */
            border-radius: 0.5rem;  /* rounded-lg */
            transition: all 0.2s;
            cursor: pointer;
            background-color: white;
        }

        .searchable-select-input:focus {
            outline: none;
            border-color: rgb(var(--theme-500));
            box-shadow: 0 0 0 2px rgb(var(--theme-500));
        }

        .searchable-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 0.25rem;
            background-color: white;
            border: 1px solid #e5e7eb;  /* border-gray-200 */
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-height: 15rem;  /* max-h-60 */
            overflow-y: auto;
            z-index: 9999 !important;
        }

        .searchable-select-option {
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            transition: background-color 0.15s;
        }

        .searchable-select-option:hover {
            background-color: #f9fafb;  /* hover:bg-gray-50 */
        }

        .searchable-select-option.highlighted {
            background-color: #f3f4f6;  /* bg-gray-100 */
        }

        .searchable-select-option.selected {
            background-color: rgb(var(--theme-50));
            color: rgb(var(--theme-700));
            font-weight: 500;
        }

        .searchable-select-arrow {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            transition: transform 0.2s;
        }

        .searchable-select-arrow.open {
            transform: translateY(-50%) rotate(180deg);
        }

        .sidebar-transition {
            transition: width 0.2s ease-in-out;
        }

        [x-cloak] { display: none !important; }
    </style> {% block extra_css %}{% endblock %}
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50 font-sans antialiased">
    <div id="app" x-data="{
        mobileSidebarOpen: false,
        sidebarScrolled: false,
        sidebarCollapsed: localStorage.getItem('sidebarCollapsed') === 'true',
        theme: (function() {
            const validThemes = ['blue', 'yellow', 'red']; // ä¼˜å…ˆä½¿ç”¨å†…å­˜ä¸­ä¿å­˜çš„ä¸»é¢˜
            if (window.__validTheme && validThemes.includes(window.__validTheme)) {
                return window.__validTheme;
            } // å…¶æ¬¡ä½¿ç”¨ localStorageï¼ˆä½¿ç”¨ erp_theme é¿å…ä¸ Django admin å†²çªï¼‰
            const saved = localStorage.getItem('erp_theme');
            if (saved && validThemes.includes(saved)) {
                return saved;
            } // æœ€åæ‰ç”¨é»˜è®¤å€¼
            return 'blue';
        })(), // èœå•å±•å¼€çŠ¶æ€ç®¡ç†
        menuState: {},
        saveMenuStateDebounced: null,
        // å½“å‰è·¯å¾„è¿½è¸ªï¼ˆç”¨äºæ¿€æ´»èœå•é«˜äº®ï¼‰
        currentPath: window.location.pathname,
        // é¢åŒ…å±‘å¯¼èˆªæ•°æ®
        breadcrumbs: [],
        // è·¯å¾„åˆ°ä¸­æ–‡çš„æ˜ å°„è¡¨
        pathMappings: {
            'sales': 'é”€å”®ç®¡ç†',
            'orders': 'é”€å”®è®¢å•',
            'quotes': 'é”€å”®æŠ¥ä»·',
            'deliveries': 'å‘è´§ç®¡ç†',
            'returns': 'é”€å”®é€€è´§',
            'purchase': 'é‡‡è´­ç®¡ç†',
            'requests': 'é‡‡è´­ç”³è¯·',
            'borrow': 'é‡‡è´­å€Ÿç”¨',
            'borrows': 'é‡‡è´­å€Ÿç”¨',
            'receipts': 'æ”¶è´§ç®¡ç†',
            'inventory': 'åº“å­˜ç®¡ç†',
            'stocks': 'åº“å­˜æŸ¥è¯¢',
            'transfers': 'åº“å­˜è°ƒæ‹¨',
            'counts': 'åº“å­˜ç›˜ç‚¹',
            'adjustments': 'åº“å­˜è°ƒæ•´',
            'inbounds': 'å…¥åº“å•',
            'outbounds': 'å‡ºåº“å•',
            'transactions': 'åº“å­˜æµæ°´',
            'finance': 'è´¢åŠ¡ç®¡ç†',
            'customer-accounts': 'åº”æ”¶è´¦æ¬¾',
            'supplier-accounts': 'åº”ä»˜è´¦æ¬¾',
            'prepayments': 'é¢„æ”¶é¢„ä»˜',
            'journals': 'å‡­è¯ç®¡ç†',
            'budgets': 'é¢„ç®—ç®¡ç†',
            'expenses': 'è´¹ç”¨ç®¡ç†',
            'customers': 'å®¢æˆ·ç®¡ç†',
            'suppliers': 'ä¾›åº”å•†ç®¡ç†',
            'products': 'äº§å“ç®¡ç†',
            'reports': 'æŠ¥è¡¨ä¸­å¿ƒ',
            'settings': 'ç³»ç»Ÿè®¾ç½®',
            'users': 'ç”¨æˆ·ç®¡ç†',
            'departments': 'éƒ¨é—¨ç®¡ç†',
            'admin': 'ç³»ç»Ÿåå°',
            'warehouses': 'ä»“åº“ç®¡ç†',
            'import': 'å¯¼å…¥ç®¡ç†',
            'units': 'è®¡é‡å•ä½',
            'tax-rates': 'ç¨ç‡è®¾ç½®',
            'database': 'æ•°æ®åº“ç®¡ç†'
        },
        init() {
            // ç›‘å¬ç§»åŠ¨ç«¯ä¾§è¾¹æ çŠ¶æ€ï¼Œæ§åˆ¶ body æ»šåŠ¨å’Œç„¦ç‚¹ç®¡ç†
            this.$watch('mobileSidebarOpen', value => {
                if (window.innerWidth < 1024) { // ä»…åœ¨ç§»åŠ¨ç«¯ç”Ÿæ•ˆ
                    if (value) {
                        document.body.style.overflow = 'hidden';
                        // ä¾§è¾¹æ æ‰“å¼€åï¼Œå°†ç„¦ç‚¹ç§»åˆ°ç¬¬ä¸€ä¸ªèœå•é¡¹
                        this.$nextTick(() => {
                            this.$refs.firstMenu?.focus();
                        });
                    } else {
                        document.body.style.overflow = '';
                        // ä¾§è¾¹æ å…³é—­åï¼Œå°†ç„¦ç‚¹è¿”å›åˆ°æ‰“å¼€èœå•æŒ‰é’®
                        this.$nextTick(() => {
                            this.$refs.openMenuBtn?.focus();
                        });
                        // é‡ç½®æ»šåŠ¨çŠ¶æ€
                        this.sidebarScrolled = false;
                    }
                }
            });

            // ç›‘å¬ä¾§è¾¹æ æ»šåŠ¨ï¼Œæ§åˆ¶å…³é—­æŒ‰é’®æ˜¾ç¤º
            this.$nextTick(() => {
                const sidebarNav = this.$refs.sidebarNav;
                if (sidebarNav) {
                    sidebarNav.addEventListener('scroll', () => {
                        this.sidebarScrolled = sidebarNav.scrollTop > 50;
                    });
                }
            });

            // ç¡®ä¿ä¸»é¢˜åŒæ­¥åˆ° localStorage å’Œå†…å­˜
            if (this.theme) {
                localStorage.setItem('erp_theme', this.theme);
                window.__validTheme = this.theme;
            } // åº”ç”¨ä¸»é¢˜
            this.applyTheme(); // ç›‘å¬å…¶ä»–æ ‡ç­¾é¡µçš„ localStorage å˜åŒ–
            window.addEventListener('storage', (e) => {
                if (e.key === 'erp_theme' && e.newValue) {
                    const validThemes = ['blue', 'yellow', 'red'];
                    if (validThemes.includes(e.newValue)) {
                        this.theme = e.newValue;
                        window.__validTheme = e.newValue;
                        this.applyTheme();
                    }
                }
            }); // é¡µé¢å¸è½½å‰ç¡®ä¿ä¸»é¢˜å·²ä¿å­˜ï¼ˆé˜²æ­¢è·³è½¬åˆ° admin åä¸¢å¤±ï¼‰
            window.addEventListener('beforeunload', () => {
                if (this.theme) {
                    localStorage.setItem('erp_theme', this.theme);
                    window.__validTheme = this.theme;
                }
            }); // ä» localStorage åŠ è½½èœå•çŠ¶æ€
            const saved = localStorage.getItem('menuState');
            if (saved) {
                try {
                    this.menuState = JSON.parse(saved);
                } catch (e) {
                    this.menuState = {};
                }
            } // æ ¹æ®å½“å‰ URL è‡ªåŠ¨å±•å¼€å¯¹åº”çš„èœå•
            const path = window.location.pathname; // ğŸ”§ ä¿®å¤æ‰‹é£ç´bugï¼šå…ˆå…³é—­æ‰€æœ‰èœå•ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªèœå•æ‰“å¼€
            Object.keys(this.menuState).forEach(key => {
                this.menuState[key] = false;
            }); // ç„¶åæ ¹æ®URLæ‰“å¼€å¯¹åº”çš„èœå•ï¼ˆæ³¨æ„ï¼šæ›´å…·ä½“çš„è·¯å¾„è¦å…ˆåŒ¹é…ï¼‰
            if (path.includes('/settings/database/')) {
                // æ•°æ®åº“ç®¡ç†å±äºç³»ç»Ÿç®¡ç†èœå•ï¼ˆä¼˜å…ˆåŒ¹é…å…·ä½“è·¯å¾„ï¼‰
                this.menuState.system = true;
            } else if (path.includes('/users/') || path.includes('/departments/') || path.includes('/admin/')) {
                this.menuState.system = true;
            } else if (path.includes('/settings/')) {
                // settings è·¯å¾„ä¼˜å…ˆåŒ¹é…
                this.menuState.basic_settings = true;
            } else if (path === '/products/' || path.includes('/products/units')) {
                // äº§å“ç®¡ç†å’Œè®¡é‡å•ä½å±äºåŸºç¡€è®¾ç½®èœå•
                this.menuState.basic_settings = true;
            } else if (path.includes('/finance/tax-rates')) {
                // ç¨ç‡è®¾ç½®å±äºåŸºç¡€è®¾ç½®èœå•
                this.menuState.basic_settings = true;
            } else if (path.includes('/inventory/warehouses') || path.includes('/inventory/import')) {
                // åº“ä½è®¾ç½®ã€åº“å­˜å¯¼å…¥åŠåˆå§‹åŒ–å±äºåŸºç¡€è®¾ç½®èœå•ï¼ˆå¿…é¡»åœ¨ /inventory/ ä¹‹å‰åŒ¹é…ï¼‰
                this.menuState.basic_settings = true;
            } else if (path.includes('/inventory/stocks') || path.includes('/inventory/transfers') ||
                       path.includes('/inventory/counts') || path.includes('/inventory/adjustments') ||
                       path.includes('/inventory/inbounds') || path.includes('/inventory/outbounds') ||
                       path.includes('/inventory/transactions') || path.includes('/inventory/reports')) {
                // åº“å­˜ç®¡ç†ç›¸å…³è·¯å¾„
                this.menuState.inventory = true;
            } else if (path.includes('/inventory/')) {
                // å…¶ä»– /inventory/ è·¯å¾„
                this.menuState.inventory = true;
            } else if (path.includes('/finance/customer-accounts') || path.includes('/finance/supplier-accounts') ||
                       path.includes('/finance/prepayments') || path.includes('/finance/journals') ||
                       path.includes('/finance/budgets') || path.includes('/finance/reports')) {
                // è´¢åŠ¡ç®¡ç†ç›¸å…³è·¯å¾„
                this.menuState.finance = true;
            } else if (path.includes('/finance/')) {
                // å…¶ä»– /finance/ è·¯å¾„
                this.menuState.finance = true;
            } else if (path.includes('/customers/')) {
                // å®¢æˆ·ç®¡ç†å½’å±é”€å”®æ¨¡å—
                this.menuState.sales = true;
            } else if (path.includes('/suppliers/')) {
                // ä¾›åº”å•†ç®¡ç†å½’å±é‡‡è´­æ¨¡å—
                this.menuState.purchase = true;
            } else if (path.includes('/sales/')) {
                this.menuState.sales = true;
            } else if (path.includes('/purchase/')) {
                this.menuState.purchase = true;
            } // ä¿å­˜çŠ¶æ€
            this.saveMenuState();

            // ç”Ÿæˆé¢åŒ…å±‘å¯¼èˆª
            this.generateBreadcrumbs();

            // åˆ›å»ºé˜²æŠ–ç‰ˆæœ¬çš„saveMenuState
            this.saveMenuStateDebounced = this.debounce(() => {
                try {
                    localStorage.setItem('menuState', JSON.stringify(this.menuState));
                } catch (e) {
                    console.warn('æ— æ³•ä¿å­˜èœå•çŠ¶æ€:', e);
                }
            }, 300);
        }, toggleMenu(menuName) {
            // è®°å½•å½“å‰èœå•çš„çŠ¶æ€
            const currentState = this.menuState[menuName]; // å…³é—­æ‰€æœ‰èœå•
            Object.keys(this.menuState).forEach(key => {
                this.menuState[key] = false;
            }); // åˆ‡æ¢å½“å‰èœå•çŠ¶æ€ï¼ˆå¦‚æœä¹‹å‰æ˜¯å…³é—­çš„å°±æ‰“å¼€ï¼Œå¦‚æœä¹‹å‰æ˜¯æ‰“å¼€çš„å°±å…³é—­ï¼‰
            this.menuState[menuName] = !currentState;
            this.saveMenuStateDebounced();
        }, saveMenuState() {
            localStorage.setItem('menuState', JSON.stringify(this.menuState));
        }, debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }, toggleCollapse() {
            this.sidebarCollapsed = !this.sidebarCollapsed;
            localStorage.setItem('sidebarCollapsed', this.sidebarCollapsed);
        }, setTheme(themeName) {
            // éªŒè¯ä¸»é¢˜æ˜¯å¦æœ‰æ•ˆ
            const validThemes = ['blue', 'yellow', 'red'];
            if (!validThemes.includes(themeName)) {
                themeName = 'blue';
            } this.theme = themeName;
            localStorage.setItem('erp_theme', themeName);
            window.__validTheme = themeName;
            this.applyTheme();
        }, applyTheme() {
            document.documentElement.setAttribute('data-theme', this.theme);
        },
        // åˆ¤æ–­èœå•æ˜¯å¦å¤„äºæ¿€æ´»çŠ¶æ€ï¼ˆç”¨äºé«˜äº®æ˜¾ç¤ºï¼‰
        isActiveMenu(menuName) {
            const path = this.currentPath;
            const activeMap = {
                'dashboard': path === '/',
                'sales': path.startsWith('/sales/') || path.startsWith('/customers/'),
                'purchase': path.startsWith('/purchase/') || path.startsWith('/suppliers/'),
                'inventory': path.startsWith('/inventory/') && !path.includes('/inventory/warehouses') && !path.includes('/inventory/import'),
                'finance': path.startsWith('/finance/'),
                'basic_settings': path === '/products/' || path.includes('/products/units') || path.includes('/finance/tax-rates') || path.includes('/inventory/warehouses') || path.includes('/inventory/import') || path.includes('/settings/') && !path.includes('/settings/database/'),
                'reports': path.startsWith('/reports/'),
                'system': path.includes('/users/') || path.includes('/departments/') || path.includes('/admin/') || path.includes('/settings/database/')
            };
            return activeMap[menuName] || false;
        },
        // ç”Ÿæˆé¢åŒ…å±‘å¯¼èˆª
        generateBreadcrumbs() {
            const path = this.currentPath;
            const segments = path.split('/').filter(Boolean);

            // åˆå§‹åŒ–é¢åŒ…å±‘æ•°ç»„ï¼ˆé¦–é¡µå·²åœ¨æ¨¡æ¿ä¸­å®šä¹‰ï¼Œè¿™é‡ŒåªåŒ…å«å…¶ä»–è·¯å¾„ï¼‰
            this.breadcrumbs = [];

            // å¦‚æœæ˜¯é¦–é¡µï¼Œæ— é¢å¤–é¢åŒ…å±‘
            if (segments.length === 0) {
                return;
            }

            // æå–ä¸€çº§èœå•ï¼ˆç¬¬ä¸€ä¸ªè·¯å¾„æ®µï¼‰
            const firstSegment = segments[0];
            let firstSegmentName = this.pathMappings[firstSegment] || firstSegment;

            // åˆ¤æ–­æœ€åä¸€æ®µæ¥å†³å®šå½“å‰é¡µé¢åç§°
            const lastSegment = segments[segments.length - 1];
            let currentPageName = '';
            let currentPageUrl = '';

            // æ ¹æ®URLç»“æ„ç”Ÿæˆé¢åŒ…å±‘
            if (segments.length === 1) {
                // ä¸€çº§è·¯å¾„é¡µé¢ï¼Œå¦‚ /suppliers/
                currentPageName = firstSegmentName;
                currentPageUrl = '/' + firstSegment;
            } else if (lastSegment.match(/^\d+$/)) {
                // è¯¦æƒ…é¡µé¢ï¼Œå¦‚ /sales/orders/123/
                // è·å–å€’æ•°ç¬¬äºŒæ®µä½œä¸ºç±»å‹åç§°
                const secondLastSegment = segments[segments.length - 2];
                let typeName = this.pathMappings[secondLastSegment] || secondLastSegment;

                // æ ¹æ®ä¸Šä¸‹æ–‡è°ƒæ•´ç±»å‹åç§°
                if (secondLastSegment === 'orders' && firstSegment === 'sales') {
                    typeName = 'é”€å”®è®¢å•';
                } else if (secondLastSegment === 'orders' && firstSegment === 'purchase') {
                    typeName = 'é‡‡è´­è®¢å•';
                } else if (secondLastSegment === 'returns' && firstSegment === 'sales') {
                    typeName = 'é”€å”®é€€è´§';
                } else if (secondLastSegment === 'returns' && firstSegment === 'purchase') {
                    typeName = 'é‡‡è´­é€€è´§';
                }

                currentPageName = typeName.replace('ç®¡ç†', '').replace('åˆ—è¡¨', '') + 'è¯¦æƒ…';
                // URLæŒ‡å‘åˆ—è¡¨é¡µï¼ˆå»æ‰IDï¼‰
                currentPageUrl = '/' + segments.slice(0, -1).join('/');
            } else if (lastSegment === 'create') {
                // åˆ›å»ºé¡µé¢
                const secondLastSegment = segments[segments.length - 2];
                let typeName = this.pathMappings[secondLastSegment] || secondLastSegment;

                // æ ¹æ®ä¸Šä¸‹æ–‡è°ƒæ•´ç±»å‹åç§°
                if (secondLastSegment === 'orders' && firstSegment === 'sales') {
                    typeName = 'é”€å”®è®¢å•';
                } else if (secondLastSegment === 'orders' && firstSegment === 'purchase') {
                    typeName = 'é‡‡è´­è®¢å•';
                } else if (secondLastSegment === 'returns' && firstSegment === 'sales') {
                    typeName = 'é”€å”®é€€è´§';
                } else if (secondLastSegment === 'returns' && firstSegment === 'purchase') {
                    typeName = 'é‡‡è´­é€€è´§';
                }

                currentPageName = 'æ–°å»º' + typeName.replace('ç®¡ç†', '').replace('åˆ—è¡¨', '');
                // URLæŒ‡å‘åˆ—è¡¨é¡µ
                currentPageUrl = '/' + segments.slice(0, -1).join('/');
            } else if (lastSegment === 'update' || lastSegment === 'edit') {
                // ç¼–è¾‘é¡µé¢
                const thirdLastSegment = segments[segments.length - 2];
                let typeName = this.pathMappings[thirdLastSegment] || thirdLastSegment;

                // æ ¹æ®ä¸Šä¸‹æ–‡è°ƒæ•´ç±»å‹åç§°
                if (thirdLastSegment === 'orders' && firstSegment === 'sales') {
                    typeName = 'é”€å”®è®¢å•';
                } else if (thirdLastSegment === 'orders' && firstSegment === 'purchase') {
                    typeName = 'é‡‡è´­è®¢å•';
                }

                currentPageName = 'ç¼–è¾‘' + typeName.replace('ç®¡ç†', '').replace('åˆ—è¡¨', '');
                currentPageUrl = '/' + segments.slice(0, -2).join('/');
            } else if (lastSegment === 'delete') {
                // åˆ é™¤ç¡®è®¤é¡µé¢
                const thirdLastSegment = segments[segments.length - 2];
                let typeName = this.pathMappings[thirdLastSegment] || thirdLastSegment;

                currentPageName = 'åˆ é™¤' + typeName.replace('ç®¡ç†', '').replace('åˆ—è¡¨', '');
                currentPageUrl = '/' + segments.slice(0, -2).join('/');
            } else {
                // ä½¿ç”¨æ˜ å°„è¡¨çš„åç§°ï¼ˆå¯èƒ½æ˜¯reportsç­‰ï¼‰
                currentPageName = this.pathMappings[lastSegment] || lastSegment;
                currentPageUrl = '/' + segments.join('/');
            }

            // åªæ·»åŠ æœ€å¤šä¸¤ä¸ªé¢åŒ…å±‘é¡¹ï¼šä¸€çº§èœå• + å½“å‰é¡µé¢
            this.breadcrumbs = [
                {
                    name: firstSegmentName,
                    url: '/' + firstSegment,
                    isLast: segments.length === 1
                }
            ];

            // å¦‚æœä¸æ˜¯ä¸€çº§è·¯å¾„ï¼Œæ·»åŠ å½“å‰é¡µé¢
            if (segments.length > 1) {
                this.breadcrumbs[0].isLast = false;
                this.breadcrumbs.push({
                    name: currentPageName,
                    url: currentPageUrl,
                    isLast: true
                });
            }
        }
    }" class="flex h-screen bg-gray-50">
        <!-- ç§»åŠ¨ç«¯æ±‰å ¡åŒ…æŒ‰é’®ï¼ˆå›ºå®šå®šä½ï¼Œä»… lg ä»¥ä¸‹æ˜¾ç¤ºï¼‰ -->
        <button @click="mobileSidebarOpen = true"
                x-ref="openMenuBtn"
                aria-label="æ‰“å¼€å¯¼èˆªèœå•"
                class="fixed top-4 left-4 z-[60] p-4 rounded-lg bg-white shadow-md lg:hidden hover:bg-gray-50 transition-all duration-300 hover:scale-105 active:scale-95">
            <svg class="w-6 h-6 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
        </button>

        <!-- Sidebar -->
        <div class="flex-shrink-0 bg-white shadow-2xl border-r border-gray-200 flex flex-col h-full fixed inset-y-0 left-0 -translate-x-full lg:static lg:translate-x-0 lg:inset-auto lg:left-auto z-50 will-change-transform transition-transform duration-300 ease-in-out"
             :style="mobileSidebarOpen ? 'transform: translateX(0) !important;' : ''"
             :class="{
                'w-44': !sidebarCollapsed,
                'w-20': sidebarCollapsed
             }">
             <!-- Logo åŒºåŸŸ -->
            <div class="flex items-center px-3 bg-theme-600 text-white h-16 relative"
                 :class="{
                    'justify-between': !sidebarCollapsed,
                    'justify-center': sidebarCollapsed
                 }">
                <!-- Logo å›¾ç‰‡æˆ–æ–‡å­— -->
                {% if company_logo %}
                    <a href="/" class="flex items-center space-x-3 hover:opacity-90 transition-opacity" :class="{'hidden': sidebarCollapsed, 'flex': !sidebarCollapsed}">
                        <img src="{{ company_logo }}" alt="{{ company_name }}" class="h-10 w-auto">
                    </a>
                {% else %}
                    <h1 class="text-base font-semibold tracking-wide transition-all duration-200 whitespace-nowrap text-white"
                        :class="{
                            'hidden': sidebarCollapsed,
                            'block': !sidebarCollapsed
                        }">
                        {{ company_name }}
                    </h1>
                {% endif %}

                <!-- æŠ˜å /å±•å¼€æŒ‰é’®ï¼ˆæ¡Œé¢ç«¯ï¼Œä»… lg ä»¥ä¸Šæ˜¾ç¤ºï¼‰ -->
                <button @click="toggleCollapse()"
                        class="lg:flex flex-shrink-0 items-center justify-center rounded-full bg-transparent hover:bg-white/10 transition-all duration-200"
                        :class="{
                            'flex w-12 h-12': !sidebarCollapsed,
                            'flex w-10 h-10': sidebarCollapsed
                        }"
                        :title="sidebarCollapsed ? 'å±•å¼€èœå•' : 'æŠ˜å èœå•'">
                    <svg class="w-6 h-6 transition-transform duration-300"
                         :class="{
                             'rotate-180': sidebarCollapsed
                         }"
                         style="color: white;"
                         fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>


                <!-- ç§»åŠ¨ç«¯å…³é—­æŒ‰é’®ï¼ˆä»… lg ä»¥ä¸‹æ˜¾ç¤ºï¼Œèœå•æ‰“å¼€ä¸”æ»šåŠ¨åæ˜¾ç¤ºï¼‰ -->
                <button x-show="mobileSidebarOpen && sidebarScrolled"
                        @click="mobileSidebarOpen = false"
                        aria-label="å…³é—­å¯¼èˆªèœå•"
                        class="flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-full bg-transparent hover:bg-white/10 transition-all duration-200 hover:scale-105 active:scale-95 lg:hidden"
                        title="å…³é—­èœå•"
                        x-transition:enter="transition ease-out duration-200"
                        x-transition:enter-start="opacity-0 scale-75"
                        x-transition:enter-end="opacity-100 scale-100"
                        x-transition:leave="transition ease-in duration-150"
                        x-transition:leave-start="opacity-100 scale-100"
                        x-transition:leave-end="opacity-0 scale-75">
                    <svg class="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- Navigation -->
            <nav x-ref="sidebarNav" role="navigation" aria-label="ä¸»å¯¼èˆª" class="mt-4 px-3 space-y-1 overflow-y-auto overflow-x-hidden flex-1" style="max-height: calc(100vh - 4rem);">
                <!-- å±å¹•é˜…è¯»å™¨çŠ¶æ€é€šçŸ¥ -->
                <div x-show="mobileSidebarOpen"
                     role="status"
                     aria-live="polite"
                     class="sr-only"
                     x-text="'å¯¼èˆªèœå•å·²æ‰“å¼€'">
                </div>
                <div x-show="!mobileSidebarOpen"
                     role="status"
                     aria-live="polite"
                     class="sr-only"
                     x-text="'å¯¼èˆªèœå•å·²å…³é—­'">
                </div>
                <!-- Dashboard -->
                <div class="relative group/menu" x-data="{ tooltipTop: 0, buttonRight: 0 }"
                     @mouseenter="tooltipTop = $el.querySelector('a').getBoundingClientRect().top; buttonRight = $el.querySelector('a').getBoundingClientRect().right">
                    <a href="{% url 'dashboard' %}"
                       x-ref="firstMenu"
                       role="menuitem"
                       :aria-current="isActiveMenu('dashboard') ? 'page' : undefined"
                       class="relative flex items-center h-12 px-3 rounded-lg text-slate-700 transition-all duration-200 group/link"
                       :class="{
                           'justify-center w-10 mx-auto': sidebarCollapsed,
                           'w-full': !sidebarCollapsed,
                           'text-theme-700 bg-theme-50': isActiveMenu('dashboard'),
                           'hover:text-theme-600 hover:bg-theme-50': !isActiveMenu('dashboard')
                       }">
                        <!-- å›¾æ ‡ -->
                        <svg class="w-5 h-5 flex-shrink-0" :class="sidebarCollapsed ? 'mr-0' : 'mr-3'" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>

                        <!-- æ–‡å­— -->
                        <span class="relative font-medium transition-all duration-200 whitespace-nowrap text-base"
                              :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed }">
                            ä»ªè¡¨ç›˜
                        </span>

                        <!-- å·¦ä¾§æŒ‡ç¤ºæ¡ï¼šæ¿€æ´»çŠ¶æ€å¸¸é©»æ˜¾ç¤º -->
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 rounded-r-full bg-theme-600 transition-opacity duration-200"
                             :class="{
                                 'opacity-100': isActiveMenu('dashboard'),
                                 'opacity-0 group-hover/link:opacity-100': !isActiveMenu('dashboard')
                             }">
                        </div>
                    </a>

                    <!-- æŠ˜å çŠ¶æ€çš„ Tooltip -->
                    <div x-show="sidebarCollapsed"
                         x-cloak
                         x-transition:enter="transition ease-out duration-200"
                         x-transition:enter-start="opacity-0 scale-95"
                         x-transition:enter-end="opacity-100 scale-100"
                         class="fixed px-3 py-2 bg-slate-800 text-white text-sm font-medium rounded-lg shadow-xl whitespace-nowrap opacity-0 group-hover/menu:opacity-100 pointer-events-none transition-opacity duration-200 z-[9999]"
                         :style="'left: ' + buttonRight + 'px; top: ' + (tooltipTop + 20) + 'px'">
                        ä»ªè¡¨ç›˜
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1 w-2 h-2 bg-slate-800 rotate-45"></div>
                    </div>
                </div>

                <!-- Purchase Management -->
                <div class="relative group/menu" x-data="{
                    menuTop: 0,
                    buttonRight: 0,
                    popupElement: null,
                    showPopup: false,
                    hideTimer: null,
                    initPopup() {
                        this.$nextTick(() => {
                            this.popupElement = this.$el.querySelector('.popup-child');
                        });
                    },
                    updatePopupPosition() {
                        if (!this.popupElement) return;
                        const button = this.$el.querySelector('button');
                        if (!button) return;
                        const rect = button.getBoundingClientRect();
                        this.menuTop = rect.top;
                        this.buttonRight = rect.right;
                    }
                }"
                @mouseenter="clearTimeout(hideTimer); updatePopupPosition(); if (sidebarCollapsed && popupElement) { popupElement.classList.remove('invisible', 'opacity-0'); showPopup = true; }"
                @mouseleave="if (popupElement) { hideTimer = setTimeout(() => { popupElement.classList.add('invisible', 'opacity-0'); showPopup = false; }, 150); }"
                x-init="initPopup()">
                    <button type="button" @click="toggleMenu('purchase')"
                            :aria-expanded="menuState.purchase ? 'true' : 'false'"
                            aria-haspopup="true"
                            class="relative flex items-center h-12 w-full px-3 rounded-lg text-slate-700 transition-all duration-200 group/link"
                            :class="{
                                'justify-center w-10 mx-auto': sidebarCollapsed,
                                'w-full': !sidebarCollapsed,
                                'text-theme-700 bg-theme-50': isActiveMenu('purchase'),
                                'hover:text-theme-600 hover:bg-theme-50': !isActiveMenu('purchase'),
                                'bg-theme-100': menuState.purchase && !sidebarCollapsed && !isActiveMenu('purchase')
                            }">
                        <!-- å›¾æ ‡ -->
                        <svg class="w-5 h-5 flex-shrink-0" :class="sidebarCollapsed ? 'mr-0' : 'mr-3'" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>

                        <!-- æ–‡å­— -->
                        <span class="relative flex-grow text-left font-medium transition-all duration-200 whitespace-nowrap text-base"
                              :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed }">
                            é‡‡è´­ç®¡ç†
                        </span>

                        <!-- ç®­å¤´å›¾æ ‡ -->
                        <span class="text-xs transition-all duration-300 ease-in-out"
                           :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed, 'rotate-180': menuState.purchase }"
                           :style="!sidebarCollapsed ? 'margin-left: 0.125rem' : ''">â–¼</span>

                        <!-- å·¦ä¾§æŒ‡ç¤ºæ¡ï¼šæ¿€æ´»çŠ¶æ€æˆ–èœå•å±•å¼€æ—¶æ˜¾ç¤º -->
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 rounded-r-full bg-theme-600 transition-opacity duration-200"
                             :class="{
                                 'opacity-100': isActiveMenu('purchase') || menuState.purchase,
                                 'opacity-0 group-hover/link:opacity-100': !isActiveMenu('purchase') && !menuState.purchase
                             }">
                        </div>
                    </button>

                    <!-- Hover flyout for collapsed state -->
                    <div class="popup-child fixed w-48 rounded-xl bg-white shadow-2xl border border-slate-200 py-2 invisible opacity-0 transition-all duration-200 z-[9999]"
                         :style="'left: ' + buttonRight + 'px; top: ' + menuTop + 'px'"
                         x-show="showPopup"
                         @mouseenter="clearTimeout(hideTimer); showPopup = true"
                         @mouseleave="showPopup = false"
                         x-transition:enter="transition ease-out duration-200"
                         x-transition:enter-start="opacity-0 scale-95"
                         x-transition:enter-end="opacity-100 scale-100"
                         x-transition:leave="transition ease-in duration-150"
                         x-transition:leave-start="opacity-100 scale-100"
                         x-transition:leave-end="opacity-0 scale-95">
                        <div class="px-3 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider border-b border-slate-100">
                            é‡‡è´­ç®¡ç†
                        </div>
                        <a href="{% url 'purchase:borrow_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é‡‡è´­å€Ÿç”¨</span>
                        </a>
                        <a href="/purchase/requests/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é‡‡è´­ç”³è¯·</span>
                        </a>
                        <a href="/purchase/orders/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é‡‡è´­è®¢å•</span>
                        </a>
                        <a href="/purchase/receipts/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">æ”¶è´§ç®¡ç†</span>
                        </a>
                        <a href="/purchase/returns/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é‡‡è´­é€€è´§</span>
                        </a>
                        <a href="{% url 'suppliers:supplier_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">ä¾›åº”å•†ç®¡ç†</span>
                        </a>
                        <a href="{% url 'purchase:order_report' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é‡‡è´­æŠ¥è¡¨</span>
                        </a>
                    </div>

                    <!-- Accordion for expanded state -->
                    <div x-show="!sidebarCollapsed && menuState.purchase"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 -translate-y-2"
                         x-transition:enter-end="opacity-100 translate-y-0"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0"
                         x-transition:leave-end="opacity-0 -translate-y-2"
                         class="mt-3 ml-5 space-y-0.5 border-l-2 border-theme-500 -ml-0.5 pl-3">
                        <a href="{% url 'purchase:borrow_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é‡‡è´­å€Ÿç”¨</span>
                        </a>
                        <a href="/purchase/requests/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é‡‡è´­ç”³è¯·</span>
                        </a>
                        <a href="/purchase/orders/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é‡‡è´­è®¢å•</span>
                        </a>
                        <a href="/purchase/receipts/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">æ”¶è´§ç®¡ç†</span>
                        </a>
                        <a href="/purchase/returns/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é‡‡è´­é€€è´§</span>
                        </a>
                        <a href="{% url 'suppliers:supplier_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">ä¾›åº”å•†ç®¡ç†</span>
                        </a>
                        <a href="{% url 'purchase:order_report' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é‡‡è´­æŠ¥è¡¨</span>
                        </a>
                    </div>
                </div>

                <!-- Sales Management -->
                <div class="relative group/menu" x-data="{
                    menuTop: 0,
                    buttonRight: 0,
                    popupElement: null,
                    showPopup: false,
                    hideTimer: null,
                    initPopup() {
                        this.$nextTick(() => {
                            this.popupElement = this.$el.querySelector('.popup-child');
                        });
                    },
                    updatePopupPosition() {
                        if (!this.popupElement) return;
                        const button = this.$el.querySelector('button');
                        if (!button) return;
                        const rect = button.getBoundingClientRect();
                        this.menuTop = rect.top;
                        this.buttonRight = rect.right;
                    }
                }"
                @mouseenter="clearTimeout(hideTimer); updatePopupPosition(); if (sidebarCollapsed && popupElement) { popupElement.classList.remove('invisible', 'opacity-0'); showPopup = true; }"
                @mouseleave="if (popupElement) { hideTimer = setTimeout(() => { popupElement.classList.add('invisible', 'opacity-0'); showPopup = false; }, 150); }"
                x-init="initPopup()">
                    <button type="button" @click="toggleMenu('sales')"
                            class="relative flex items-center h-12 w-full px-3 rounded-lg text-slate-700 transition-all duration-200 group/link"
                            :class="{
                                'justify-center w-10 mx-auto': sidebarCollapsed,
                                'w-full': !sidebarCollapsed,
                                'text-theme-700 bg-theme-50': isActiveMenu('sales'),
                                'hover:text-theme-600 hover:bg-theme-50': !isActiveMenu('sales'),
                                'bg-theme-100': menuState.sales && !sidebarCollapsed && !isActiveMenu('sales')
                            }">

                        <!-- å›¾æ ‡ -->
                        <svg class="w-5 h-5 flex-shrink-0" :class="sidebarCollapsed ? 'mr-0' : 'mr-3'" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                        </svg>

                        <!-- æ–‡å­— -->
                        <span class="relative flex-grow text-left font-medium transition-all duration-200 whitespace-nowrap text-base"
                              :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed }">
                            é”€å”®ç®¡ç†
                        </span>

                        <!-- ç®­å¤´å›¾æ ‡ -->
                        <span class="text-xs transition-all duration-300 ease-in-out"
                           :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed, 'rotate-180': menuState.sales }"
                           :style="!sidebarCollapsed ? 'margin-left: 0.125rem' : ''">â–¼</span>

                        <!-- å·¦ä¾§æŒ‡ç¤ºæ¡ï¼šæ¿€æ´»çŠ¶æ€æˆ–èœå•å±•å¼€æ—¶æ˜¾ç¤º -->
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 rounded-r-full bg-theme-600 transition-opacity duration-200"
                             :class="{
                                 'opacity-100': isActiveMenu('sales') || menuState.sales,
                                 'opacity-0 group-hover/link:opacity-100': !isActiveMenu('sales') && !menuState.sales
                             }">
                        </div>
                    </button>

                    <!-- Hover submenu for collapsed state -->
                    <div class="popup-child fixed w-48 rounded-xl bg-white shadow-2xl border border-slate-200 py-2 invisible opacity-0 transition-all duration-200 z-[9999]"
                         :style="'left: ' + buttonRight + 'px; top: ' + menuTop + 'px'"
                         x-show="showPopup"
                         @mouseenter="clearTimeout(hideTimer); showPopup = true"
                         @mouseleave="showPopup = false"
                         x-transition:enter="transition ease-out duration-200"
                         x-transition:enter-start="opacity-0 scale-95"
                         x-transition:enter-end="opacity-100 scale-100"
                         x-transition:leave="transition ease-in duration-150"
                         x-transition:leave-start="opacity-100 scale-100"
                         x-transition:leave-end="opacity-0 scale-95">
                        <div class="px-3 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider border-b border-slate-100">
                            é”€å”®ç®¡ç†
                        </div>
                        <a href="{% url 'sales:loan_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é”€å”®å€Ÿç”¨</span>
                        </a>
                        <a href="{% url 'sales:quote_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é”€å”®æŠ¥ä»·</span>
                        </a>
                        <a href="{% url 'sales:order_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é”€å”®è®¢å•</span>
                        </a>
                        <a href="{% url 'sales:delivery_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">å‘è´§ç®¡ç†</span>
                        </a>
                        <a href="{% url 'sales:return_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é”€å”®é€€è´§</span>
                        </a>
                        <a href="{% url 'customers:customer_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">å®¢æˆ·ç®¡ç†</span>
                        </a>
                        <a href="{% url 'sales:order_report' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é”€å”®æŠ¥è¡¨</span>
                        </a>
                    </div>

                    <!-- Accordion submenu for expanded state -->
                    <div x-show="!sidebarCollapsed && menuState.sales"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 -translate-y-2"
                         x-transition:enter-end="opacity-100 translate-y-0"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0"
                         x-transition:leave-end="opacity-0 -translate-y-2"
                         class="mt-3 ml-5 space-y-0.5 border-l-2 border-theme-500 -ml-0.5 pl-3">
                        <a href="{% url 'sales:loan_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é”€å”®å€Ÿç”¨</span>
                        </a>
                        <a href="{% url 'sales:quote_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é”€å”®æŠ¥ä»·</span>
                        </a>
                        <a href="{% url 'sales:order_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é”€å”®è®¢å•</span>
                        </a>
                        <a href="{% url 'sales:delivery_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">å‘è´§ç®¡ç†</span>
                        </a>
                        <a href="{% url 'sales:return_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é”€å”®é€€è´§</span>
                        </a>
                        <a href="{% url 'customers:customer_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">å®¢æˆ·ç®¡ç†</span>
                        </a>
                        <a href="{% url 'sales:order_report' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é”€å”®æŠ¥è¡¨</span>
                        </a>
                    </div>
                </div>

                <!-- Inventory Management -->
                <div class="relative group/menu" x-data="{
                    menuTop: 0,
                    buttonRight: 0,
                    popupElement: null,
                    showPopup: false,
                    hideTimer: null,
                    initPopup() {
                        this.$nextTick(() => {
                            this.popupElement = this.$el.querySelector('.popup-child');
                        });
                    },
                    updatePopupPosition() {
                        if (!this.popupElement) return;
                        const button = this.$el.querySelector('button');
                        if (!button) return;
                        const rect = button.getBoundingClientRect();
                        this.menuTop = rect.top;
                        this.buttonRight = rect.right;
                    }
                }"
                @mouseenter="clearTimeout(hideTimer); updatePopupPosition(); if (sidebarCollapsed && popupElement) { popupElement.classList.remove('invisible', 'opacity-0'); showPopup = true; }"
                @mouseleave="if (popupElement) { hideTimer = setTimeout(() => { popupElement.classList.add('invisible', 'opacity-0'); showPopup = false; }, 150); }"
                x-init="initPopup()">
                    <button type="button" @click="toggleMenu('inventory')"
                            :aria-expanded="menuState.inventory ? 'true' : 'false'"
                            aria-haspopup="true"
                            class="relative flex items-center h-12 w-full px-3 rounded-lg text-slate-700 transition-all duration-200 group/link"
                            :class="{
                                'justify-center w-10 mx-auto': sidebarCollapsed,
                                'w-full': !sidebarCollapsed,
                                'text-theme-700 bg-theme-50': isActiveMenu('inventory'),
                                'hover:text-theme-600 hover:bg-theme-50': !isActiveMenu('inventory'),
                                'bg-theme-100': menuState.inventory && !sidebarCollapsed && !isActiveMenu('inventory')
                            }">
                        <svg class="w-5 h-5 flex-shrink-0" :class="sidebarCollapsed ? 'mr-0' : 'mr-3'" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                        </svg>
                        <span class="relative flex-grow text-left font-medium transition-all duration-200 whitespace-nowrap text-base"
                              :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed }">
                            åº“å­˜ç®¡ç†
                        </span>
                        <span class="text-xs transition-all duration-300 ease-in-out"
                           :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed, 'rotate-180': menuState.inventory }"
                           :style="!sidebarCollapsed ? 'margin-left: 0.125rem' : ''">â–¼</span>
                        <!-- å·¦ä¾§æŒ‡ç¤ºæ¡ï¼šæ¿€æ´»çŠ¶æ€æˆ–èœå•å±•å¼€æ—¶æ˜¾ç¤º -->
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 rounded-r-full bg-theme-600 transition-opacity duration-200"
                             :class="{
                                 'opacity-100': isActiveMenu('inventory') || menuState.inventory,
                                 'opacity-0 group-hover/link:opacity-100': !isActiveMenu('inventory') && !menuState.inventory
                             }">
                        </div>
                    </button>
                    <div class="popup-child fixed w-48 rounded-xl bg-white shadow-2xl border border-slate-200 py-2 invisible opacity-0 transition-all duration-200 z-[9999]"
                         :style="'left: ' + buttonRight + 'px; top: ' + menuTop + 'px'"
                         x-show="showPopup"
                         @mouseenter="clearTimeout(hideTimer); showPopup = true"
                         @mouseleave="showPopup = false"
                         x-transition:enter="transition ease-out duration-200"
                         x-transition:enter-start="opacity-0 scale-95"
                         x-transition:enter-end="opacity-100 scale-100"
                         x-transition:leave="transition ease-in duration-150"
                         x-transition:leave-start="opacity-100 scale-100"
                         x-transition:leave-end="opacity-0 scale-95">
                        <div class="px-3 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider border-b border-slate-100">åº“å­˜ç®¡ç†</div>
                        <a href="/inventory/stocks/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº“å­˜æŸ¥è¯¢</span>
                        </a>
                        <a href="/inventory/transfers/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº“å­˜è°ƒæ‹¨</span>
                        </a>
                        <a href="/inventory/counts/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº“å­˜ç›˜ç‚¹</span>
                        </a>
                        <a href="/inventory/adjustments/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº“å­˜è°ƒæ•´</span>
                        </a>
                        <a href="{% url 'inventory:inventory_order_report' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº“å­˜æŠ¥è¡¨</span>
                        </a>
                    </div>
                    <div x-show="!sidebarCollapsed && menuState.inventory"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 -translate-y-2"
                         x-transition:enter-end="opacity-100 translate-y-0"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0"
                         x-transition:leave-end="opacity-0 -translate-y-2"
                         class="mt-3 ml-5 space-y-0.5 border-l-2 border-theme-500 -ml-0.5 pl-3">
                        <a href="/inventory/stocks/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº“å­˜æŸ¥è¯¢</span>
                        </a>
                        <a href="/inventory/transfers/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº“å­˜è°ƒæ‹¨</span>
                        </a>
                        <a href="/inventory/counts/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº“å­˜ç›˜ç‚¹</span>
                        </a>
                        <a href="/inventory/adjustments/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº“å­˜è°ƒæ•´</span>
                        </a>
                        <a href="{% url 'inventory:inventory_order_report' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº“å­˜æŠ¥è¡¨</span>
                        </a>
                    </div>
                </div>

                <!-- Finance Management -->
                <div class="relative group/menu" x-data="{
                    menuTop: 0,
                    buttonRight: 0,
                    popupElement: null,
                    showPopup: false,
                    hideTimer: null,
                    initPopup() {
                        this.$nextTick(() => {
                            this.popupElement = this.$el.querySelector('.popup-child');
                        });
                    },
                    updatePopupPosition() {
                        if (!this.popupElement) return;
                        const button = this.$el.querySelector('button');
                        if (!button) return;
                        const rect = button.getBoundingClientRect();
                        this.menuTop = rect.top;
                        this.buttonRight = rect.right;
                    }
                }"
                @mouseenter="clearTimeout(hideTimer); updatePopupPosition(); if (sidebarCollapsed && popupElement) { popupElement.classList.remove('invisible', 'opacity-0'); showPopup = true; }"
                @mouseleave="if (popupElement) { hideTimer = setTimeout(() => { popupElement.classList.add('invisible', 'opacity-0'); showPopup = false; }, 150); }"
                x-init="initPopup()">
                    <button type="button" @click="toggleMenu('finance')"
                            :aria-expanded="menuState.finance ? 'true' : 'false'"
                            aria-haspopup="true"
                            class="relative flex items-center h-12 w-full px-3 rounded-lg text-slate-700 transition-all duration-200 group/link"
                            :class="{
                                'justify-center w-10 mx-auto': sidebarCollapsed,
                                'w-full': !sidebarCollapsed,
                                'text-theme-700 bg-theme-50': isActiveMenu('finance'),
                                'hover:text-theme-600 hover:bg-theme-50': !isActiveMenu('finance'),
                                'bg-theme-100': menuState.finance && !sidebarCollapsed && !isActiveMenu('finance')
                            }">
                        <svg class="w-5 h-5 flex-shrink-0" :class="sidebarCollapsed ? 'mr-0' : 'mr-3'" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        <span class="relative flex-grow text-left font-medium transition-all duration-200 whitespace-nowrap text-base"
                              :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed }">
                            å¾€æ¥æ¬¾é¡¹
                        </span>
                        <span class="text-xs transition-all duration-300 ease-in-out"
                           :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed, 'rotate-180': menuState.finance }"
                           :style="!sidebarCollapsed ? 'margin-left: 0.125rem' : ''">â–¼</span>
                        <!-- å·¦ä¾§æŒ‡ç¤ºæ¡ï¼šæ¿€æ´»çŠ¶æ€æˆ–èœå•å±•å¼€æ—¶æ˜¾ç¤º -->
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 rounded-r-full bg-theme-600 transition-opacity duration-200"
                             :class="{
                                 'opacity-100': isActiveMenu('finance') || menuState.finance,
                                 'opacity-0 group-hover/link:opacity-100': !isActiveMenu('finance') && !menuState.finance
                             }">
                        </div>
                    </button>
                    <div class="popup-child fixed w-56 rounded-xl bg-white shadow-2xl border border-slate-200 py-2 invisible opacity-0 transition-all duration-200 z-[9999]"
                         :style="'left: ' + buttonRight + 'px; top: ' + menuTop + 'px'"
                         x-show="showPopup"
                         @mouseenter="clearTimeout(hideTimer); showPopup = true"
                         @mouseleave="showPopup = false"
                         x-transition:enter="transition ease-out duration-200"
                         x-transition:enter-start="opacity-0 scale-95"
                         x-transition:enter-end="opacity-100 scale-100"
                         x-transition:leave="transition ease-in duration-150"
                         x-transition:leave-start="opacity-100 scale-100"
                         x-transition:leave-end="opacity-0 scale-95">
                        <div class="px-3 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider border-b border-slate-100">å¾€æ¥æ¬¾é¡¹</div>
                        <a href="/finance/customer-accounts/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº”æ”¶è´¦æ¬¾</span>
                        </a>
                        <a href="/finance/supplier-accounts/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº”ä»˜è´¦æ¬¾</span>
                        </a>
                        <a href="/finance/prepayments/customer/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é¢„æ”¶æ¬¾</span>
                        </a>
                        <a href="/finance/prepayments/supplier/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é¢„ä»˜æ¬¾</span>
                        </a>
                        <a href="{% url 'finance:account_report' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">å¾€æ¥æŠ¥è¡¨</span>
                        </a>
                        <a href="{% url 'finance:report_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">è´¢åŠ¡æŠ¥è¡¨</span>
                        </a>
                        <a href="{% url 'finance:expense_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">è´¹ç”¨ç®¡ç†</span>
                        </a>
                    </div>
                    <div x-show="!sidebarCollapsed && menuState.finance"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 -translate-y-2"
                         x-transition:enter-end="opacity-100 translate-y-0"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0"
                         x-transition:leave-end="opacity-0 -translate-y-2"
                         class="mt-3 ml-5 space-y-0.5 border-l-2 border-theme-500 -ml-0.5 pl-3">
                        <a href="/finance/customer-accounts/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº”æ”¶è´¦æ¬¾</span>
                        </a>
                        <a href="/finance/supplier-accounts/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº”ä»˜è´¦æ¬¾</span>
                        </a>
                        <a href="/finance/prepayments/customer/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é¢„æ”¶æ¬¾</span>
                        </a>
                        <a href="/finance/prepayments/supplier/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é¢„ä»˜æ¬¾</span>
                        </a>
                        <a href="{% url 'finance:account_report' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">å¾€æ¥æŠ¥è¡¨</span>
                        </a>
                        <a href="{% url 'finance:report_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">è´¢åŠ¡æŠ¥è¡¨</span>
                        </a>
                        <a href="{% url 'finance:expense_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">è´¹ç”¨ç®¡ç†</span>
                        </a>
                    </div>
                </div>

                <!-- Basic Settings -->
                <div class="relative group/menu" x-data="{
                    menuTop: 0,
                    buttonRight: 0,
                    popupElement: null,
                    showPopup: false,
                    hideTimer: null,
                    initPopup() {
                        this.$nextTick(() => {
                            this.popupElement = this.$el.querySelector('.popup-child');
                        });
                    },
                    updatePopupPosition() {
                        if (!this.popupElement) return;
                        const button = this.$el.querySelector('button');
                        if (!button) return;
                        const rect = button.getBoundingClientRect();
                        this.menuTop = rect.top;
                        this.buttonRight = rect.right;
                    }
                }"
                @mouseenter="clearTimeout(hideTimer); updatePopupPosition(); if (sidebarCollapsed && popupElement) { popupElement.classList.remove('invisible', 'opacity-0'); showPopup = true; }"
                @mouseleave="if (popupElement) { hideTimer = setTimeout(() => { popupElement.classList.add('invisible', 'opacity-0'); showPopup = false; }, 150); }"
                x-init="initPopup()">
                    <button type="button" @click="toggleMenu('basic_settings')"
                            :aria-expanded="menuState.basic_settings ? 'true' : 'false'"
                            aria-haspopup="true"
                            class="relative flex items-center h-12 w-full px-3 rounded-lg text-slate-700 transition-all duration-200 group/link"
                            :class="{
                                'justify-center w-10 mx-auto': sidebarCollapsed,
                                'w-full': !sidebarCollapsed,
                                'text-theme-700 bg-theme-50': isActiveMenu('basic_settings'),
                                'hover:text-theme-600 hover:bg-theme-50': !isActiveMenu('basic_settings'),
                                'bg-theme-100': menuState.basic_settings && !sidebarCollapsed && !isActiveMenu('basic_settings')
                            }">
                        <svg class="w-5 h-5 flex-shrink-0" :class="sidebarCollapsed ? 'mr-0' : 'mr-3'" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        <span class="relative flex-grow text-left font-medium transition-all duration-200 whitespace-nowrap text-base"
                              :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed }">
                            åŸºç¡€è®¾ç½®
                        </span>
                        <span class="text-xs transition-all duration-300 ease-in-out"
                           :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed, 'rotate-180': menuState.basic_settings }"
                           :style="!sidebarCollapsed ? 'margin-left: 0.125rem' : ''">â–¼</span>
                        <!-- å·¦ä¾§æŒ‡ç¤ºæ¡ï¼šæ¿€æ´»çŠ¶æ€æˆ–èœå•å±•å¼€æ—¶æ˜¾ç¤º -->
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 rounded-r-full bg-theme-600 transition-opacity duration-200"
                             :class="{
                                 'opacity-100': isActiveMenu('basic_settings') || menuState.basic_settings,
                                 'opacity-0 group-hover/link:opacity-100': !isActiveMenu('basic_settings') && !menuState.basic_settings
                             }">
                        </div>
                    </button>
                    <div class="popup-child fixed w-56 rounded-xl bg-white shadow-2xl border border-slate-200 py-2 invisible opacity-0 transition-all duration-200 z-[9999]"
                         :style="'left: ' + buttonRight + 'px; top: ' + menuTop + 'px'"
                         x-show="showPopup"
                         @mouseenter="clearTimeout(hideTimer); showPopup = true"
                         @mouseleave="showPopup = false"
                         x-transition:enter="transition ease-out duration-200"
                         x-transition:enter-start="opacity-0 scale-95"
                         x-transition:enter-end="opacity-100 scale-100"
                         x-transition:leave="transition ease-in duration-150"
                         x-transition:leave-start="opacity-100 scale-100"
                         x-transition:leave-end="opacity-0 scale-95">
                        <div class="px-3 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider border-b border-slate-100">åŸºç¡€è®¾ç½®</div>
                        <a href="/products/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">äº§å“ç®¡ç†</span>
                        </a>
                        <a href="/inventory/warehouses/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº“ä½è®¾ç½®</span>
                        </a>
                        <a href="/products/units/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">è®¡é‡å•ä½</span>
                        </a>
                        <a href="/finance/tax-rates/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">ç¨ç‡è®¾ç½®</span>
                        </a>
                        <a href="/settings/print-templates/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">æ‰“å°æ¨¡æ¿</span>
                        </a>
                        <a href="/inventory/import/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">å¯¼å…¥ä¸åˆå§‹åŒ–</span>
                        </a>
                    </div>
                    <div x-show="!sidebarCollapsed && menuState.basic_settings"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 -translate-y-2"
                         x-transition:enter-end="opacity-100 translate-y-0"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0"
                         x-transition:leave-end="opacity-0 -translate-y-2"
                         class="mt-3 ml-5 space-y-0.5 border-l-2 border-theme-500 -ml-0.5 pl-3">
                        <a href="/products/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">äº§å“ç®¡ç†</span>
                        </a>
                        <a href="/inventory/warehouses/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº“ä½è®¾ç½®</span>
                        </a>
                        <a href="/products/units/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">è®¡é‡å•ä½</span>
                        </a>
                        <a href="/finance/tax-rates/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">ç¨ç‡è®¾ç½®</span>
                        </a>
                        <a href="/settings/print-templates/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">æ‰“å°æ¨¡æ¿</span>
                        </a>
                        <a href="/inventory/import/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">å¯¼å…¥ä¸åˆå§‹åŒ–</span>
                        </a>
                    </div>
                </div>

                <!-- System Management -->
                <div class="relative group/menu" x-data="{
                    menuTop: 0,
                    buttonRight: 0,
                    popupElement: null,
                    showPopup: false,
                    hideTimer: null,
                    initPopup() {
                        this.$nextTick(() => {
                            this.popupElement = this.$el.querySelector('.popup-child');
                        });
                    },
                    updatePopupPosition() {
                        if (!this.popupElement) return;
                        const button = this.$el.querySelector('button');
                        if (!button) return;
                        const rect = button.getBoundingClientRect();
                        this.menuTop = rect.top;
                        this.buttonRight = rect.right;
                    }
                }"
                @mouseenter="clearTimeout(hideTimer); updatePopupPosition(); if (sidebarCollapsed && popupElement) { popupElement.classList.remove('invisible', 'opacity-0'); showPopup = true; }"
                @mouseleave="if (popupElement) { hideTimer = setTimeout(() => { popupElement.classList.add('invisible', 'opacity-0'); showPopup = false; }, 150); }"
                x-init="initPopup()">
                    <button type="button" @click="toggleMenu('system')"
                            :aria-expanded="menuState.system ? 'true' : 'false'"
                            aria-haspopup="true"
                            class="relative flex items-center h-12 w-full px-3 rounded-lg text-slate-700 transition-all duration-200 group/link"
                            :class="{
                                'justify-center w-10 mx-auto': sidebarCollapsed,
                                'w-full': !sidebarCollapsed,
                                'text-theme-700 bg-theme-50': isActiveMenu('system'),
                                'hover:text-theme-600 hover:bg-theme-50': !isActiveMenu('system'),
                                'bg-theme-100': menuState.system && !sidebarCollapsed && !isActiveMenu('system')
                            }">
                        <svg class="w-5 h-5 flex-shrink-0" :class="sidebarCollapsed ? 'mr-0' : 'mr-3'" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 11-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 004.486-6.336l-3.276 3.277a3.004 3.004 0 01-2.25-2.25l3.276-3.276a4.5 4.5 0 00-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437l1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008z" />
                        </svg>
                        <span class="relative flex-grow text-left font-medium transition-all duration-200 whitespace-nowrap text-base"
                              :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed }">
                            ç³»ç»Ÿç®¡ç†
                        </span>
                        <span class="text-xs transition-all duration-300 ease-in-out"
                           :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed, 'rotate-180': menuState.system }"
                           :style="!sidebarCollapsed ? 'margin-left: 0.125rem' : ''">â–¼</span>
                        <!-- å·¦ä¾§æŒ‡ç¤ºæ¡ï¼šæ¿€æ´»çŠ¶æ€æˆ–èœå•å±•å¼€æ—¶æ˜¾ç¤º -->
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 rounded-r-full bg-theme-600 transition-opacity duration-200"
                             :class="{
                                 'opacity-100': isActiveMenu('system') || menuState.system,
                                 'opacity-0 group-hover/link:opacity-100': !isActiveMenu('system') && !menuState.system
                             }">
                        </div>
                    </button>
                    <div class="popup-child fixed w-56 rounded-xl bg-white shadow-2xl border border-slate-200 py-2 invisible opacity-0 transition-all duration-200 z-[9999]"
                         :style="'left: ' + buttonRight + 'px; top: ' + menuTop + 'px'"
                         x-show="showPopup"
                         @mouseenter="clearTimeout(hideTimer); showPopup = true"
                         @mouseleave="showPopup = false"
                         x-transition:enter="transition ease-out duration-200"
                         x-transition:enter-start="opacity-0 scale-95"
                         x-transition:enter-end="opacity-100 scale-100"
                         x-transition:leave="transition ease-in duration-150"
                         x-transition:leave-start="opacity-100 scale-100"
                         x-transition:leave-end="opacity-0 scale-95">
                        <div class="px-3 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider border-b border-slate-100">ç³»ç»Ÿç®¡ç†</div>
                        <a href="/users/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">ç”¨æˆ·ç®¡ç†</span>
                        </a>
                        <a href="/users/roles/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">è§’è‰²æƒé™</span>
                        </a>
                        <a href="/departments/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">éƒ¨é—¨ç®¡ç†</span>
                        </a>
                        <a href="/settings/database/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">æ•°æ®åº“ç®¡ç†</span>
                        </a>
                        <a href="/admin/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">ç³»ç»Ÿé…ç½®</span>
                        </a>
                    </div>
                    <div x-show="!sidebarCollapsed && menuState.system"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 -translate-y-2"
                         x-transition:enter-end="opacity-100 translate-y-0"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0"
                         x-transition:leave-end="opacity-0 -translate-y-2"
                         class="mt-3 ml-5 space-y-0.5 border-l-2 border-theme-500 -ml-0.5 pl-3">
                        <a href="/users/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">ç”¨æˆ·ç®¡ç†</span>
                        </a>
                        <a href="/users/roles/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">è§’è‰²æƒé™</span>
                        </a>
                        <a href="/departments/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">éƒ¨é—¨ç®¡ç†</span>
                        </a>
                        <a href="/settings/database/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">æ•°æ®åº“ç®¡ç†</span>
                        </a>
                        <a href="/admin/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">ç³»ç»Ÿé…ç½®</span>
                        </a>
                    </div>
                </div>
            </nav>
        </div>

        <!-- ç§»åŠ¨ç«¯ä¾§è¾¹æ é®ç½©å±‚ -->
        <div x-show="mobileSidebarOpen"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             @click="mobileSidebarOpen = false"
             class="fixed inset-0 bg-black/50 backdrop-blur-sm z-40 lg:hidden will-change-transform"></div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Header -->
            <header class="bg-white shadow-sm border-b border-gray-200">
                <div class="flex items-center justify-between px-6 py-4">
                    <div class="flex items-center">
                        <!-- é¢åŒ…å±‘å¯¼èˆª -->
                        <nav class="ml-4 flex items-center space-x-2 text-sm" aria-label="é¢åŒ…å±‘å¯¼èˆª">
                            <!-- å›ºå®šçš„é¦–é¡µé“¾æ¥ï¼ˆä¸å¯è¦†ç›–ï¼‰ -->
                            {% block breadcrumb_start %}
                            <a href="/" class="text-gray-500 hover:text-gray-700 flex items-center">
                                <svg class="icon mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                                </svg>
                                é¦–é¡µ
                            </a>
                            {% endblock %}

                            <!-- é¡µé¢è‡ªå®šä¹‰é¢åŒ…å±‘éƒ¨åˆ†ï¼ˆå¯è¦†ç›–ï¼‰ -->
                            {% block breadcrumb %}
                            <!-- JavaScriptè‡ªåŠ¨ç”Ÿæˆçš„é¢åŒ…å±‘ -->
                            <template x-for="(crumb, index) in breadcrumbs" :key="index">
                                <li class="flex items-center list-none">
                                    <!-- åˆ†éš”ç¬¦ -->
                                    <span x-show="index > 0" class="mx-2 text-gray-400">/</span>

                                    <!-- é¢åŒ…å±‘é“¾æ¥ -->
                                    <a :href="crumb.url"
                                       class="transition-colors duration-200 hover:underline flex items-center"
                                       :class="{
                                           'text-gray-500 hover:text-gray-700': !crumb.isLast,
                                           'text-gray-900 font-semibold': crumb.isLast
                                       }">
                                        <span x-text="crumb.name"></span>
                                    </a>
                                </li>
                            </template>
                            {% endblock %}
                        </nav>
                    </div> <div class="flex items-center space-x-4">
                        <!-- Notifications -->
                        <div x-data="{ open: false }" class="relative">
                            <button @click="open = !open" class="text-gray-500 hover:text-gray-700 relative">
                                <svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
</svg>
                                <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">3</span>
                            </button>
                            <div x-show="open" @click.away="open = false" x-cloak class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                                <div class="p-4 border-b border-gray-200">
                                    <h3 class="text-lg font-semibold">é€šçŸ¥</h3>
                                </div>
                                <div class="max-h-64 overflow-y-auto">
                                    <div class="p-4 border-b border-gray-100 hover:bg-gray-50">
                                        <p class="text-sm text-gray-800">æ–°çš„é”€å”®è®¢å•å¾…å¤„ç†</p>
                                        <p class="text-xs text-gray-500 mt-1">5åˆ†é’Ÿå‰</p>
                                    </div>
                                    <div class="p-4 border-b border-gray-100 hover:bg-gray-50">
                                        <p class="text-sm text-gray-800">åº“å­˜é¢„è­¦ï¼šäº§å“Aåº“å­˜ä¸è¶³</p>
                                        <p class="text-xs text-gray-500 mt-1">1å°æ—¶å‰</p>
                                    </div>
                                    <div class="p-4 hover:bg-gray-50">
                                        <p class="text-sm text-gray-800">é‡‡è´­è®¢å•å·²å®¡æ ¸é€šè¿‡</p>
                                        <p class="text-xs text-gray-500 mt-1">2å°æ—¶å‰</p>
                                    </div>
                                </div>
                            </div>
                        </div> <!-- Theme Switcher -->
                        <div x-data="{ open: false }" class="relative">
                            <button @click="open = !open" class="text-gray-500 hover:text-gray-700 relative" title="åˆ‡æ¢ä¸»é¢˜">
                                <svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
</svg>
                            </button>
                            <div x-show="open" @click.away="open = false" x-cloak class="absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                                <button @click="setTheme('red'); open = false"
                                        class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors"
                                        :class="{ 'bg-red-50': theme === 'red' }">
                                    <svg class="icon text-red-600 mr-2" viewBox="0 0 24 24" fill="currentColor">
  <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
</svg>
                                    <span>çº¢è‰²ä¸»é¢˜</span>
                                    <svg x-show="theme === 'red'" class="w-4 h-4 ml-auto text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                                </button>
                                <button @click="setTheme('yellow'); open = false"
                                        class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors"
                                        :class="{ 'bg-yellow-50': theme === 'yellow' }">
                                    <svg class="icon text-yellow-600 mr-2" viewBox="0 0 24 24" fill="currentColor">
  <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
</svg>
                                    <span>é»„è‰²ä¸»é¢˜</span>
                                    <svg x-show="theme === 'yellow'" class="w-4 h-4 ml-auto" style="color: #d88c27;" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                                </button>
                                <button @click="setTheme('blue'); open = false"
                                        class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors"
                                        :class="{ 'bg-blue-50': theme === 'blue' }">
                                    <svg class="icon text-blue-600 mr-2" viewBox="0 0 24 24" fill="currentColor">
  <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
</svg>
                                    <span>è“è‰²ä¸»é¢˜</span>
                                    <svg x-show="theme === 'blue'" class="w-4 h-4 ml-auto text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                                </button>
                            </div>
                        </div> <!-- User Menu -->
                        <div x-data="{ open: false }" class="relative">
                            <button @click="open = !open" class="flex items-center space-x-2 text-gray-700 hover:text-gray-900">
                                <img :src="'https://ui-avatars.com/api/?name={{ user.username|urlencode }}&background=' + (theme === 'yellow' ? 'd88c27' : theme === 'red' ? 'ef4444' : theme === 'blue' ? '3b82f6' : '3b82f6') + '&color=fff'" alt="Avatar" class="w-8 h-8 rounded-full">
                                <span class="hidden md:block">{{ user.username }}</span>
                                <svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
</svg>
                            </button>
                            <div x-show="open" @click.away="open = false" x-cloak class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                                <a href="/admin/" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">ç³»ç»Ÿåå°</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">ä¸ªäººèµ„æ–™</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">è®¾ç½®</a>
                                <hr class="my-1">
                                <a href="{% url 'logout' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">é€€å‡ºç™»å½•</a>
                            </div>
                        </div>
                    </div>
                </div>
            </header> <!-- Page Content -->
            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50">
                <div class="container mx-auto px-6 py-8">
                    {% if messages %}
                    <div class="mb-6 space-y-2">
                        {% for message in messages %}
                        <div class="p-4 rounded-lg flex items-center justify-between shadow-sm {% if message.tags == 'error' %}bg-red-50 text-red-700 border border-red-200{% elif message.tags == 'success' %}bg-green-50 text-green-700 border border-green-200{% elif message.tags == 'warning' %}bg-yellow-50 text-yellow-700 border border-yellow-200{% else %}bg-theme-50 text-theme-700 border border-theme-200{% endif %}">
                            <div class="flex items-center">
                                {% if message.tags == 'error' %}
                                <svg class="icon mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>
                                {% elif message.tags == 'success' %}
                                <svg class="icon mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>
                                {% elif message.tags == 'warning' %}
                                <svg class="icon mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
</svg>
                                {% else %}
                                <svg class="icon mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>
                                {% endif %}
                                <span class="font-medium">{{ message }}</span>
                            </div>
                            <button onclick="this.parentElement.remove()" class="text-gray-400 hover:text-gray-600 transition-colors">
                                <svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
</svg>
                            </button>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %} {% block content %}{% endblock %}
                </div>
             </main>

             <!-- Footer é¡µè„š -->
             <footer class="bg-white border-t border-gray-200 mt-8">
                 <div class="container mx-auto px-6 py-8">
                     <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                         <!-- å…¬å¸ä¿¡æ¯ -->
                         <div>
                             <h3 class="text-lg font-semibold text-gray-900 mb-4">{{ company_name }}</h3>
                             {% if company_description %}
                             <p class="text-sm text-gray-600 mb-2">{{ company_description }}</p>
                             {% endif %}
                             {% if company_website %}
                             <a href="{{ company_website }}" target="_blank" class="text-sm text-theme-600 hover:text-theme-700">{{ company_website }}</a>
                             {% endif %}
                         </div>

                         <!-- è”ç³»æ–¹å¼ -->
                         <div>
                             <h3 class="text-lg font-semibold text-gray-900 mb-4">è”ç³»æ–¹å¼</h3>
                             <ul class="space-y-2 text-sm text-gray-600">
                                 {% if company_address %}
                                 <li class="flex items-start">
                                     <svg class="w-5 h-5 mr-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                     </svg>
                                     {{ company_address }}
                                 </li>
                                 {% endif %}
                                 {% if company_phone %}
                                 <li class="flex items-center">
                                     <svg class="w-5 h-5 mr-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 8V5z" />
                                     </svg>
                                     {{ company_phone }}
                                 </li>
                                 {% endif %}
                                 {% if company_email %}
                                 <li class="flex items-center">
                                     <svg class="w-5 h-5 mr-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                     </svg>
                                     <a href="mailto:{{ company_email }}" class="text-theme-600 hover:text-theme-700">{{ company_email }}</a>
                                 </li>
                                 {% endif %}
                             </ul>
                         </div>

                         <!-- æ³•äººä¿¡æ¯ -->
                         <div>
                             <h3 class="text-lg font-semibold text-gray-900 mb-4">ä¼ä¸šä¿¡æ¯</h3>
                             <ul class="space-y-2 text-sm text-gray-600">
                                 {% if company_code %}
                                 <li><span class="font-medium">å…¬å¸ä»£ç ï¼š</span>{{ company_code }}</li>
                                 {% endif %}
                                 {% if company_legal_representative %}
                                 <li><span class="font-medium">æ³•å®šä»£è¡¨äººï¼š</span>{{ company_legal_representative }}</li>
                                 {% endif %}
                                 {% if company_tax_number %}
                                 <li><span class="font-medium">ç¨å·ï¼š</span>{{ company_tax_number }}</li>
                                 {% endif %}
                             </ul>
                         </div>

                         <!-- ç‰ˆæƒä¿¡æ¯ -->
                         <div>
                             <h3 class="text-lg font-semibold text-gray-900 mb-4">&copy; {% now "Y" %}</h3>
                             <p class="text-sm text-gray-600 mb-2">{{ company_name }}. All rights reserved.</p>
                             <p class="text-xs text-gray-500">Powered by BetterLaser ERP System</p>
                         </div>
                     </div>
                 </div>
             </footer>

         </div>
     </div>

    <!-- æ—¥æœŸé€‰æ‹©å™¨å¢å¼º - ç¡®ä¿æ‰€æœ‰æ—¥æœŸè¾“å…¥æ¡†ç‚¹å‡»æ—¶ç›´æ¥å¼¹å‡ºæ—¥æœŸé€‰æ‹©å™¨ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dateInputs = document.querySelectorAll('input[type="date"]');
            dateInputs.forEach(function(input) {
                // ç‚¹å‡»æ—¶è§¦å‘æ—¥æœŸé€‰æ‹©å™¨
                input.addEventListener('click', function(e) {
                    // ä½¿ç”¨HTML5çš„showPicker() APIï¼ˆç°ä»£æµè§ˆå™¨æ”¯æŒï¼‰
                    if (typeof this.showPicker === 'function') {
                        this.showPicker();
                    }
                });
                // èšç„¦æ—¶ä¹Ÿè§¦å‘æ—¥æœŸé€‰æ‹©å™¨
                input.addEventListener('focus', function(e) {
                    if (typeof this.showPicker === 'function') {
                        // å»¶è¿Ÿè§¦å‘ä»¥ç¡®ä¿UIæ­£å¸¸æ¸²æŸ“
                        setTimeout(() => {
                            this.showPicker();
                        }, 10);
                    }
                });
            });
        });
    </script>

    <!-- Alpine.js å¯æœç´¢ä¸‹æ‹‰æ¡†ç»„ä»¶ -->
    <script>
        document.addEventListener('alpine:init', function() {
            Alpine.data('searchableSelect', function(options = [], initialValue = '') {
                return {
                    isOpen: false,
                    search: '',
                    selectedValue: initialValue,
                    selectedIndex: -1,
                    highlightIndex: -1,

                    get options() {
                        return typeof options === 'function' ? options() : options;
                    },

                    get filteredOptions() {
                        if (!this.search) return this.options;
                        const search = this.search.toLowerCase();
                        return this.options.filter(opt =>
                            String(opt.name || opt.label || opt).toLowerCase().includes(search) ||
                            String(opt.code || '').toLowerCase().includes(search)
                        );
                    },

                    get selectedOption() {
                        if (!this.selectedValue) return null;
                        return this.options.find(opt => opt.id == this.selectedValue || opt.value == this.selectedValue);
                    },

                    get displayValue() {
                        if (this.selectedOption) {
                            return this.selectedOption.name || this.selectedOption.label || this.selectedOption;
                        }
                        return this.search;
                    },

                    init() {
                        // å¦‚æœæ²¡æœ‰åˆå§‹å€¼ä¸”æœ‰é€‰é¡¹ï¼Œé»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ª
                        if (!this.selectedValue && this.options.length > 0) {
                            // ä¸è‡ªåŠ¨é€‰æ‹©ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©
                        }
                    },

                    selectOption(option) {
                        this.selectedValue = option.id || option.value;
                        this.search = '';
                        this.isOpen = false;
                        this.$dispatch('change', this.selectedValue);
                    },

                    toggleDropdown() {
                        this.isOpen = !this.isOpen;
                        if (this.isOpen) {
                            this.$nextTick(() => {
                                this.$refs.searchInput?.focus();
                            });
                        }
                    },

                    closeDropdown() {
                        this.isOpen = false;
                        this.search = '';
                        this.highlightIndex = -1;
                    },

                    handleKeydown(event) {
                        const filtered = this.filteredOptions;

                        switch(event.key) {
                            case 'ArrowDown':
                                event.preventDefault();
                                if (!this.isOpen) {
                                    this.isOpen = true;
                                } else {
                                    this.highlightIndex = Math.min(this.highlightIndex + 1, filtered.length - 1);
                                }
                                break;
                            case 'ArrowUp':
                                event.preventDefault();
                                this.highlightIndex = Math.max(this.highlightIndex - 1, -1);
                                break;
                            case 'Enter':
                                event.preventDefault();
                                if (this.isOpen && this.highlightIndex >= 0) {
                                    this.selectOption(filtered[this.highlightIndex]);
                                } else if (!this.isOpen) {
                                    this.toggleDropdown();
                                }
                                break;
                            case 'Escape':
                                this.closeDropdown();
                                break;
                            case 'Tab':
                                this.closeDropdown();
                                break;
                        }
                    },

                    highlightClass(index) {
                        return index === this.highlightIndex
                            ? 'bg-gray-100'
                            : 'hover:bg-gray-50';
                    }
                };
            });
        });
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>