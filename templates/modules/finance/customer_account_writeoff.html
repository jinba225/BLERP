{% extends 'layouts/base.html' %}

{% block title %}应收核销 - BetterLaser ERP{% endblock %}

{% block breadcrumb %}
<span class="mx-2 text-gray-400">/</span>
<a href="{% url 'finance:dashboard' %}" class="text-gray-500 hover:text-gray-700">往来款项</a>
<span class="mx-2 text-gray-400">/</span>
<a href="{% url 'finance:customer_account_list' %}" class="text-gray-500 hover:text-gray-700">应收账款</a>
<span class="mx-2 text-gray-400">/</span>
<span class="text-gray-900 font-semibold">核销</span>
{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto space-y-6">
    <div class="flex justify-between items-center">
        <div>
            <h3 class="text-lg font-semibold text-gray-900">应收核销</h3>
            <p class="text-sm text-gray-600 mt-1">客户：{{ account.customer.name }}</p>
            <p class="text-xs text-gray-500">发票号：{{ account.invoice_number|default:"-" }}，应收：¥{{ account.invoice_amount }}，已收：¥{{ account.paid_amount }}，余额：¥{{ account.balance }}</p>
        </div>
        <a href="{% url 'finance:customer_account_detail' account.pk %}" class="h-10 px-4 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-center">
            <svg class="icon mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
</svg>返回详情
        </a>
    </div> <form method="post" class="bg-white rounded-lg shadow overflow-hidden">
        {% csrf_token %} <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
            <h4 class="text-md font-semibold text-gray-900">核销信息</h4>
        </div>
        <div class="p-6 space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">核销金额</label>
                    <input type="number"
                           name="amount"
                           step="0.01"
                           min="0"
                           max="{{ account.balance }}"
                           placeholder="0.00"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-theme-500 ">
                    <p class="text-xs text-gray-500 mt-1">如选择预收款，总核销 = 预收款 + 核销金额。可填0仅使用预收款。</p>
                </div> <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">收款日期 <span class="text-red-500">*</span></label>
                    <input type="date"
                           name="payment_date"
                           required
                           value="{% now 'Y-m-d' %}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-theme-500 ">
                </div> <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">收款方式</label>
                    <select name="payment_method" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="">请选择收款方式</option>
                        {% for code, name in payment_methods %}
                        <option value="{{ code }}">{{ name }}</option>
                        {% endfor %}
                    </select>
                    <p class="text-xs text-gray-500 mt-1">若仅使用预收款抵扣，可留空</p>
                </div> <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">使用预收款（可选）</label>
                    <select name="prepayment" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <option value="">不使用预收款</option>
                        {% for p in prepays %}
                        <option value="{{ p.pk }}">{{ p.reference_number|default:'预收款' }} - 余额：¥{{ p.balance }}</option>
                        {% endfor %}
                    </select>
                </div> <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">备注</label>
                    <textarea name="notes" rows="3" placeholder="备注信息" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-theme-500 "></textarea>
                </div>
            </div>
        </div> <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3">
            <a href="{% url 'finance:customer_account_detail' account.pk %}" class="h-10 px-4 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-center">
                <svg class="icon mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
</svg>取消
            </a>
            <button class="btn btn-primary h-10 px-4" type="submit">
                <svg class="icon mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
</svg>确认核销
            </button>
        </div>
    </form>
</div>
{% endblock %}
