{% extends 'base.html' %}
{% load erp_filters %}
{% block title %}库存详情 - {{ stock.product.name }} - BetterLaser ERP{% endblock %}

{% block breadcrumb %}
<span class="mx-2 text-gray-400">/</span>
<a href="{% url 'inventory:stock_list' %}" class="text-gray-500 hover:text-gray-700">库存管理</a>
<span class="mx-2 text-gray-400">/</span>
<span class="text-gray-900 font-semibold">{{ stock.product.name }}</span>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto"><div class="flex justify-between items-center mb-6"><div><h3 class="text-2xl font-bold text-gray-900">{{ stock.product.name }}</h3><p class="text-sm text-gray-600 mt-1">{{ stock.product.code }} - {{ stock.warehouse.name }}</p></div></div>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6"><div class="bg-white rounded-lg shadow p-6"><h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b">产品信息</h4><dl class="space-y-2"><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">产品编码：</dt><dd class="text-sm text-gray-900">{{ stock.product.code }}</dd></div><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">产品名称：</dt><dd class="text-sm text-gray-900">{{ stock.product.name }}</dd></div><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">产品分类：</dt><dd class="text-sm text-gray-900">{{ stock.product.category.name|default:"-" }}</dd></div><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">产品型号：</dt><dd class="text-sm text-gray-900">{{ stock.product.model|default:"-" }}</dd></div><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">规格：</dt><dd class="text-sm text-gray-900">{{ stock.product.specifications|default:"-" }}</dd></div><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">计量单位：</dt><dd class="text-sm text-gray-900">{{ stock.product.unit.name|default:"-" }}</dd></div></dl></div><div class="bg-white rounded-lg shadow p-6"><h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b">库存信息</h4><dl class="space-y-2"><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">仓库：</dt><dd class="text-sm text-gray-900">{{ stock.warehouse.name }}</dd></div><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">库位：</dt><dd class="text-sm text-gray-900">{{ stock.location.name|default:"-" }}</dd></div><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">库存数量：</dt><dd class="text-sm text-gray-900 font-semibold">{{ stock.quantity }} {{ stock.product.unit.symbol|default:"" }}</dd></div><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">可用数量：</dt><dd class="text-sm text-green-600 font-semibold">{{ stock.available_quantity }} {{ stock.product.unit.symbol|default:"" }}</dd></div><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">预留数量：</dt><dd class="text-sm text-gray-900">{{ stock.reserved_quantity }} {{ stock.product.unit.symbol|default:"" }}</dd></div><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">成本价：</dt><dd class="text-sm text-gray-900">¥{{ stock.cost_price }}</dd></div><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">库存价值：</dt><dd class="text-sm text-theme-600 font-semibold">¥{{ stock.quantity|mul:stock.cost_price|floatformat:2 }}</dd></div><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">最后入库：</dt><dd class="text-sm text-gray-900">{{ stock.last_in_date|date:"Y-m-d H:i"|default:"-" }}</dd></div><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">最后出库：</dt><dd class="text-sm text-gray-900">{{ stock.last_out_date|date:"Y-m-d H:i"|default:"-" }}</dd></div><div class="flex"><dt class="w-32 text-sm font-medium text-gray-500">库存状态：</dt><dd class="text-sm">{% if stock.quantity == 0 %}<span class="px-2 py-1 text-xs font-semibold rounded bg-red-100 text-red-800">缺货</span>{% elif stock.is_low_stock %}<span class="px-2 py-1 text-xs font-semibold rounded bg-yellow-100 text-yellow-800">低库存</span>{% else %}<span class="px-2 py-1 text-xs font-semibold rounded bg-green-100 text-green-800">正常</span>{% endif %}</dd></div></dl></div></div>
<div class="bg-white rounded-lg shadow mb-6"><div class="px-6 py-4 border-b"><h4 class="text-lg font-semibold text-gray-900">近期交易记录</h4></div><div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">交易时间</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">交易类型</th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">数量</th><th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">单位成本</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">关联单据</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">批次号</th><th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">操作员</th></tr></thead><tbody class="bg-white divide-y divide-gray-200">{% for trans in transactions %}<tr class="hover:bg-gray-50"><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ trans.transaction_date|date:"Y-m-d H:i" }}</td><td class="px-6 py-4 whitespace-nowrap"><span class="px-2 py-1 text-xs font-semibold rounded {% if trans.transaction_type == 'in' or trans.transaction_type == 'return' %}bg-green-100 text-green-800{% elif trans.transaction_type == 'out' or trans.transaction_type == 'scrap' %}bg-red-100 text-red-800{% else %}bg-theme-100 text-theme-800{% endif %}">{{ trans.get_transaction_type_display }}</span></td><td class="px-6 py-4 whitespace-nowrap text-sm text-right font-medium {% if trans.transaction_type == 'in' or trans.transaction_type == 'return' %}text-green-600{% else %}text-red-600{% endif %}">{% if trans.transaction_type == 'in' or trans.transaction_type == 'return' %}+{% else %}-{% endif %}{{ trans.quantity }} {{ stock.product.unit.symbol|default:"" }}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900">¥{{ trans.unit_cost }}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ trans.reference_number|default:"-" }}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ trans.batch_number|default:"-" }}</td><td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ trans.operator.username|default:"-" }}</td></tr>{% empty %}<tr><td colspan="7" class="px-6 py-8 text-center text-gray-500">暂无交易记录</td></tr>{% endfor %}</tbody></table></div></div>
</div>
{% endblock %}
