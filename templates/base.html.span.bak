{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}BetterLaser ERP ç³»ç»Ÿ{% endblock %}</title> <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%233b82f6' width='100' height='100' rx='15'/%3E%3Ctext x='50' y='70' text-anchor='middle' fill='white' font-size='50' font-weight='bold' font-family='sans-serif'%3EBL%3C/text%3E%3C/svg%3E"> <!-- ç«‹å³åº”ç”¨ä¸»é¢˜ï¼ˆé˜²æ­¢é—ªçƒï¼‰ -->
    <script>
        (function() {
            try {
                const validThemes = ['blue', 'yellow', 'red'];
                const defaultTheme = 'blue'; // è¿ç§»é€»è¾‘ï¼šå¦‚æœæ—§çš„ 'theme' é”®å­˜åœ¨ä¸”æœ‰æ•ˆï¼ˆä¸æ˜¯ Django admin çš„å€¼ï¼‰ï¼Œè¿ç§»åˆ° 'erp_theme'
                const oldTheme = localStorage.getItem('theme');
                if (oldTheme && validThemes.includes(oldTheme) && !localStorage.getItem('erp_theme')) {
                    localStorage.setItem('erp_theme', oldTheme);
                    // ä¸åˆ é™¤æ—§é”®ï¼Œè®© Django admin ç»§ç»­ä½¿ç”¨
                } // ä¼˜å…ˆä½¿ç”¨å†…å­˜ä¸­ä¿å­˜çš„ä¸»é¢˜ï¼ˆé˜²æ­¢è¢«è¦†ç›–ï¼‰
                let themeToApply = window.__validTheme; // å¦‚æœå†…å­˜ä¸­æ²¡æœ‰ï¼Œå†è¯»å– localStorageï¼ˆä½¿ç”¨ erp_theme é¿å…ä¸ Django admin å†²çªï¼‰
                if (!themeToApply) {
                    const savedTheme = localStorage.getItem('erp_theme');
                    themeToApply = (savedTheme && validThemes.includes(savedTheme)) ? savedTheme : defaultTheme;
                } // åªåœ¨ä¸»é¢˜æ— æ•ˆæ—¶æ‰å†™å…¥é»˜è®¤ä¸»é¢˜ï¼ˆä¸è¦†ç›–ç°æœ‰æœ‰æ•ˆä¸»é¢˜ï¼‰
                const currentSaved = localStorage.getItem('erp_theme');
                if (!currentSaved || !validThemes.includes(currentSaved)) {
                    localStorage.setItem('erp_theme', themeToApply);
                } document.documentElement.setAttribute('data-theme', themeToApply);
                window.__validTheme = themeToApply;
            } catch (e) {
                document.documentElement.setAttribute('data-theme', 'blue');
            }
        })();
    </script> <!-- Tailwind CSSï¼ˆç¼–è¯‘åçš„ç‰ˆæœ¬ï¼‰ -->
    <link rel="stylesheet" href="{% static 'css/output.css' %}"> <!-- ä¸»é¢˜è‰²æ ·å¼ -->
    <style>
        :root {
            --theme-50: 239, 246, 255;
            --theme-100: 219, 234, 254;
            --theme-200: 191, 219, 254;
            --theme-300: 147, 197, 253;
            --theme-400: 96, 165, 250;
            --theme-500: 59, 130, 246;
            --theme-600: 37, 99, 235;
            --theme-700: 29, 78, 216;
            --theme-800: 30, 64, 175;
            --theme-900: 30, 58, 138;
        } [data-theme="blue"] {
            --theme-50: 239, 246, 255;
            --theme-100: 219, 234, 254;
            --theme-200: 191, 219, 254;
            --theme-300: 147, 197, 253;
            --theme-400: 96, 165, 250;
            --theme-500: 59, 130, 246;
            --theme-600: 37, 99, 235;
            --theme-700: 29, 78, 216;
            --theme-800: 30, 64, 175;
            --theme-900: 30, 58, 138;
        } [data-theme="yellow"] {
            --theme-50: 254, 252, 232;
            --theme-100: 254, 249, 195;
            --theme-200: 254, 240, 138;
            --theme-300: 253, 224, 71;
            --theme-400: 250, 204, 21;
            --theme-500: 234, 179, 8;
            --theme-600: 202, 138, 4;
            --theme-700: 161, 98, 7;
            --theme-800: 133, 77, 14;
            --theme-900: 113, 63, 18;
        } [data-theme="red"] {
            --theme-50: 254, 242, 242;
            --theme-100: 254, 226, 226;
            --theme-200: 254, 202, 202;
            --theme-300: 252, 165, 165;
            --theme-400: 248, 113, 113;
            --theme-500: 239, 68, 68;
            --theme-600: 220, 38, 38;
            --theme-700: 185, 28, 28;
            --theme-800: 153, 27, 27;
            --theme-900: 127, 29, 29;
        } /* ä½¿ç”¨ä¸»é¢˜è‰²çš„ç±» - Background */
        .bg-theme-50 { background-color: rgb(var(--theme-50)); }
        .bg-theme-100 { background-color: rgb(var(--theme-100)); }
        .bg-theme-200 { background-color: rgb(var(--theme-200)); }
        .bg-theme-300 { background-color: rgb(var(--theme-300)); }
        .bg-theme-400 { background-color: rgb(var(--theme-400)); }
        .bg-theme-500 { background-color: rgb(var(--theme-500)); }
        .bg-theme-600 { background-color: rgb(var(--theme-600)); }
        .bg-theme-700 { background-color: rgb(var(--theme-700)); }
        .bg-theme-800 { background-color: rgb(var(--theme-800)); }
        .bg-theme-900 { background-color: rgb(var(--theme-900)); } /* Hover Background */
        .hover\:bg-theme-50:hover { background-color: rgb(var(--theme-50)); }
        .hover\:bg-theme-100:hover { background-color: rgb(var(--theme-100)); }
        .hover\:bg-theme-200:hover { background-color: rgb(var(--theme-200)); }
        .hover\:bg-theme-300:hover { background-color: rgb(var(--theme-300)); }
        .hover\:bg-theme-400:hover { background-color: rgb(var(--theme-400)); }
        .hover\:bg-theme-500:hover { background-color: rgb(var(--theme-500)); }
        .hover\:bg-theme-600:hover { background-color: rgb(var(--theme-600)); }
        .hover\:bg-theme-700:hover { background-color: rgb(var(--theme-700)); }
        .hover\:bg-theme-800:hover { background-color: rgb(var(--theme-800)); }
        .hover\:bg-theme-900:hover { background-color: rgb(var(--theme-900)); } /* Text Color */
        .text-theme-50 { color: rgb(var(--theme-50)); }
        .text-theme-100 { color: rgb(var(--theme-100)); }
        .text-theme-200 { color: rgb(var(--theme-200)); }
        .text-theme-300 { color: rgb(var(--theme-300)); }
        .text-theme-400 { color: rgb(var(--theme-400)); }
        .text-theme-500 { color: rgb(var(--theme-500)); }
        .text-theme-600 { color: rgb(var(--theme-600)); }
        .text-theme-700 { color: rgb(var(--theme-700)); }
        .text-theme-800 { color: rgb(var(--theme-800)); }
        .text-theme-900 { color: rgb(var(--theme-900)); } /* Hover Text */
        .hover\:text-theme-50:hover { color: rgb(var(--theme-50)); }
        .hover\:text-theme-100:hover { color: rgb(var(--theme-100)); }
        .hover\:text-theme-200:hover { color: rgb(var(--theme-200)); }
        .hover\:text-theme-300:hover { color: rgb(var(--theme-300)); }
        .hover\:text-theme-400:hover { color: rgb(var(--theme-400)); }
        .hover\:text-theme-500:hover { color: rgb(var(--theme-500)); }
        .hover\:text-theme-600:hover { color: rgb(var(--theme-600)); }
        .hover\:text-theme-700:hover { color: rgb(var(--theme-700)); }
        .hover\:text-theme-800:hover { color: rgb(var(--theme-800)); }
        .hover\:text-theme-900:hover { color: rgb(var(--theme-900)); } /* Border Color */
        .border-theme-50 { border-color: rgb(var(--theme-50)); }
        .border-theme-100 { border-color: rgb(var(--theme-100)); }
        .border-theme-200 { border-color: rgb(var(--theme-200)); }
        .border-theme-300 { border-color: rgb(var(--theme-300)); }
        .border-theme-400 { border-color: rgb(var(--theme-400)); }
        .border-theme-500 { border-color: rgb(var(--theme-500)); }
        .border-theme-600 { border-color: rgb(var(--theme-600)); }
        .border-theme-700 { border-color: rgb(var(--theme-700)); }
        .border-theme-800 { border-color: rgb(var(--theme-800)); }
        .border-theme-900 { border-color: rgb(var(--theme-900)); } /* Ring/Shadow */
        .ring-theme-50 { --tw-ring-color: rgb(var(--theme-50)); }
        .ring-theme-100 { --tw-ring-color: rgb(var(--theme-100)); }
        .ring-theme-200 { --tw-ring-color: rgb(var(--theme-200)); }
        .ring-theme-300 { --tw-ring-color: rgb(var(--theme-300)); }
        .ring-theme-400 { --tw-ring-color: rgb(var(--theme-400)); }
        .ring-theme-500 { --tw-ring-color: rgb(var(--theme-500)); }
        .ring-theme-600 { --tw-ring-color: rgb(var(--theme-600)); }
        .ring-theme-700 { --tw-ring-color: rgb(var(--theme-700)); }
        .ring-theme-800 { --tw-ring-color: rgb(var(--theme-800)); }
        .ring-theme-900 { --tw-ring-color: rgb(var(--theme-900)); } /* Focus Ring */
        .focus\:ring-theme-50:focus { --tw-ring-color: rgb(var(--theme-50)); }
        .focus\:ring-theme-100:focus { --tw-ring-color: rgb(var(--theme-100)); }
        .focus\:ring-theme-200:focus { --tw-ring-color: rgb(var(--theme-200)); }
        .focus\:ring-theme-300:focus { --tw-ring-color: rgb(var(--theme-300)); }
        .focus\:ring-theme-400:focus { --tw-ring-color: rgb(var(--theme-400)); }
        .focus\:ring-theme-500:focus { --tw-ring-color: rgb(var(--theme-500)); }
        .focus\:ring-theme-600:focus { --tw-ring-color: rgb(var(--theme-600)); }
        .focus\:ring-theme-700:focus { --tw-ring-color: rgb(var(--theme-700)); }
        .focus\:ring-theme-800:focus { --tw-ring-color: rgb(var(--theme-800)); }
        .focus\:ring-theme-900:focus { --tw-ring-color: rgb(var(--theme-900)); } /* Focus Border */
        .focus\:border-theme-50:focus { border-color: rgb(var(--theme-50)); }
        .focus\:border-theme-100:focus { border-color: rgb(var(--theme-100)); }
        .focus\:border-theme-200:focus { border-color: rgb(var(--theme-200)); }
        .focus\:border-theme-300:focus { border-color: rgb(var(--theme-300)); }
        .focus\:border-theme-400:focus { border-color: rgb(var(--theme-400)); }
        .focus\:border-theme-500:focus { border-color: rgb(var(--theme-500)); }
        .focus\:border-theme-600:focus { border-color: rgb(var(--theme-600)); }
        .focus\:border-theme-700:focus { border-color: rgb(var(--theme-700)); }
        .focus\:border-theme-800:focus { border-color: rgb(var(--theme-800)); }
        .focus\:border-theme-900:focus { border-color: rgb(var(--theme-900)); } /* åŠ¨æ€ä¸»é¢˜è‰²æŒ‰é’®æ ·å¼ */
        .btn-primary {
            background-color: rgb(var(--theme-600));
            color: white;
        }
        .btn-primary:hover {
            background-color: rgb(var(--theme-700));
        }
        .btn-primary:focus {
            --tw-ring-color: rgb(var(--theme-500));
        } .btn-secondary {
            background-color: rgb(var(--theme-50));
            color: rgb(var(--theme-700));
            border: 1px solid rgb(var(--theme-200));
        }
        .btn-secondary:hover {
            background-color: rgb(var(--theme-100));
        }
        .btn-secondary:focus {
            --tw-ring-color: rgb(var(--theme-500));
        }
    </style>

    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Heroicons å›¾æ ‡åº“ -->
    <script src="{% static 'js/heroicons.js' %}"></script>

    <!-- Custom CSS -->
    <style>
        /* Alpine.js x-cloak æŒ‡ä»¤æ ·å¼ */
        [x-cloak] { display: none !important; }

        /* Alpine.js å¯æœç´¢ä¸‹æ‹‰æ¡†ç»„ä»¶æ ·å¼ */
        .searchable-select-wrapper {
            position: relative;
        }

        .searchable-select-input {
            width: 100%;
            padding: 0.625rem 0.75rem;  /* px-3 py-2 */
            border: 1px solid #d1d5db;  /* border-gray-300 */
            border-radius: 0.5rem;  /* rounded-lg */
            transition: all 0.2s;
            cursor: pointer;
            background-color: white;
        }

        .searchable-select-input:focus {
            outline: none;
            border-color: rgb(var(--theme-500));
            box-shadow: 0 0 0 2px rgb(var(--theme-500));
        }

        .searchable-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 0.25rem;
            background-color: white;
            border: 1px solid #e5e7eb;  /* border-gray-200 */
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            max-height: 15rem;  /* max-h-60 */
            overflow-y: auto;
            z-index: 9999 !important;
        }

        .searchable-select-option {
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            transition: background-color 0.15s;
        }

        .searchable-select-option:hover {
            background-color: #f9fafb;  /* hover:bg-gray-50 */
        }

        .searchable-select-option.highlighted {
            background-color: #f3f4f6;  /* bg-gray-100 */
        }

        .searchable-select-option.selected {
            background-color: rgb(var(--theme-50));
            color: rgb(var(--theme-700));
            font-weight: 500;
        }

        .searchable-select-arrow {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            transition: transform 0.2s;
        }

        .searchable-select-arrow.open {
            transform: translateY(-50%) rotate(180deg);
        }

        .sidebar-transition {
            transition: width 0.2s ease-in-out;
        }

        /* Alpine.js x-cloak æŒ‡ä»¤æ ·å¼ */
        [x-cloak] { display: none !important; }
    </style> {% block extra_css %}{% endblock %}
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50 font-sans antialiased">
    <div id="app" x-data="{
        sidebarOpen: false,
        sidebarCollapsed: localStorage.getItem('sidebarCollapsed') === 'true',
        theme: (function() {
            const validThemes = ['blue', 'yellow', 'red']; // ä¼˜å…ˆä½¿ç”¨å†…å­˜ä¸­ä¿å­˜çš„ä¸»é¢˜
            if (window.__validTheme && validThemes.includes(window.__validTheme)) {
                return window.__validTheme;
            } // å…¶æ¬¡ä½¿ç”¨ localStorageï¼ˆä½¿ç”¨ erp_theme é¿å…ä¸ Django admin å†²çªï¼‰
            const saved = localStorage.getItem('erp_theme');
            if (saved && validThemes.includes(saved)) {
                return saved;
            } // æœ€åæ‰ç”¨é»˜è®¤å€¼
            return 'blue';
        })(), // èœå•å±•å¼€çŠ¶æ€ç®¡ç†
        menuState: {}, init() {
            // ç¡®ä¿ä¸»é¢˜åŒæ­¥åˆ° localStorage å’Œå†…å­˜
            if (this.theme) {
                localStorage.setItem('erp_theme', this.theme);
                window.__validTheme = this.theme;
            } // åº”ç”¨ä¸»é¢˜
            this.applyTheme(); // ç›‘å¬å…¶ä»–æ ‡ç­¾é¡µçš„ localStorage å˜åŒ–
            window.addEventListener('storage', (e) => {
                if (e.key === 'erp_theme' && e.newValue) {
                    const validThemes = ['blue', 'yellow', 'red'];
                    if (validThemes.includes(e.newValue)) {
                        this.theme = e.newValue;
                        window.__validTheme = e.newValue;
                        this.applyTheme();
                    }
                }
            }); // é¡µé¢å¸è½½å‰ç¡®ä¿ä¸»é¢˜å·²ä¿å­˜ï¼ˆé˜²æ­¢è·³è½¬åˆ° admin åä¸¢å¤±ï¼‰
            window.addEventListener('beforeunload', () => {
                if (this.theme) {
                    localStorage.setItem('erp_theme', this.theme);
                    window.__validTheme = this.theme;
                }
            }); // ä» localStorage åŠ è½½èœå•çŠ¶æ€
            const saved = localStorage.getItem('menuState');
            if (saved) {
                try {
                    this.menuState = JSON.parse(saved);
                } catch (e) {
                    this.menuState = {};
                }
            } // æ ¹æ®å½“å‰ URL è‡ªåŠ¨å±•å¼€å¯¹åº”çš„èœå•
            const path = window.location.pathname; // ğŸ”§ ä¿®å¤æ‰‹é£ç´bugï¼šå…ˆå…³é—­æ‰€æœ‰èœå•ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªèœå•æ‰“å¼€
            Object.keys(this.menuState).forEach(key => {
                this.menuState[key] = false;
            }); // ç„¶åæ ¹æ®URLæ‰“å¼€å¯¹åº”çš„èœå•ï¼ˆæ³¨æ„ï¼šæ›´å…·ä½“çš„è·¯å¾„è¦å…ˆåŒ¹é…ï¼‰
            if (path.includes('/settings/database/')) {
                // æ•°æ®åº“ç®¡ç†å±äºç³»ç»Ÿç®¡ç†èœå•ï¼ˆä¼˜å…ˆåŒ¹é…å…·ä½“è·¯å¾„ï¼‰
                this.menuState.system = true;
            } else if (path.includes('/users/') || path.includes('/departments/') || path.includes('/admin/')) {
                this.menuState.system = true;
            } else if (path.includes('/settings/')) {
                // settings è·¯å¾„ä¼˜å…ˆåŒ¹é…
                this.menuState.basic_settings = true;
            } else if (path === '/products/' || path.includes('/products/units')) {
                // äº§å“ç®¡ç†å’Œè®¡é‡å•ä½å±äºåŸºç¡€è®¾ç½®èœå•
                this.menuState.basic_settings = true;
            } else if (path.includes('/finance/tax-rates')) {
                // ç¨ç‡è®¾ç½®å±äºåŸºç¡€è®¾ç½®èœå•
                this.menuState.basic_settings = true;
            } else if (path.includes('/inventory/warehouses') || path.includes('/inventory/import')) {
                // åº“ä½è®¾ç½®ã€åº“å­˜å¯¼å…¥åŠåˆå§‹åŒ–å±äºåŸºç¡€è®¾ç½®èœå•ï¼ˆå¿…é¡»åœ¨ /inventory/ ä¹‹å‰åŒ¹é…ï¼‰
                this.menuState.basic_settings = true;
            } else if (path.includes('/inventory/stocks') || path.includes('/inventory/transfers') ||
                       path.includes('/inventory/counts') || path.includes('/inventory/adjustments') ||
                       path.includes('/inventory/inbounds') || path.includes('/inventory/outbounds') ||
                       path.includes('/inventory/transactions') || path.includes('/inventory/reports')) {
                // åº“å­˜ç®¡ç†ç›¸å…³è·¯å¾„
                this.menuState.inventory = true;
            } else if (path.includes('/inventory/')) {
                // å…¶ä»– /inventory/ è·¯å¾„
                this.menuState.inventory = true;
            } else if (path.includes('/finance/customer-accounts') || path.includes('/finance/supplier-accounts') ||
                       path.includes('/finance/prepayments') || path.includes('/finance/journals') ||
                       path.includes('/finance/budgets') || path.includes('/finance/reports')) {
                // è´¢åŠ¡ç®¡ç†ç›¸å…³è·¯å¾„
                this.menuState.finance = true;
            } else if (path.includes('/finance/')) {
                // å…¶ä»– /finance/ è·¯å¾„
                this.menuState.finance = true;
            } else if (path.includes('/customers/')) {
                // å®¢æˆ·ç®¡ç†å½’å±é”€å”®æ¨¡å—
                this.menuState.sales = true;
            } else if (path.includes('/suppliers/')) {
                // ä¾›åº”å•†ç®¡ç†å½’å±é‡‡è´­æ¨¡å—
                this.menuState.purchase = true;
            } else if (path.includes('/sales/')) {
                this.menuState.sales = true;
            } else if (path.includes('/purchase/')) {
                this.menuState.purchase = true;
            } // ä¿å­˜çŠ¶æ€
            this.saveMenuState();
        }, toggleMenu(menuName) {
            // è®°å½•å½“å‰èœå•çš„çŠ¶æ€
            const currentState = this.menuState[menuName]; // å…³é—­æ‰€æœ‰èœå•
            Object.keys(this.menuState).forEach(key => {
                this.menuState[key] = false;
            }); // åˆ‡æ¢å½“å‰èœå•çŠ¶æ€ï¼ˆå¦‚æœä¹‹å‰æ˜¯å…³é—­çš„å°±æ‰“å¼€ï¼Œå¦‚æœä¹‹å‰æ˜¯æ‰“å¼€çš„å°±å…³é—­ï¼‰
            this.menuState[menuName] = !currentState; this.saveMenuState();
        }, saveMenuState() {
            localStorage.setItem('menuState', JSON.stringify(this.menuState));
        }, toggleCollapse() {
            this.sidebarCollapsed = !this.sidebarCollapsed;
            localStorage.setItem('sidebarCollapsed', this.sidebarCollapsed);
        }, setTheme(themeName) {
            // éªŒè¯ä¸»é¢˜æ˜¯å¦æœ‰æ•ˆ
            const validThemes = ['blue', 'yellow', 'red'];
            if (!validThemes.includes(themeName)) {
                themeName = 'blue';
            } this.theme = themeName;
            localStorage.setItem('erp_theme', themeName);
            window.__validTheme = themeName;
            this.applyTheme();
        }, applyTheme() {
            document.documentElement.setAttribute('data-theme', this.theme);
        }
    }" class="flex h-screen bg-gray-50">
        <!-- Sidebar -->
        <div class="fixed inset-y-0 left-0 z-50 bg-white shadow-2xl border-r border-gray-200 transform transition-all duration-300 ease-in-out lg:translate-x-0 lg:relative isolate"
             :class="{
                '-translate-x-full': !sidebarOpen,
                'translate-x-0': sidebarOpen,
                'w-48': !sidebarCollapsed,
                'w-14': sidebarCollapsed
             }">
            <!-- Logo åŒºåŸŸ -->
            <div class="flex items-center py-4 px-4 bg-theme-600 text-white relative h-16"
                 :class="{
                    'justify-between': !sidebarCollapsed,
                    'justify-center': sidebarCollapsed
                 }">
                <!-- Logo æ–‡å­— -->
                <h1 class="text-base font-semibold tracking-wide transition-all duration-200 whitespace-nowrap text-white"
                    :class="{
                        'opacity-0 w-0 hidden': sidebarCollapsed,
                        'opacity-100': !sidebarCollapsed
                    }">
                    BetterLaser ERP
                </h1>

                <!-- æŠ˜å /å±•å¼€æŒ‰é’®ï¼ˆç»Ÿä¸€æ ·å¼ï¼‰ -->
                <button @click="toggleCollapse()"
                        class="flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-full bg-transparent hover:bg-white/10 transition-all duration-200 hover:scale-105 active:scale-95"
                        :class="{
                            'ml-auto': !sidebarCollapsed,
                            'absolute': sidebarCollapsed
                        }"
                        :title="sidebarCollapsed ? 'å±•å¼€èœå•' : 'æŠ˜å èœå•'">
                    <i class="fas text-base text-white transition-transform duration-300"
                       :class="sidebarCollapsed ? 'fa-chevron-right' : 'fa-chevron-left'"></i>
                </button>
            </div>

            <!-- Navigation -->
            <nav class="mt-4 px-3 space-y-1 overflow-y-auto overflow-x-hidden" style="max-height: calc(100vh - 5.5rem);">
                <!-- Dashboard -->
                <div class="relative group/menu" x-data="{ tooltipTop: 0, buttonRight: 0 }" @mouseenter="tooltipTop = $el.getBoundingClientRect().top; buttonRight = $el.querySelector('a')?.getBoundingClientRect().right || $el.getBoundingClientRect().right">
                    <a href="{% url 'dashboard' %}"
                       class="relative flex items-center h-12 px-3 rounded-lg text-slate-700 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/link"
                       :class="{ 'justify-center w-10 mx-auto': sidebarCollapsed, 'w-full': !sidebarCollapsed }">
                        <!-- å›¾æ ‡ -->
                        <svg class="w-5 h-5 flex-shrink-0" :class="{ 'mr-0': sidebarCollapsed, 'mr-3': !sidebarCollapsed }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>

                        <!-- æ–‡å­— -->
                        <span class="relative font-medium transition-all duration-200 whitespace-nowrap text-base"
                              :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed }">
                            ä»ªè¡¨ç›˜
                        </span>

                        <!-- å·¦ä¾§æŒ‡ç¤ºæ¡ -->
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 rounded-r-full bg-theme-600 opacity-0 group-hover/link:opacity-100 transition-opacity duration-200"></div>
                    </a>

                    <!-- æŠ˜å çŠ¶æ€çš„ Tooltip -->
                    <div x-show="sidebarCollapsed"
                         x-transition:enter="transition ease-out duration-200"
                         x-transition:enter-start="opacity-0 scale-95"
                         x-transition:enter-end="opacity-100 scale-100"
                         class="fixed px-3 py-2 bg-slate-800 text-white text-sm font-medium rounded-lg shadow-xl whitespace-nowrap opacity-0 group-hover/menu:opacity-100 pointer-events-none transition-opacity duration-200 z-[9999]"
                         :style="'left: ' + buttonRight + 'px; top: ' + (tooltipTop + 20) + 'px'">
                        ä»ªè¡¨ç›˜
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 -translate-x-1 w-2 h-2 bg-slate-800 rotate-45"></div>
                    </div>
                </div>

                <!-- Purchase Management -->
                <div class="relative group/menu" x-data="{ menuTop: 0, buttonRight: 0 }"
                     @mouseenter="menuTop = $el.getBoundingClientRect().top; buttonRight = $el.querySelector('button')?.getBoundingClientRect().right || $el.getBoundingClientRect().right; if (sidebarCollapsed) $el.querySelector('.popup-child').classList.remove('invisible', 'opacity-0')"
                     @mouseleave="$el.querySelector('.popup-child').classList.add('invisible', 'opacity-0')">
                    <button @click="toggleMenu('purchase')"
                            :aria-expanded="menuState.purchase ? 'true' : 'false'"
                            aria-haspopup="true"
                            class="relative flex items-center h-12 w-full px-3 rounded-lg text-slate-700 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/link"
                            :class="{
                                'justify-center w-10 mx-auto': sidebarCollapsed,
                                'w-full': !sidebarCollapsed,
                                'bg-theme-100': menuState.purchase && !sidebarCollapsed
                            }">
                        <!-- å›¾æ ‡ -->
                        <svg class="w-5 h-5 flex-shrink-0" :class="{ 'mr-0': sidebarCollapsed, 'mr-3': !sidebarCollapsed }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>

                        <!-- æ–‡å­— -->
                        <span class="relative flex-grow text-left font-medium transition-all duration-200 whitespace-nowrap text-base"
                              :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed }">
                            é‡‡è´­ç®¡ç†
                        </span>

                        <!-- ç®­å¤´å›¾æ ‡ -->
                        <span class="text-xs transition-all duration-300 ease-in-out"
                           :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed, 'rotate-180': menuState.purchase }"
                           :style="!sidebarCollapsed ? 'margin-left: 0.125rem' : ''">â–¼</span>

                        <!-- å·¦ä¾§æŒ‡ç¤ºæ¡ -->
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 rounded-r-full bg-theme-600 transition-opacity duration-200"
                             :class="{ 'opacity-0 group-hover/link:opacity-100': !menuState.purchase, 'opacity-100': menuState.purchase }"></div>
                    </button>

                    <!-- Hover flyout for collapsed state -->
                    <div class="popup-child fixed w-48 rounded-xl bg-white shadow-2xl border border-slate-200 py-2 invisible opacity-0 transition-all duration-200 z-[9999]"
                         :style="'left: ' + buttonRight + 'px; top: ' + menuTop + 'px'">
                        <div class="px-3 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider border-b border-slate-100">
                            é‡‡è´­ç®¡ç†
                        </div>
                        <a href="{% url 'purchase:borrow_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é‡‡è´­å€Ÿç”¨</span>
                        </a>
                        <a href="/purchase/requests/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é‡‡è´­ç”³è¯·</span>
                        </a>
                        <a href="/purchase/orders/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é‡‡è´­è®¢å•</span>
                        </a>
                        <a href="/purchase/receipts/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">æ”¶è´§ç®¡ç†</span>
                        </a>
                        <a href="/purchase/returns/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é‡‡è´­é€€è´§</span>
                        </a>
                        <a href="{% url 'suppliers:supplier_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">ä¾›åº”å•†ç®¡ç†</span>
                        </a>
                        <a href="{% url 'purchase:order_report' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é‡‡è´­æŠ¥è¡¨</span>
                        </a>
                    </div>

                    <!-- Accordion for expanded state -->
                    <div x-show="!sidebarCollapsed && menuState.purchase"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 -translate-y-2"
                         x-transition:enter-end="opacity-100 translate-y-0"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0"
                         x-transition:leave-end="opacity-0 -translate-y-2"
                         class="mt-3 ml-5 space-y-0.5 border-l-2 border-theme-500 -ml-0.5 pl-3">
                        <a href="{% url 'purchase:borrow_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é‡‡è´­å€Ÿç”¨</span>
                        </a>
                        <a href="/purchase/requests/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é‡‡è´­ç”³è¯·</span>
                        </a>
                        <a href="/purchase/orders/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é‡‡è´­è®¢å•</span>
                        </a>
                        <a href="/purchase/receipts/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">æ”¶è´§ç®¡ç†</span>
                        </a>
                        <a href="/purchase/returns/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é‡‡è´­é€€è´§</span>
                        </a>
                        <a href="{% url 'suppliers:supplier_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">ä¾›åº”å•†ç®¡ç†</span>
                        </a>
                        <a href="{% url 'purchase:order_report' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é‡‡è´­æŠ¥è¡¨</span>
                        </a>
                    </div>
                </div>

                <!-- Sales Management -->
                <div class="relative group/menu" x-data="{ menuTop: 0, buttonRight: 0 }"
                     @mouseenter="menuTop = $el.getBoundingClientRect().top; buttonRight = $el.querySelector('button')?.getBoundingClientRect().right || $el.getBoundingClientRect().right; if (sidebarCollapsed) $el.querySelector('.popup-child').classList.remove('invisible', 'opacity-0')"
                     @mouseleave="$el.querySelector('.popup-child').classList.add('invisible', 'opacity-0')">
                    <button @click="toggleMenu('sales')"
                            class="relative flex items-center h-12 w-full px-3 rounded-lg text-slate-700 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/link"
                            :class="{
                                'justify-center w-10 mx-auto': sidebarCollapsed,
                                'w-full': !sidebarCollapsed,
                                'bg-theme-100': menuState.sales && !sidebarCollapsed
                            }">

                        <!-- å›¾æ ‡ -->
                        <svg class="w-5 h-5 flex-shrink-0" :class="{ 'mr-0': sidebarCollapsed, 'mr-3': !sidebarCollapsed }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                        </svg>

                        <!-- æ–‡å­— -->
                        <span class="relative flex-grow text-left font-medium transition-all duration-200 whitespace-nowrap text-base"
                              :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed }">
                            é”€å”®ç®¡ç†
                        </span>

                        <!-- ç®­å¤´å›¾æ ‡ -->
                        <span class="text-xs transition-all duration-300 ease-in-out"
                           :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed, 'rotate-180': menuState.sales }"
                           :style="!sidebarCollapsed ? 'margin-left: 0.125rem' : ''">â–¼</span>

                        <!-- å·¦ä¾§æŒ‡ç¤ºæ¡ -->
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 rounded-r-full bg-theme-600 transition-opacity duration-200"
                             :class="{ 'opacity-0 group-hover/link:opacity-100': !menuState.sales, 'opacity-100': menuState.sales }"></div>
                    </button>

                    <!-- Hover submenu for collapsed state -->
                    <div class="popup-child fixed w-48 rounded-xl bg-white shadow-2xl border border-slate-200 py-2 invisible opacity-0 transition-all duration-200 z-[9999]"
                         :style="'left: ' + buttonRight + 'px; top: ' + menuTop + 'px'">
                        <div class="px-3 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider border-b border-slate-100">
                            é”€å”®ç®¡ç†
                        </div>
                        <a href="{% url 'sales:loan_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é”€å”®å€Ÿç”¨</span>
                        </a>
                        <a href="{% url 'sales:quote_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é”€å”®æŠ¥ä»·</span>
                        </a>
                        <a href="{% url 'sales:order_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é”€å”®è®¢å•</span>
                        </a>
                        <a href="{% url 'sales:delivery_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">å‘è´§ç®¡ç†</span>
                        </a>
                        <a href="{% url 'sales:return_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é”€å”®é€€è´§</span>
                        </a>
                        <a href="{% url 'customers:customer_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">å®¢æˆ·ç®¡ç†</span>
                        </a>
                        <a href="{% url 'sales:order_report' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é”€å”®æŠ¥è¡¨</span>
                        </a>
                    </div>

                    <!-- Accordion submenu for expanded state -->
                    <div x-show="!sidebarCollapsed && menuState.sales"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 -translate-y-2"
                         x-transition:enter-end="opacity-100 translate-y-0"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0"
                         x-transition:leave-end="opacity-0 -translate-y-2"
                         class="mt-3 ml-5 space-y-0.5 border-l-2 border-theme-500 -ml-0.5 pl-3">
                        <a href="{% url 'sales:loan_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é”€å”®å€Ÿç”¨</span>
                        </a>
                        <a href="{% url 'sales:quote_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é”€å”®æŠ¥ä»·</span>
                        </a>
                        <a href="{% url 'sales:order_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é”€å”®è®¢å•</span>
                        </a>
                        <a href="{% url 'sales:delivery_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">å‘è´§ç®¡ç†</span>
                        </a>
                        <a href="{% url 'sales:return_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é”€å”®é€€è´§</span>
                        </a>
                        <a href="{% url 'customers:customer_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">å®¢æˆ·ç®¡ç†</span>
                        </a>
                        <a href="{% url 'sales:order_report' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é”€å”®æŠ¥è¡¨</span>
                        </a>
                    </div>
                </div>

                <!-- Inventory Management -->
                <div class="relative group/menu" x-data="{ menuTop: 0, buttonRight: 0 }"
                     @mouseenter="menuTop = $el.getBoundingClientRect().top; buttonRight = $el.querySelector('button')?.getBoundingClientRect().right || $el.getBoundingClientRect().right; if (sidebarCollapsed) $el.querySelector('.popup-child').classList.remove('invisible', 'opacity-0')"
                     @mouseleave="$el.querySelector('.popup-child').classList.add('invisible', 'opacity-0')">
                    <button @click="toggleMenu('inventory')"
                            :aria-expanded="menuState.inventory ? 'true' : 'false'"
                            aria-haspopup="true"
                            class="relative flex items-center h-12 w-full px-3 rounded-lg text-slate-700 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/link"
                            :class="{
                                'justify-center w-10 mx-auto': sidebarCollapsed,
                                'w-full': !sidebarCollapsed,
                                'bg-theme-100': menuState.inventory && !sidebarCollapsed
                            }">
                        <svg class="w-5 h-5 flex-shrink-0" :class="{ 'mr-0': sidebarCollapsed, 'mr-3': !sidebarCollapsed }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                        </svg>
                        <span class="relative flex-grow text-left font-medium transition-all duration-200 whitespace-nowrap text-base"
                              :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed }">
                            åº“å­˜ç®¡ç†
                        </span>
                        <span class="text-xs transition-all duration-300 ease-in-out"
                           :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed, 'rotate-180': menuState.inventory }"
                           :style="!sidebarCollapsed ? 'margin-left: 0.125rem' : ''">â–¼</span>
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 rounded-r-full bg-theme-600 transition-opacity duration-200"
                             :class="{ 'opacity-0 group-hover/link:opacity-100': !menuState.inventory, 'opacity-100': menuState.inventory }"></div>
                    </button>
                    <div class="popup-child fixed w-48 rounded-xl bg-white shadow-2xl border border-slate-200 py-2 invisible opacity-0 transition-all duration-200 z-[9999]"
                         :style="'left: ' + buttonRight + 'px; top: ' + menuTop + 'px'">
                        <div class="px-3 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider border-b border-slate-100">åº“å­˜ç®¡ç†</div>
                        <a href="/inventory/stocks/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº“å­˜æŸ¥è¯¢</span>
                        </a>
                        <a href="/inventory/transfers/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº“å­˜è°ƒæ‹¨</span>
                        </a>
                        <a href="/inventory/counts/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº“å­˜ç›˜ç‚¹</span>
                        </a>
                        <a href="/inventory/adjustments/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº“å­˜è°ƒæ•´</span>
                        </a>
                        <a href="{% url 'inventory:inventory_order_report' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº“å­˜æŠ¥è¡¨</span>
                        </a>
                    </div>
                    <div x-show="!sidebarCollapsed && menuState.inventory"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 -translate-y-2"
                         x-transition:enter-end="opacity-100 translate-y-0"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0"
                         x-transition:leave-end="opacity-0 -translate-y-2"
                         class="mt-3 ml-5 space-y-0.5 border-l-2 border-theme-500 -ml-0.5 pl-3">
                        <a href="/inventory/stocks/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº“å­˜æŸ¥è¯¢</span>
                        </a>
                        <a href="/inventory/transfers/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº“å­˜è°ƒæ‹¨</span>
                        </a>
                        <a href="/inventory/counts/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº“å­˜ç›˜ç‚¹</span>
                        </a>
                        <a href="/inventory/adjustments/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº“å­˜è°ƒæ•´</span>
                        </a>
                        <a href="{% url 'inventory:inventory_order_report' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº“å­˜æŠ¥è¡¨</span>
                        </a>
                    </div>
                </div>

                <!-- Finance Management -->
                <div class="relative group/menu" x-data="{ menuTop: 0, buttonRight: 0 }"
                     @mouseenter="menuTop = $el.getBoundingClientRect().top; buttonRight = $el.querySelector('button')?.getBoundingClientRect().right || $el.getBoundingClientRect().right; if (sidebarCollapsed) $el.querySelector('.popup-child').classList.remove('invisible', 'opacity-0')"
                     @mouseleave="$el.querySelector('.popup-child').classList.add('invisible', 'opacity-0')">
                    <button @click="toggleMenu('finance')"
                            :aria-expanded="menuState.finance ? 'true' : 'false'"
                            aria-haspopup="true"
                            class="relative flex items-center h-12 w-full px-3 rounded-lg text-slate-700 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/link"
                            :class="{
                                'justify-center w-10 mx-auto': sidebarCollapsed,
                                'w-full': !sidebarCollapsed,
                                'bg-theme-100': menuState.finance && !sidebarCollapsed
                            }">
                        <svg class="w-5 h-5 flex-shrink-0" :class="{ 'mr-0': sidebarCollapsed, 'mr-3': !sidebarCollapsed }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        <span class="relative flex-grow text-left font-medium transition-all duration-200 whitespace-nowrap text-base"
                              :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed }">
                            å¾€æ¥æ¬¾é¡¹
                        </span>
                        <span class="text-xs transition-all duration-300 ease-in-out"
                           :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed, 'rotate-180': menuState.finance }"
                           :style="!sidebarCollapsed ? 'margin-left: 0.125rem' : ''">â–¼</span>
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 rounded-r-full bg-theme-600 transition-opacity duration-200"
                             :class="{ 'opacity-0 group-hover/link:opacity-100': !menuState.finance, 'opacity-100': menuState.finance }"></div>
                    </button>
                    <div class="popup-child fixed w-56 rounded-xl bg-white shadow-2xl border border-slate-200 py-2 invisible opacity-0 transition-all duration-200 z-[9999]"
                         :style="'left: ' + buttonRight + 'px; top: ' + menuTop + 'px'">
                        <div class="px-3 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider border-b border-slate-100">å¾€æ¥æ¬¾é¡¹</div>
                        <a href="/finance/customer-accounts/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº”æ”¶è´¦æ¬¾</span>
                        </a>
                        <a href="/finance/supplier-accounts/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº”ä»˜è´¦æ¬¾</span>
                        </a>
                        <a href="/finance/prepayments/customer/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é¢„æ”¶æ¬¾</span>
                        </a>
                        <a href="/finance/prepayments/supplier/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">é¢„ä»˜æ¬¾</span>
                        </a>
                        <a href="{% url 'finance:account_report' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">å¾€æ¥æŠ¥è¡¨</span>
                        </a>
                        <a href="{% url 'finance:report_list' %}" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">è´¢åŠ¡æŠ¥è¡¨</span>
                        </a>
                    </div>
                    <div x-show="!sidebarCollapsed && menuState.finance"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 -translate-y-2"
                         x-transition:enter-end="opacity-100 translate-y-0"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0"
                         x-transition:leave-end="opacity-0 -translate-y-2"
                         class="mt-3 ml-5 space-y-0.5 border-l-2 border-theme-500 -ml-0.5 pl-3">
                        <a href="/finance/customer-accounts/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº”æ”¶è´¦æ¬¾</span>
                        </a>
                        <a href="/finance/supplier-accounts/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº”ä»˜è´¦æ¬¾</span>
                        </a>
                        <a href="/finance/prepayments/customer/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é¢„æ”¶æ¬¾</span>
                        </a>
                        <a href="/finance/prepayments/supplier/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">é¢„ä»˜æ¬¾</span>
                        </a>
                        <a href="{% url 'finance:account_report' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">å¾€æ¥æŠ¥è¡¨</span>
                        </a>
                        <a href="{% url 'finance:report_list' %}" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">è´¢åŠ¡æŠ¥è¡¨</span>
                        </a>
                    </div>
                </div>

                <!-- Basic Settings -->
                <div class="relative group/menu" x-data="{ menuTop: 0, buttonRight: 0 }"
                     @mouseenter="menuTop = $el.getBoundingClientRect().top; buttonRight = $el.querySelector('button')?.getBoundingClientRect().right || $el.getBoundingClientRect().right; if (sidebarCollapsed) $el.querySelector('.popup-child').classList.remove('invisible', 'opacity-0')"
                     @mouseleave="$el.querySelector('.popup-child').classList.add('invisible', 'opacity-0')">
                    <button @click="toggleMenu('basic_settings')"
                            :aria-expanded="menuState.basic_settings ? 'true' : 'false'"
                            aria-haspopup="true"
                            class="relative flex items-center h-12 w-full px-3 rounded-lg text-slate-700 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/link"
                            :class="{
                                'justify-center w-10 mx-auto': sidebarCollapsed,
                                'w-full': !sidebarCollapsed,
                                'bg-theme-100': menuState.basic_settings && !sidebarCollapsed
                            }">
                        <svg class="w-5 h-5 flex-shrink-0" :class="{ 'mr-0': sidebarCollapsed, 'mr-3': !sidebarCollapsed }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        <span class="relative flex-grow text-left font-medium transition-all duration-200 whitespace-nowrap text-base"
                              :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed }">
                            åŸºç¡€è®¾ç½®
                        </span>
                        <span class="text-xs transition-all duration-300 ease-in-out"
                           :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed, 'rotate-180': menuState.basic_settings }"
                           :style="!sidebarCollapsed ? 'margin-left: 0.125rem' : ''">â–¼</span>
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 rounded-r-full bg-theme-600 transition-opacity duration-200"
                             :class="{ 'opacity-0 group-hover/link:opacity-100': !menuState.basic_settings, 'opacity-100': menuState.basic_settings }"></div>
                    </button>
                    <div class="popup-child fixed w-56 rounded-xl bg-white shadow-2xl border border-slate-200 py-2 invisible opacity-0 transition-all duration-200 z-[9999]"
                         :style="'left: ' + buttonRight + 'px; top: ' + menuTop + 'px'">
                        <div class="px-3 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider border-b border-slate-100">åŸºç¡€è®¾ç½®</div>
                        <a href="/products/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">äº§å“ç®¡ç†</span>
                        </a>
                        <a href="/inventory/warehouses/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">åº“ä½è®¾ç½®</span>
                        </a>
                        <a href="/products/units/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">è®¡é‡å•ä½</span>
                        </a>
                        <a href="/finance/tax-rates/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">ç¨ç‡è®¾ç½®</span>
                        </a>
                        <a href="/settings/print-templates/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">æ‰“å°æ¨¡æ¿</span>
                        </a>
                        <a href="/inventory/import/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">å¯¼å…¥ä¸åˆå§‹åŒ–</span>
                        </a>
                    </div>
                    <div x-show="!sidebarCollapsed && menuState.basic_settings"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 -translate-y-2"
                         x-transition:enter-end="opacity-100 translate-y-0"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0"
                         x-transition:leave-end="opacity-0 -translate-y-2"
                         class="mt-3 ml-5 space-y-0.5 border-l-2 border-theme-500 -ml-0.5 pl-3">
                        <a href="/products/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">äº§å“ç®¡ç†</span>
                        </a>
                        <a href="/inventory/warehouses/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">åº“ä½è®¾ç½®</span>
                        </a>
                        <a href="/products/units/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">è®¡é‡å•ä½</span>
                        </a>
                        <a href="/finance/tax-rates/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">ç¨ç‡è®¾ç½®</span>
                        </a>
                        <a href="/settings/print-templates/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">æ‰“å°æ¨¡æ¿</span>
                        </a>
                        <a href="/inventory/import/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">å¯¼å…¥ä¸åˆå§‹åŒ–</span>
                        </a>
                    </div>
                </div>

                <!-- System Management -->
                <div class="relative group/menu" x-data="{ menuTop: 0, buttonRight: 0 }"
                     @mouseenter="menuTop = $el.getBoundingClientRect().top; buttonRight = $el.querySelector('button')?.getBoundingClientRect().right || $el.getBoundingClientRect().right; if (sidebarCollapsed) $el.querySelector('.popup-child').classList.remove('invisible', 'opacity-0')"
                     @mouseleave="$el.querySelector('.popup-child').classList.add('invisible', 'opacity-0')">
                    <button @click="toggleMenu('system')"
                            :aria-expanded="menuState.system ? 'true' : 'false'"
                            aria-haspopup="true"
                            class="relative flex items-center h-12 w-full px-3 rounded-lg text-slate-700 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/link"
                            :class="{
                                'justify-center w-10 mx-auto': sidebarCollapsed,
                                'w-full': !sidebarCollapsed,
                                'bg-theme-100': menuState.system && !sidebarCollapsed
                            }">
                        <svg class="w-5 h-5 flex-shrink-0" :class="{ 'mr-0': sidebarCollapsed, 'mr-3': !sidebarCollapsed }" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 11-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 004.486-6.336l-3.276 3.277a3.004 3.004 0 01-2.25-2.25l3.276-3.276a4.5 4.5 0 00-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437l1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008z" />
                        </svg>
                        <span class="relative flex-grow text-left font-medium transition-all duration-200 whitespace-nowrap text-base"
                              :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed }">
                            ç³»ç»Ÿç®¡ç†
                        </span>
                        <span class="text-xs transition-all duration-300 ease-in-out"
                           :class="{ 'opacity-0 w-0 hidden': sidebarCollapsed, 'opacity-100': !sidebarCollapsed, 'rotate-180': menuState.system }"
                           :style="!sidebarCollapsed ? 'margin-left: 0.125rem' : ''">â–¼</span>
                        <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 rounded-r-full bg-theme-600 transition-opacity duration-200"
                             :class="{ 'opacity-0 group-hover/link:opacity-100': !menuState.system, 'opacity-100': menuState.system }"></div>
                    </button>
                    <div class="popup-child fixed w-56 rounded-xl bg-white shadow-2xl border border-slate-200 py-2 invisible opacity-0 transition-all duration-200 z-[9999]"
                         :style="'left: ' + buttonRight + 'px; top: ' + menuTop + 'px'">
                        <div class="px-3 py-2 text-xs font-semibold text-slate-500 uppercase tracking-wider border-b border-slate-100">ç³»ç»Ÿç®¡ç†</div>
                        <a href="/users/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">ç”¨æˆ·ç®¡ç†</span>
                        </a>
                        <a href="/users/roles/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">è§’è‰²æƒé™</span>
                        </a>
                        <a href="/departments/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">éƒ¨é—¨ç®¡ç†</span>
                        </a>
                        <a href="/settings/database/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">æ•°æ®åº“ç®¡ç†</span>
                        </a>
                        <a href="/admin/" class="flex items-center px-4 py-2.5 text-sm text-slate-700 hover:bg-gradient-to-r hover:from-theme-50 hover:to-theme-100/50 hover:text-theme-700 transition-all duration-200 group/submenu">
                            <span class="ml-2">ç³»ç»Ÿé…ç½®</span>
                        </a>
                    </div>
                    <div x-show="!sidebarCollapsed && menuState.system"
                         x-transition:enter="transition ease-out duration-300"
                         x-transition:enter-start="opacity-0 -translate-y-2"
                         x-transition:enter-end="opacity-100 translate-y-0"
                         x-transition:leave="transition ease-in duration-200"
                         x-transition:leave-start="opacity-100 translate-y-0"
                         x-transition:leave-end="opacity-0 -translate-y-2"
                         class="mt-3 ml-5 space-y-0.5 border-l-2 border-theme-500 -ml-0.5 pl-3">
                        <a href="/users/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">ç”¨æˆ·ç®¡ç†</span>
                        </a>
                        <a href="/users/roles/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">è§’è‰²æƒé™</span>
                        </a>
                        <a href="/departments/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">éƒ¨é—¨ç®¡ç†</span>
                        </a>
                        <a href="/settings/database/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">æ•°æ®åº“ç®¡ç†</span>
                        </a>
                        <a href="/admin/" class="flex items-center h-10 px-3 rounded-lg text-slate-600 hover:text-theme-600 hover:bg-theme-50 transition-all duration-200 group/submenu">
                            <span class="text-sm font-medium">ç³»ç»Ÿé…ç½®</span>
                        </a>
                    </div>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Top Header -->
            <header class="bg-white shadow-sm border-b border-gray-200">
                <div class="flex items-center justify-between px-6 py-4">
                    <div class="flex items-center">
                        <button @click="sidebarOpen = !sidebarOpen" class="lg:hidden text-gray-500 hover:text-gray-700">
                            <svg x-data="heroicon('bars-3')" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>
                        </button> <!-- Breadcrumb Navigation -->
                        <nav class="ml-4 flex items-center space-x-2 text-sm">
                            <a href="{% url 'dashboard' %}" class="text-gray-500 hover:text-gray-700">
                                <svg x-data="heroicon('home')" class="mr-1" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>é¦–é¡µ
                            </a>
                            {% block breadcrumb %}{% endblock %}
                        </nav>
                    </div> <div class="flex items-center space-x-4">
                        <!-- Notifications -->
                        <div x-data="{ open: false }" class="relative">
                            <button @click="open = !open" class="text-gray-500 hover:text-gray-700 relative">
                                <svg x-data="heroicon('bell')" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>
                                <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">3</span>
                            </button>
                            <div x-show="open" @click.away="open = false" x-cloak class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                                <div class="p-4 border-b border-gray-200">
                                    <h3 class="text-lg font-semibold">é€šçŸ¥</h3>
                                </div>
                                <div class="max-h-64 overflow-y-auto">
                                    <div class="p-4 border-b border-gray-100 hover:bg-gray-50">
                                        <p class="text-sm text-gray-800">æ–°çš„é”€å”®è®¢å•å¾…å¤„ç†</p>
                                        <p class="text-xs text-gray-500 mt-1">5åˆ†é’Ÿå‰</p>
                                    </div>
                                    <div class="p-4 border-b border-gray-100 hover:bg-gray-50">
                                        <p class="text-sm text-gray-800">åº“å­˜é¢„è­¦ï¼šäº§å“Aåº“å­˜ä¸è¶³</p>
                                        <p class="text-xs text-gray-500 mt-1">1å°æ—¶å‰</p>
                                    </div>
                                    <div class="p-4 hover:bg-gray-50">
                                        <p class="text-sm text-gray-800">é‡‡è´­è®¢å•å·²å®¡æ ¸é€šè¿‡</p>
                                        <p class="text-xs text-gray-500 mt-1">2å°æ—¶å‰</p>
                                    </div>
                                </div>
                            </div>
                        </div> <!-- Theme Switcher -->
                        <div x-data="{ open: false }" class="relative">
                            <button @click="open = !open" class="text-gray-500 hover:text-gray-700 relative" title="åˆ‡æ¢ä¸»é¢˜">
                                <svg x-data="heroicon('sparkles')" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>
                            </button>
                            <div x-show="open" @click.away="open = false" x-cloak class="absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                                <button @click="setTheme('red'); open = false"
                                        class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors"
                                        :class="{ 'bg-red-50': theme === 'red' }">
                                    <svg x-data="heroicon('circle')" class="text-red-600 mr-2" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>
                                    <span>çº¢è‰²ä¸»é¢˜</span>
                                    <i x-show="theme === 'red'" class="fas fa-check ml-auto text-red-600"></i>
                                </button>
                                <button @click="setTheme('yellow'); open = false"
                                        class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors"
                                        :class="{ 'bg-yellow-50': theme === 'yellow' }">
                                    <svg x-data="heroicon('circle')" class="mr-2" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>
                                    <span>é»„è‰²ä¸»é¢˜</span>
                                    <i x-show="theme === 'yellow'" class="fas fa-check ml-auto" style="color: #d88c27;"></i>
                                </button>
                                <button @click="setTheme('blue'); open = false"
                                        class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors"
                                        :class="{ 'bg-blue-50': theme === 'blue' }">
                                    <svg x-data="heroicon('circle')" class="text-blue-600 mr-2" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>
                                    <span>è“è‰²ä¸»é¢˜</span>
                                    <i x-show="theme === 'blue'" class="fas fa-check ml-auto text-blue-600"></i>
                                </button>
                            </div>
                        </div> <!-- User Menu -->
                        <div x-data="{ open: false }" class="relative">
                            <button @click="open = !open" class="flex items-center space-x-2 text-gray-700 hover:text-gray-900">
                                <img :src="'https://ui-avatars.com/api/?name={{ user.username|urlencode }}&background=' + (theme === 'yellow' ? 'd88c27' : theme === 'red' ? 'ef4444' : theme === 'blue' ? '3b82f6' : '3b82f6') + '&color=fff'" alt="Avatar" class="w-8 h-8 rounded-full">
                                <span class="hidden md:block">{{ user.username }}</span>
                                <svg x-data="heroicon('chevron-down')" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>
                            </button>
                            <div x-show="open" @click.away="open = false" x-cloak class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                                <a href="/admin/" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">ç³»ç»Ÿåå°</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">ä¸ªäººèµ„æ–™</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">è®¾ç½®</a>
                                <hr class="my-1">
                                <a href="{% url 'logout' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">é€€å‡ºç™»å½•</a>
                            </div>
                        </div>
                    </div>
                </div>
            </header> <!-- Page Content -->
            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-50">
                <div class="container mx-auto px-6 py-8">
                    {% if messages %}
                    <div class="mb-6 space-y-2">
                        {% for message in messages %}
                        <div class="p-4 rounded-lg flex items-center justify-between shadow-sm {% if message.tags == 'error' %}bg-red-50 text-red-700 border border-red-200{% elif message.tags == 'success' %}bg-green-50 text-green-700 border border-green-200{% elif message.tags == 'warning' %}bg-yellow-50 text-yellow-700 border border-yellow-200{% else %}bg-theme-50 text-theme-700 border border-theme-200{% endif %}">
                            <div class="flex items-center">
                                {% if message.tags == 'error' %}
                                <svg x-data="heroicon('x-circle')" class="mr-3 text-lg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>
                                {% elif message.tags == 'success' %}
                                <svg x-data="heroicon('check-circle')" class="mr-3 text-lg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>
                                {% elif message.tags == 'warning' %}
                                <svg x-data="heroicon('exclamation-triangle')" class="mr-3 text-lg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>
                                {% else %}
                                <svg x-data="heroicon('information-circle')" class="mr-3 text-lg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>
                                {% endif %}
                                <span class="font-medium">{{ message }}</span>
                            </div>
                            <button onclick="this.parentElement.remove()" class="text-gray-400 hover:text-gray-600 transition-colors">
                                <svg x-data="heroicon('x-mark')" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>
                            </button>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %} {% block content %}{% endblock %}
                </div>
            </main>
        </div>
    </div> <!-- Mobile Sidebar Overlay -->
    <div x-show="sidebarOpen" @click="sidebarOpen = false" x-cloak class="fixed inset-0 z-40 bg-black bg-opacity-50 lg:hidden"></div>

    <!-- æ—¥æœŸé€‰æ‹©å™¨å¢å¼º - ç¡®ä¿æ‰€æœ‰æ—¥æœŸè¾“å…¥æ¡†ç‚¹å‡»æ—¶ç›´æ¥å¼¹å‡ºæ—¥æœŸé€‰æ‹©å™¨ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dateInputs = document.querySelectorAll('input[type="date"]');
            dateInputs.forEach(function(input) {
                // ç‚¹å‡»æ—¶è§¦å‘æ—¥æœŸé€‰æ‹©å™¨
                input.addEventListener('click', function(e) {
                    // ä½¿ç”¨HTML5çš„showPicker() APIï¼ˆç°ä»£æµè§ˆå™¨æ”¯æŒï¼‰
                    if (typeof this.showPicker === 'function') {
                        this.showPicker();
                    }
                });
                // èšç„¦æ—¶ä¹Ÿè§¦å‘æ—¥æœŸé€‰æ‹©å™¨
                input.addEventListener('focus', function(e) {
                    if (typeof this.showPicker === 'function') {
                        // å»¶è¿Ÿè§¦å‘ä»¥ç¡®ä¿UIæ­£å¸¸æ¸²æŸ“
                        setTimeout(() => {
                            this.showPicker();
                        }, 10);
                    }
                });
            });
        });
    </script>

    <!-- Heroicons Alpine.js ç»„ä»¶ -->
    <script>
        document.addEventListener('alpine:init', function() {
            // Heroicons å›¾æ ‡ç»„ä»¶
            Alpine.data('heroicon', (name) => ({
                iconName: name,

                init() {
                    // ç¡®ä¿ window.HeroiconsPaths å·²åŠ è½½
                    if (!window.HeroiconsPaths) {
                        console.error('âŒ window.HeroiconsPaths not loaded');
                        return;
                    }

                    const svgData = window.HeroiconsPaths[this.iconName];
                    if (!svgData) {
                        console.error(`âŒ Heroicon "${this.iconName}" not found in HeroiconsPaths`);
                        console.error('Available icons:', Object.keys(window.HeroiconsPaths));
                        return;
                    }

                    // è·å– SVG å…ƒç´ å¹¶è®¾ç½® viewBox
                    const svg = this.$el;
                    if (svg.tagName !== 'SVG') {
                        console.error('âŒ heroicon component must be used on <svg> element');
                        return;
                    }

                    // è®¾ç½® viewBoxï¼ˆå¦‚æœè¿˜æ²¡æœ‰è®¾ç½®ï¼‰
                    if (!svg.getAttribute('viewBox')) {
                        svg.setAttribute('viewBox', svgData.viewBox || '0 0 24 24');
                    }

                    // åˆ›å»º path å…ƒç´ 
                    const namespace = 'http://www.w3.org/2000/svg';
                    const path = document.createElementNS(namespace, 'path');
                    path.setAttribute('stroke-linecap', 'round');
                    path.setAttribute('stroke-linejoin', 'round');
                    path.setAttribute('d', svgData.outline);

                    // æ¸…ç©º SVG å¹¶æ·»åŠ  path
                    svg.innerHTML = '';
                    svg.appendChild(path);

                    console.log(`âœ… Heroicon "${this.iconName}" loaded successfully`);
                }
            }));
        });
    </script>

    <!-- Alpine.js å¯æœç´¢ä¸‹æ‹‰æ¡†ç»„ä»¶ -->
    <script>
        document.addEventListener('alpine:init', function() {
            Alpine.data('searchableSelect', function(options = [], initialValue = '') {
                return {
                    isOpen: false,
                    search: '',
                    selectedValue: initialValue,
                    selectedIndex: -1,
                    highlightIndex: -1,

                    get options() {
                        return typeof options === 'function' ? options() : options;
                    },

                    get filteredOptions() {
                        if (!this.search) return this.options;
                        const search = this.search.toLowerCase();
                        return this.options.filter(opt =>
                            String(opt.name || opt.label || opt).toLowerCase().includes(search) ||
                            String(opt.code || '').toLowerCase().includes(search)
                        );
                    },

                    get selectedOption() {
                        if (!this.selectedValue) return null;
                        return this.options.find(opt => opt.id == this.selectedValue || opt.value == this.selectedValue);
                    },

                    get displayValue() {
                        if (this.selectedOption) {
                            return this.selectedOption.name || this.selectedOption.label || this.selectedOption;
                        }
                        return this.search;
                    },

                    init() {
                        // å¦‚æœæ²¡æœ‰åˆå§‹å€¼ä¸”æœ‰é€‰é¡¹ï¼Œé»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ª
                        if (!this.selectedValue && this.options.length > 0) {
                            // ä¸è‡ªåŠ¨é€‰æ‹©ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©
                        }
                    },

                    selectOption(option) {
                        this.selectedValue = option.id || option.value;
                        this.search = '';
                        this.isOpen = false;
                        this.$dispatch('change', this.selectedValue);
                    },

                    toggleDropdown() {
                        this.isOpen = !this.isOpen;
                        if (this.isOpen) {
                            this.$nextTick(() => {
                                this.$refs.searchInput?.focus();
                            });
                        }
                    },

                    closeDropdown() {
                        this.isOpen = false;
                        this.search = '';
                        this.highlightIndex = -1;
                    },

                    handleKeydown(event) {
                        const filtered = this.filteredOptions;

                        switch(event.key) {
                            case 'ArrowDown':
                                event.preventDefault();
                                if (!this.isOpen) {
                                    this.isOpen = true;
                                } else {
                                    this.highlightIndex = Math.min(this.highlightIndex + 1, filtered.length - 1);
                                }
                                break;
                            case 'ArrowUp':
                                event.preventDefault();
                                this.highlightIndex = Math.max(this.highlightIndex - 1, -1);
                                break;
                            case 'Enter':
                                event.preventDefault();
                                if (this.isOpen && this.highlightIndex >= 0) {
                                    this.selectOption(filtered[this.highlightIndex]);
                                } else if (!this.isOpen) {
                                    this.toggleDropdown();
                                }
                                break;
                            case 'Escape':
                                this.closeDropdown();
                                break;
                            case 'Tab':
                                this.closeDropdown();
                                break;
                        }
                    },

                    highlightClass(index) {
                        return index === this.highlightIndex
                            ? 'bg-gray-100'
                            : 'hover:bg-gray-50';
                    }
                };
            });
        });
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>