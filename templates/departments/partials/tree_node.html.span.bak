<!-- Tree node partial template for recursive rendering -->
<div class="ml-{{ level|add:"0" }}" style="margin-left: {{ level }}rem;">
    <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:border-theme-600 hover:shadow transition-all mb-2 bg-white">
        <div class="flex-1">
            <div class="flex items-center">
                <svg x-data="heroicon('building')" class="text-theme-600 mr-3" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>
                <div>
                    <a href="{% url 'departments:department_detail' department.pk %}"
                       class="text-lg font-semibold text-gray-900 hover:text-theme-600">
                        {{ department.name }}
                    </a>
                    <p class="text-sm text-gray-500">{{ department.code }}</p>
                </div>
            </div>
        </div>
        <div class="flex items-center space-x-6 text-sm text-gray-600">
            {% if department.manager %}
                <div class="flex items-center">
                    <svg x-data="heroicon('user')" class="text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>
                    <span>{{ department.manager.get_full_name|default:department.manager.username }}</span>
                </div>
            {% endif %}
            <div class="flex items-center">
                <svg x-data="heroicon('users')" class="text-gray-400 mr-2" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" x-cloak><span x-html="svg"></span></svg>
                <span>{{ department.get_employee_count }} 人</span>
            </div>
            {% if department.is_active %}
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                    启用
                </span>
            {% else %}
                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                    停用
                </span>
            {% endif %}
        </div>
    </div>

    <!-- Recursively render children -->
    {% if department.children.all %}
        <div class="ml-8 mt-2 space-y-2">
            {% for child in department.children.all %}
                {% include 'departments/partials/tree_node.html' with department=child level=level|add:"1" %}
            {% endfor %}
        </div>
    {% endif %}
</div>
