# 采购相关明细表字段对比

## 当前字段对比

### PurchaseOrderItem (采购订单明细) - 标准
| 字段 | 类型 | 说明 |
|------|------|------|
| purchase_order | ForeignKey | 采购订单 |
| product | ForeignKey | 产品 |
| **quantity** | Decimal(12,4) | 数量 |
| **unit_price** | Decimal(10,2) | 单价 |
| **discount_rate** | Decimal(5,2) | 折扣率(%) |
| **discount_amount** | Decimal(12,2) | 折扣金额 |
| **line_total** | Decimal(12,2) | 行总计 |
| **required_date** | DateField | 要求交期 |
| **notes** | TextField | 备注 |
| **sort_order** | PositiveInteger | 排序 |
| received_quantity | Decimal(12,4) | 已收货数量 |

### PurchaseRequestItem (采购申请明细) - 需要统一
| 字段 | 类型 | 说明 | 状态 |
|------|------|------|------|
| purchase_request | ForeignKey | 采购申请 | ✓ |
| product | ForeignKey | 产品 | ✓ |
| **quantity** | Decimal(12,4) | 申请数量 | ✓ |
| **estimated_price** | Decimal(10,2) | 预估单价 | ❌ 应改为 unit_price |
| **estimated_total** | Decimal(12,2) | 预估总价 | ❌ 应改为 line_total |
| - | - | 折扣率 | ❌ 缺少 discount_rate |
| - | - | 折扣金额 | ❌ 缺少 discount_amount |
| - | - | 要求交期 | ❌ 缺少 required_date |
| **notes** | TextField | 备注 | ✓ |
| **sort_order** | PositiveInteger | 排序 | ✓ |
| preferred_supplier | ForeignKey | 首选供应商 | ✓ 特有字段 |
| specifications | TextField | 规格要求 | ✓ 特有字段 |

### BorrowItem (借用明细) - 需要统一
| 字段 | 类型 | 说明 | 状态 |
|------|------|------|------|
| borrow | ForeignKey | 借用单 | ✓ |
| product | ForeignKey | 产品 | ✓ |
| **quantity** | Decimal(12,4) | 借用数量 | ✓ |
| - | - | 单价 | ❌ 缺少 unit_price |
| - | - | 折扣率 | ❌ 缺少 discount_rate |
| - | - | 折扣金额 | ❌ 缺少 discount_amount |
| - | - | 行总计 | ❌ 缺少 line_total |
| - | - | 要求交期 | ❌ 缺少 required_date |
| - | - | 备注 | ❌ 缺少 notes |
| - | - | 排序 | ❌ 缺少 sort_order |
| returned_quantity | Decimal(12,4) | 已归还数量 | ✓ 特有字段 |
| batch_number | CharField | 批次号 | ✓ 特有字段 |
| serial_numbers | TextField | 序列号 | ✓ 特有字段 |
| conversion_unit_price | Decimal(10,2) | 转采购单价 | ✓ 特有字段 |
| conversion_quantity | Decimal(12,4) | 转采购数量 | ✓ 特有字段 |

## 统一方案建议

### 方案一：完全统一（推荐）
所有明细表都包含标准字段 + 各自的特殊字段

**标准字段（必需）：**
- product (产品)
- quantity (数量)
- unit_price (单价)
- discount_rate (折扣率%)
- discount_amount (折扣金额)
- line_total (行总计)
- required_date (要求交期)
- notes (备注)
- sort_order (排序)

**PurchaseRequestItem 特有字段：**
- preferred_supplier (首选供应商)
- specifications (规格要求)

**BorrowItem 特有字段：**
- returned_quantity (已归还数量)
- batch_number (批次号)
- serial_numbers (序列号)
- conversion_unit_price (转采购单价)
- conversion_quantity (转采购数量)

### 方案二：保持兼容
保留原有字段名，添加缺失字段

**PurchaseRequestItem：**
- 保留 estimated_price（向后兼容）
- 添加 unit_price = estimated_price（别名）
- 保留 estimated_total（向后兼容）
- 添加 line_total = estimated_total（别名）
- 添加 discount_rate, discount_amount, required_date

**BorrowItem：**
- 添加 unit_price, discount_rate, discount_amount, line_total, required_date, notes, sort_order

## 需要的数据库迁移

无论哪种方案都需要创建迁移文件来添加新字段。
