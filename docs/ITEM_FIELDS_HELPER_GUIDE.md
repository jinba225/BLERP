# 明细字段助手使用指南

## 📦 功能概述

**明细字段助手**是打印模板设计器中的快速布局工具，帮助用户一键生成标准的明细表格字段布局，无需逐个拖拽字段。

**核心优势：**
- ⚡ 快速：一键添加6-12个字段（传统拖拽需要5-10分钟）
- 🎯 精准：预设布局经过优化，确保字段不重叠
- 🔧 灵活：提供3种预设组合 + 手动微调
- 📐 对齐：内置水平对齐和均匀分布工具

---

## 🚀 快速开始

### 打开明细助手

在打印模板编辑器中，点击工具栏的 **"明细助手"** 按钮（紫色图标）。

```
工具栏位置:
[预览] [测试打印] [画布尺寸] [明细助手 ⭐] [清空]
                                    ↑
                                  点这里
```

---

## 📊 三种预设组合

### 1️⃣ 简洁版（6列）

**包含字段：**
```
序号 | 产品名称 | 规格型号 | 数量 | 单价 | 小计
 40     180        150       60     80     90   (px)
```

**适用场景：**
- ✅ 日常报价单
- ✅ 简易出货单
- ✅ 内部领料单
- ✅ 快速询价单

**推荐纸张：**
- A4纵向（总宽670px，适合）
- A5横向

**特点：**
- 突出核心信息
- 布局紧凑，适合明细项多的单据
- 省纸、打印快

**案例：**
```
报价单示例（简洁版）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
序号  产品名称        规格型号          数量  单价      小计
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1     激光切割机A    10W红外激光器      2    15000.00  30000.00
2     激光切割机B    20W蓝光激光器      1    28000.00  28000.00
3     冷却系统       工业冷水机         2    5000.00   10000.00
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
                                              合计      68000.00
```

---

### 2️⃣ 标准版（9列）

**包含字段：**
```
序号 | 编码 | 产品名称 | 规格型号 | 数量 | 单位 | 单价 | 小计 | 交货期
 35    90      140        120       50     40     70     80     70    (px)
```

**适用场景：**
- ✅ 正式商业报价单
- ✅ 采购订单
- ✅ 销售合同附件
- ✅ 生产订单

**推荐纸张：**
- A4横向（总宽795px，适合）
- A3纵向

**特点：**
- 信息完整，包含产品编码和交货期
- 适合正式商务场合
- 便于追溯（有编码）

**案例：**
```
报价单示例（标准版）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
序号  编码       产品名称        规格型号        数量  单位  单价      小计      交货期
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1     BL-001    激光切割机A    10W红外激光器    2     台   15000.00  30000.00  30天
2     BL-002    激光切割机B    20W蓝光激光器    1     台   28000.00  28000.00  45天
3     CL-101    冷却系统       工业冷水机       2     台   5000.00   10000.00  15天
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
                                                              合计      68000.00
```

---

### 3️⃣ 完整版（12列）

**包含字段：**
```
序号 | 编码 | 名称 | 规格 | 数量 | 单位 | 单价 | 折扣 | 税率 | 小计 | 交期 | 备注
 30    80    120   100    45     35     65     45     40     75     60    100  (px)
```

**适用场景：**
- ✅ 详细报价单（含折扣、税率）
- ✅ 合同附件
- ✅ 正式投标文件
- ✅ 出口报价单

**推荐纸张：**
- A3纵向（总宽925px，适合）
- A4横向（较挤，需调整字体）

**特点：**
- 包含所有字段
- 适合正式、重要的商务文档
- 信息最完整

**案例：**
```
报价单示例（完整版）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
序号  编码     名称          规格          数量  单位  单价      折扣  税率  小计      交期  备注
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1     BL-001  激光切割机A  10W红外激光器  2     台   15000.00  5%    13%  28215.00  30天  含安装
2     BL-002  激光切割机B  20W蓝光激光器  1     台   28000.00  -     13%  31640.00  45天  定制
3     CL-101  冷却系统     工业冷水机     2     台   5000.00   10%   13%  10170.00  15天  -
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
                                                                      合计      70025.00
```

---

## 🔧 对齐和调整工具

### 水平对齐

**功能：** 将所有明细字段对齐到同一条水平线上。

**使用场景：**
- 手动拖拽字段后，发现字段高低不一
- 应用预设组合后，想微调某个字段但不小心拖偏了

**操作：**
1. 确保画布中有至少2个明细项字段
2. 点击"水平对齐"按钮
3. 系统会将所有字段的Y坐标设为第一个字段的Y坐标

**效果对比：**
```
对齐前:
序号    产品名称
  ↓        ↓
  Y=100    Y=105  ← 不对齐！

对齐后:
序号    产品名称
  ↓        ↓
  Y=100    Y=100  ← 完美对齐！
```

---

### 均匀分布

**功能：** 自动计算并调整字段间距，让字段均匀分布。

**使用场景：**
- 字段之间间距不均匀
- 想让表格看起来更整齐

**操作：**
1. 确保画布中有至少3个明细项字段
2. 点击"均匀分布"按钮
3. 系统会按X坐标排序，然后计算均匀间距

**效果对比：**
```
分布前:
[序号]   [名称]             [数量]  [金额]
  20      60                 420     580
  ↑       ↑                  ↑       ↑
  间距40   间距360            间距160  ← 不均匀

分布后:
[序号]     [名称]     [数量]     [金额]
  20        200        380        560
  ↑         ↑          ↑          ↑
  间距180    间距180     间距180    ← 完美均匀
```

---

### 清除字段

**功能：** 一键删除画布中所有明细项字段。

**使用场景：**
- 想重新开始设计
- 切换到不同的预设组合

**操作：**
1. 点击"清除字段"按钮（红色）
2. 确认提示（此操作不可恢复！）
3. 所有明细项字段被删除，其他元素保留

**注意：**
- 只删除明细项字段（field以`items.#.`开头的元素）
- 标题、公司信息等其他元素不受影响

---

## ⚙️ 行高设置

### 什么是行高？

行高决定了打印时每一行明细项之间的垂直间距。

```
行高示例:

行高 = 20px (紧凑)           行高 = 30px (标准)           行高 = 40px (宽松)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1  产品A  10  1000.00        1  产品A  10  1000.00
2  产品B  5   500.00
3  产品C  2   200.00         2  产品B  5   500.00         1  产品A  10  1000.00
4  产品D  8   800.00
   ↕20px                     3  产品C  2   200.00
适合30+行明细                   ↕30px                     2  产品B  5   500.00
                             适合10-20行明细                ↕40px
                                                          适合5-10行明细
```

### 如何设置行高？

1. 在明细助手面板中，找到"行间距设置"
2. 拖动滑块选择行高（20-40px）
3. 点击"应用"按钮
4. 设置会保存到`window.itemFieldsRowHeight`全局变量

### 推荐值

| 场景 | 推荐行高 | 理由 |
|------|---------|------|
| 明细项多（>20行） | 20-22px | 节省纸张，适合长表格 |
| 标准明细（10-20行） | 25-28px | 平衡清晰度和紧凑度 |
| 明细项少（<10行） | 30-35px | 视觉舒适，留白充足 |
| 大字体模板 | 35-40px | 防止字体重叠 |

### 高级：修改打印默认行高

行高设置在打印时生效。如需永久修改默认值，编辑 `quote_print_hiprint.html`:

```javascript
// 找到第525行左右
var rowHeight = calculateRowHeight(fieldGroups) || 25;

// 改为
var rowHeight = calculateRowHeight(fieldGroups) || 30;  // 改成你想要的值
```

---

## 📈 状态显示

明细助手面板底部会实时显示画布中明细字段的状态。

### 状态示例

**未添加字段时：**
```
ℹ️ 画布中尚未添加明细字段
从左侧元素库的"📦 明细项字段"分类中拖拽字段到画布即可开始设计
```

**已添加字段时：**
```
ℹ️ 已添加 6 个明细字段：
序号、产品名称、规格型号、数量、单价、小计
```

---

## 💡 最佳实践

### 推荐工作流程

```
第1步：选择纸张
      ↓
   点击"画布尺寸"，选择A4/A3等

第2步：添加基础元素
      ↓
   拖拽"标题"、"公司信息"、"报价单号"等到画布

第3步：使用明细助手
      ↓
   点击"明细助手"，选择预设组合（简洁版/标准版/完整版）

第4步：微调（可选）
      ↓
   手动调整个别字段的位置、宽度、字体

第5步：对齐
      ↓
   使用"水平对齐"或"均匀分布"工具优化布局

第6步：保存模板
      ↓
   点击"保存模板"

第7步：测试
      ↓
   打开报价单详情，点击"打印"查看效果
```

---

### 常见设计模式

#### 模式1：标题 + 简洁明细

```
┌─────────────────────────────────┐
│        [公司Logo]  报价单        │
│                                  │
│  报价单号: BL-Q-001              │
│  客户: 示例公司                  │
│                                  │
│  ──────────────────────────────  │
│  [明细字段 - 简洁版6列]          │
│  ──────────────────────────────  │
│                                  │
│  合计: 68000.00                  │
└─────────────────────────────────┘

适合：A4纵向，日常使用
```

#### 模式2：双栏信息 + 标准明细

```
┌─────────────────────────────────────────────┐
│  [Logo]  报价单                              │
│                                              │
│  客户信息：                   公司信息：     │
│  名称：XX公司                 名称：XX公司   │
│  地址：...                    地址：...      │
│                                              │
│  ──────────────────────────────────────────  │
│  [明细字段 - 标准版9列]                      │
│  ──────────────────────────────────────────  │
│                                              │
│  小计：60000  税额：7800  合计：67800        │
└─────────────────────────────────────────────┘

适合：A4横向或A3纵向，正式报价
```

#### 模式3：完整信息 + 完整明细

```
┌─────────────────────────────────────────────────────┐
│  [Logo]  销售报价单  [二维码]                        │
│                                                      │
│  报价单号：BL-Q-001  日期：2025-01-07  有效期：30天   │
│                                                      │
│  客户：XX公司  联系人：张三  电话：138xxxxxxxx        │
│  地址：广东省深圳市南山区...                          │
│                                                      │
│  ────────────────────────────────────────────────────  │
│  [明细字段 - 完整版12列]                             │
│  ────────────────────────────────────────────────────  │
│                                                      │
│  小计：60000  折扣：3000  税前：57000  税额：7410    │
│  合计：64410                                         │
│                                                      │
│  付款条款：预付30%，发货前付清余款                    │
│  交付条款：下单后30-45天内交付                        │
│  质保条款：整机质保1年，核心部件质保2年               │
└─────────────────────────────────────────────────────┘

适合：A3纵向，正式商务文档
```

---

## ⚠️ 注意事项

### 1. 纸张尺寸适配

不同预设组合对应不同的最小纸张宽度：

| 预设组合 | 总宽度 | 最小纸张 | 推荐纸张 |
|---------|--------|---------|---------|
| 简洁版 | ~670px | A4纵向 | A4纵向 ⭐ |
| 标准版 | ~795px | A4横向 | A4横向、A3纵向 ⭐ |
| 完整版 | ~925px | A3纵向 | A3纵向 ⭐ |

**提示：**
- 1mm ≈ 3.78px（96 DPI）
- A4纵向可打印宽度：约600-650px
- A4横向可打印宽度：约800-850px
- A3纵向可打印宽度：约850-900px

### 2. 字段顺序

预设组合的字段顺序是固定的，如需调整：
1. 先应用预设组合
2. 手动拖动字段调整X坐标
3. 使用"均匀分布"重新计算间距

### 3. 与手动拖拽混用

完全支持！推荐策略：
```
1. 使用明细助手添加基础字段（如简洁版6列）
2. 从元素库手动拖拽额外字段（如"备注"）
3. 调整位置、宽度
4. 使用"水平对齐"统一对齐
5. 保存
```

### 4. 删除部分字段

如果想删除预设组合中的某个字段：
1. 在画布中选中该字段
2. 按`Delete`键或通过属性面板删除
3. 其他字段不受影响

### 5. 行高修改生效时机

- **设计时：** 行高修改不影响画布显示（因为画布只显示第一行）
- **打印时：** 行高修改生效，影响明细项之间的间距

---

## 🐛 常见问题

### Q1: 点击预设组合后没有反应？

**可能原因：**
- 画布未初始化

**解决方法：**
1. 检查画布是否显示"正在加载..."
2. 等待加载完成后重试
3. 按Ctrl+F5刷新页面

---

### Q2: 添加的字段位置不对？

**可能原因：**
- 画布中已有元素，系统自动在下方添加

**解决方法：**
1. 选中所有明细字段
2. 手动拖动到目标位置
3. 使用"水平对齐"对齐

---

### Q3: 字段重叠了？

**可能原因：**
- 手动调整后X坐标冲突

**解决方法：**
1. 使用"均匀分布"重新计算间距
2. 或手动调整字段宽度和间距

---

### Q4: 打印时字段没有循环？

**可能原因：**
- 字段的field属性不正确

**解决方法：**
1. 在画布中选中字段
2. 检查右侧属性面板中的"字段"值
3. 确保是`items.#.xxx`格式
4. 如不对，手动修改

---

### Q5: 行高设置不生效？

**原因：**
- 行高在打印渲染时生效，设计时不显示

**验证：**
1. 保存模板
2. 打开报价单详情页
3. 点击"打印"
4. 查看预览

---

## 📚 相关文档

- **明细字段拖拽指南：** `ITEM_FIELDS_DRAG_GUIDE.md`
- **画布尺寸设置：** `CANVAS_SIZE_GUIDE.md`
- **纸张尺寸参考：** `PAPER_SIZE_REFERENCE.md`

---

**文档版本：** v1.0
**更新日期：** 2025-01-07
**功能状态：** ✅ 已完成
**维护者：** BetterLaser ERP 开发团队
