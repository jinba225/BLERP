# 公司信息配置功能使用说明

## 📋 功能概述

本功能允许在Django Admin后台配置公司信息，这些信息会自动显示在以下位置：
- ✅ 登录页面（公司Logo、名称、描述）
- ✅ 导航栏（公司Logo、名称）
- ✅ 所有页面标题
- ✅ 页脚（完整公司信息）
- ✅ 支持中/英文国际化
- ✅ 自动缓存优化

## 🚀 快速开始

### 1. 访问Admin后台

访问：http://127.0.0.1:8000/admin/

使用管理员账号登录。

### 2. 进入公司信息管理

导航到：`系统设置 - 核心配置` -> `公司信息`

### 3. 创建/编辑公司信息

#### 基本信息
- **公司名称**: 显示在前端的公司名称
- **公司代码**: 唯一的公司代码（建议：BLERP）
- **是否启用**: 控制是否显示此公司信息

#### 公司信息
- **法定代表人**: 公司法人代表
- **注册号**: 公司注册号
- **税号**: 公司税务登记号

#### 联系方式
- **地址**: 公司办公地址
- **电话**: 联系电话
- **传真**: 传真号码
- **邮箱**: 公司邮箱
- **网站**: 公司官网URL

#### Logo和描述
- **公司Logo**: 上传公司Logo图片
  - **建议尺寸**: 导航栏Logo推荐 100x40px（宽扁形）
  - 登录页Logo推荐 80x80px（正方形或圆形）
  - 支持的格式: JPG, PNG, GIF等

- **公司描述** (中文): 中文公司描述
  - 示例: "企业资源规划管理系统"

- **Company Description (English)**: 英文公司描述
  - 示例: "Enterprise Resource Planning System"
  - 当用户切换到英文时显示此描述

## 📝 配置示例

### 示例配置

```
公司名称: BetterLaser ERP
公司代码: BLERP
法定代表人: 张三
注册号: 1234567890123456789
税号: 91310000MA1B2C34
地址: 北京市朝阳区XXX大厦10层1001室
电话: 010-12345678
传真: 010-12345679
邮箱: contact@betterlaser.com
网站: https://www.betterlaser.com
公司描述: 企业资源规划管理系统
英文描述: Enterprise Resource Planning System
公司Logo: [上传图片]
```

## 🎨 显示效果

### 登录页面

1. **Logo显示**: 如果上传了Logo，显示Logo图片；否则显示默认图标
2. **公司名称**: 显示在页面标题和主标题
3. **公司描述**: 显示在副标题（根据语言自动切换）
4. **页脚**: 显示版权信息（当前年份 + 公司名称）

### 导航栏

1. **Logo显示**:
   - 如果上传了Logo，显示横向Logo（100x40px）
   - 否则显示公司名称文本
2. **折叠状态**: 侧边栏折叠时隐藏Logo/文字

### 页脚

显示完整的公司信息，分为4个栏目：
- **公司信息**: 公司名称、描述、网站链接
- **联系方式**: 地址、电话、邮箱（带图标）
- **企业信息**: 公司代码、法定代表人、税号
- **版权信息**: 年份 + 公司名称 + Powered by信息

## 🌍 国际化支持

### 切换语言

系统会根据用户的语言设置自动切换显示：
- **中文**: 显示中文描述
- **英文**: 显示英文描述

### 配置方式

1. 在Admin后台同时填写中英文描述
2. 无需额外配置，系统自动处理

## ⚡ 性能优化

### 缓存机制

- **缓存时长**: 1小时
- **缓存键**: `active_company_{语言代码}`
- **自动失效**: 当公司信息在Admin后台修改时自动清除缓存

### 缓存失效

系统会自动监听以下事件：
- 公司信息创建
- 公司信息更新
- 公司信息删除

当这些事件发生时，自动清除所有语言的公司缓存，确保前端显示最新信息。

## 🖼️ Logo配置建议

### 尺寸建议

| 位置 | 建议尺寸 | 说明 |
|------|----------|------|
| **导航栏Logo** | 100x40px | 宽扁形，适合横向布局 |
| **登录页Logo** | 80x80px | 正方形或圆形，适合居中显示 |
| **打印模板Logo** | 200x100px | 宽扁形，适合文档顶部 |

### 文件格式

- 推荐格式: PNG（透明背景）
- 其他格式: JPG（支持但不推荐）
- 最大文件大小: 由Django MEDIA配置决定（默认5MB）

### Logo设计建议

1. **简洁明了**: 避免过多细节
2. **高对比度**: 确保在不同背景下可见
3. **矢量格式**: 如有条件，建议使用SVG
4. **响应式**: Logo在不同尺寸下都清晰可辨

## 🔄 更新公司信息

### 通过Admin后台更新

1. 访问 Admin后台
2. 导航到 `公司信息`
3. 点击要修改的公司记录
4. 修改需要的信息
5. 点击"保存"

### 前端自动更新

保存后，前端会自动显示最新信息：
- 由于缓存机制，最长1小时内生效
- 如需立即生效，可以在Admin后台再次保存（触发缓存失效）

## 🐛 常见问题

### Q: Logo没有显示？

**A**: 检查以下几点：
1. 确认Logo已正确上传
2. 检查Logo文件路径是否正确
3. 清除浏览器缓存
4. 检查Django MEDIA配置是否正确

### Q: 修改公司信息后前端没有更新？

**A**:
1. 等待缓存过期（1小时）
2. 或在Admin后台再次保存（触发缓存失效）
3. 重启Django服务器

### Q: 英文描述没有显示？

**A**:
1. 确保已填写"Company Description (English)"字段
2. 确认系统语言设置正确
3. 清除浏览器缓存

### Q: 如何切换到英文界面？

**A**:
1. 修改settings.py中的LANGUAGE设置
2. 或在用户设置中添加语言切换功能

### Q: 页脚信息不完整？

**A**:
1. 确保已填写所有公司信息
2. 某些信息为空时不会显示
3. 可以在Admin后台补充完整信息

## 📚 相关文件

### 核心文件
- `core/models.py`: Company模型定义
- `core/context_processors.py`: 上下文处理器
- `core/signals.py`: 缓存失效信号
- `core/admin.py`: Admin后台配置
- `django_erp/settings.py`: 上下文处理器配置

### 模板文件
- `templates/base.html`: 导航栏和页脚
- `templates/core/login.html`: 登录页面

### 迁移文件
- `core/migrations/0011_add_company_description_en.py`: 添加英文描述字段

## 🎯 测试检查

### 验证功能是否正常

```bash
# 1. 检查公司数据
python manage.py shell -c "from core.models import Company; print(Company.objects.first())"

# 2. 检查上下文处理器
python manage.py shell -c "from core.context_processors import company_info; print(company_info(None))"

# 3. 检查缓存
python manage.py shell -c "from django.core.cache import cache; print(cache.get('active_company_zh-hans'))"
```

### 测试步骤

1. ✅ 访问登录页，检查是否显示公司信息
2. ✅ 登录后检查导航栏是否显示公司Logo/名称
3. ✅ 检查页面标题是否包含公司名称
4. ✅ 滚动到底部检查页脚是否显示完整信息
5. ✅ 在Admin后台修改公司信息
6. ✅ 修改后1小时内或立即刷新页面，检查是否更新
7. ✅ （如有条件）切换语言，检查是否显示对应语言的描述

## 📞 技术支持

如遇到问题，请检查：
1. Django日志文件
2. 浏览器控制台错误
3. Django Admin日志
4. 缓存配置是否正确

---

**功能实现完成日期**: 2026-01-31
**版本**: v1.0.0
