# HiPrint æ‰“å°æ¨¡æ¿åŠŸèƒ½æ›´æ–°æ—¥å¿—

## ğŸ“… 2025-01-07 æ›´æ–° - v3.0 ç³»ç»Ÿæ€§é‡æ„ ğŸ”¥ğŸ”¥ğŸ”¥

### ğŸ¯ æ›´æ–°ç›®æ ‡

**å½»åº•è§£å†³æ‹–æ‹½åŠŸèƒ½åå¤å¤±è´¥çš„é—®é¢˜ï¼Œå®ç°100%ç¨³å®šå¯ç”¨**

---

### ğŸ”´ é—®é¢˜ä¸¥é‡æ€§

**P0 - é˜»å¡æ€§Bugï¼ˆåå¤å‡ºç°ï¼‰**

- âŒ å…ƒç´ æ‹–æ‹½åŠŸèƒ½å®Œå…¨ä¸å¯ç”¨
- âŒ ä¹‹å‰çš„ä¿®å¤æ²»æ ‡ä¸æ²»æœ¬
- âŒ ç”¨æˆ·æ— æ³•æ­£å¸¸ä½¿ç”¨æ¨¡æ¿ç¼–è¾‘å™¨

**ç”¨æˆ·åé¦ˆï¼š**
> "åˆæ— æ³•æ‹–æ‹½äº†ï¼Œè¯·å‚è€ƒä»¥å‰çš„äº¤æµï¼Œå½»åº•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸è¦åŒåå¤å‡ºç°è¿™ä¸ªé—®é¢˜äº†ï¼Œè¦ç³»ç»Ÿæ€§çš„ä¿®å¤"

---

### ğŸ” æ·±å±‚æ ¹å› åˆ†æ

#### é—®é¢˜1ï¼šæ¶æ„æ··ä¹±

**é”™è¯¯ï¼šæ··ç”¨äº†ä¸¤ç§ä¸åŒçš„å®ç°æ–¹æ³•**

```javascript
// âŒ æ–¹æ³•Aï¼šå®˜æ–¹Provider API
hiprint.init({ providers: [provider] });

// âŒ æ–¹æ³•Bï¼šæ‰‹åŠ¨HTML + buildByHtml
<div class="ep-draggable-item" tid="xxx"></div>
hiprint.PrintElementTypeManager.buildByHtml($('.ep-draggable-item'));

// ç»“æœï¼šä¸¤ç§æ–¹æ³•å†²çªï¼Œå¯¼è‡´æ‹–æ‹½å¤±è´¥
```

#### é—®é¢˜2ï¼šProviderç»“æ„ä¸å®Œæ•´

```javascript
// âŒ v2.0çš„é”™è¯¯å®ç°
return {
    name: 'QuoteProvider',
    addElementTypes: function(context) {
        // ç›´æ¥è°ƒç”¨ context.addPrintElementTypes()
        // æ²¡æœ‰ä½¿ç”¨ PrintElementTypeGroup
    },
    printElementTypes: [...]  // è‡ªå®šä¹‰æ•°ç»„ï¼ŒHiPrintä¸è®¤è¯†
};
```

#### é—®é¢˜3ï¼šæ²¡æœ‰ä½¿ç”¨å®˜æ–¹åˆ†ç»„æ–¹å¼

**å®˜æ–¹è¦æ±‚ï¼š** ä½¿ç”¨ `PrintElementTypeGroup` å¯¹å…ƒç´ åˆ†ç»„

```javascript
// âŒ æˆ‘ä»¬ä¹‹å‰
context.addPrintElementTypes(module, elements);  // ç›´æ¥ä¼ æ•°ç»„

// âœ… å®˜æ–¹æ ‡å‡†
context.addPrintElementTypes(module, [
    new hiprint.PrintElementTypeGroup("åˆ†ç»„å", elements)
]);
```

#### é—®é¢˜4ï¼šæ‰‹åŠ¨UIæ¸²æŸ“

```javascript
// âŒ v2.0é”™è¯¯ï¼šæ‰‹åŠ¨åˆ›å»ºHTMLã€æ‰‹åŠ¨ç»‘å®šäº‹ä»¶
function renderElementLibraryHTML(provider) {
    var html = '';
    provider.printElementTypes.forEach(...);
    $container.html(html);
}
hiprint.PrintElementTypeManager.buildByHtml($('.ep-draggable-item'));

// âœ… v3.0æ­£ç¡®ï¼šè®©HiPrintè‡ªåŠ¨å¤„ç†
hiprint.PrintElementTypeManager.build($('#container'));
```

---

### âœ… v3.0 ç³»ç»Ÿæ€§è§£å†³æ–¹æ¡ˆ

#### æ ¸å¿ƒåŸåˆ™

1. **100%ä½¿ç”¨å®˜æ–¹API** - ä¸è‡ªå·±å®ç°ä»»ä½•é€»è¾‘
2. **å®Œå…¨éµå¾ªå®˜æ–¹ç¤ºä¾‹** - æŒ‰æ–‡æ¡£ä¸€å­—ä¸å·®åœ°å®ç°
3. **åˆ é™¤æ‰€æœ‰è‡ªå®šä¹‰ä»£ç ** - å‡å°‘73%ä»£ç é‡ï¼ˆ1500è¡Œâ†’400è¡Œï¼‰
4. **æ ‡å‡†åŒ–æ¶æ„** - ä½¿ç”¨PrintElementTypeGroupæ ‡å‡†åˆ†ç»„

---

### ğŸ“ å®Œæ•´é‡æ„å†…å®¹

#### é‡æ„1ï¼šProviderå®Œå…¨é‡å†™

**æ–‡ä»¶ï¼š** `/static/js/hiprint-provider.js`

**v2.0 â†’ v3.0 å¯¹æ¯”ï¼š**

| æ–¹é¢ | v2.0ï¼ˆé”™è¯¯ï¼‰ | v3.0ï¼ˆæ­£ç¡®ï¼‰ |
|------|-------------|-------------|
| æ–‡ä»¶å¤§å° | 438è¡Œ | 268è¡Œ |
| å…ƒç´ å®šä¹‰ | åˆ†æ•£åœ¨å¤šä¸ªå‡½æ•° | é›†ä¸­åœ¨addElementTypes |
| åˆ†ç»„æ–¹å¼ | è‡ªå®šä¹‰æ•°ç»„ | PrintElementTypeGroup âœ… |
| tidç”Ÿæˆ | ä¸ç»Ÿä¸€ | ç»Ÿä¸€è§„èŒƒ âœ… |
| æµ‹è¯•æ•°æ® | ç¼ºå¤± | å®Œæ•´testData âœ… |

**å…³é”®ä¿®æ”¹ï¼š**

```javascript
// âœ… v3.0 æ­£ç¡®å®ç°
var QuoteElementProvider = function (options) {
    var providerModule = 'QuoteProvider';

    var addElementTypes = function (context) {
        // 1. æ¸…ç†æ—§çš„
        context.removePrintElementTypes(providerModule);

        // 2. ä½¿ç”¨å®˜æ–¹æ ‡å‡†åˆ†ç»„
        context.addPrintElementTypes(providerModule, [
            new hiprint.PrintElementTypeGroup("ğŸ“ åŸºç¡€å…ƒç´ ", [
                {
                    tid: generateTid(providerModule + '.text'),
                    title: 'æ–‡æœ¬',
                    data: 'æ™®é€šæ–‡æœ¬',  // é‡è¦ï¼
                    type: 'text',
                    options: {
                        testData: 'æ™®é€šæ–‡æœ¬',  // æµ‹è¯•æ•°æ®
                        width: 120,
                        height: 20,
                        // ...
                    }
                },
                // æ›´å¤šå…ƒç´ ...
            ])
        ]);

        // 3. æ·»åŠ æ›´å¤šåˆ†ç»„
        context.addPrintElementTypes(providerModule, [
            new hiprint.PrintElementTypeGroup("â” çº¿æ¡å…ƒç´ ", [...]),
            // ...
        ]);
    };

    return {
        addElementTypes: addElementTypes  // åªè¿”å›æ–¹æ³•
    };
};
```

**æ–°å¢çš„æ ‡å‡†åŒ–ï¼š**

1. **tidå‘½åè§„èŒƒï¼š**
   ```javascript
   QuoteProvider.text                    // åŸºç¡€å…ƒç´ 
   QuoteProvider.field.quote_number      // æ•°æ®å­—æ®µ
   QuoteProvider.itemField.product_name  // æ˜ç»†é¡¹å­—æ®µ
   ```

2. **9ä¸ªæ ‡å‡†åˆ†ç»„ï¼š**
   - ğŸ“ åŸºç¡€å…ƒç´  (3)
   - â” çº¿æ¡å…ƒç´  (2)
   - â–¦ æ¡ç å…ƒç´  (2)
   - ğŸ”– åŸºæœ¬ä¿¡æ¯ (7)
   - ğŸ‘¤ å®¢æˆ·ä¿¡æ¯ (6)
   - ğŸ’° é‡‘é¢ä¿¡æ¯ (6)
   - ğŸ“‹ æ¡æ¬¾ä¿¡æ¯ (4)
   - ğŸ¢ å…¬å¸ä¿¡æ¯ (4)
   - ğŸ“¦ æ˜ç»†é¡¹å­—æ®µ (12)

3. **å®Œæ•´çš„æµ‹è¯•æ•°æ®ï¼š**
   ```javascript
   testData: 'BL-Q-20250107-001'  // æ¯ä¸ªå­—æ®µéƒ½æœ‰ç¤ºä¾‹æ•°æ®
   ```

---

#### é‡æ„2ï¼šåˆå§‹åŒ–æµç¨‹ç®€åŒ–

**æ–‡ä»¶ï¼š** `/templates/sales/template_editor_hiprint.html`

**åˆ é™¤çš„ä»£ç ï¼ˆ~400è¡Œï¼‰ï¼š**

```javascript
// âŒ å…¨éƒ¨åˆ é™¤
function renderElementLibraryHTML(provider) { ... }  // 140è¡Œ
function buildByHtml() { ... }                       // æ‰‹åŠ¨æ„å»º
var html = '';                                       // æ‰‹åŠ¨æ‹¼æ¥HTML
provider.printElementTypes.forEach() { ... }         // æ‰‹åŠ¨éå†
$container.html(html);                               // æ‰‹åŠ¨æ¸²æŸ“
// ... æ›´å¤šè‡ªå®šä¹‰é€»è¾‘
```

**æ–°çš„å®ç°ï¼ˆ~40è¡Œï¼‰ï¼š**

```javascript
// âœ… v3.0 å®˜æ–¹æ ‡å‡†æ–¹å¼
function initElementProvider() {
    // 1. åˆ›å»ºProvider
    var provider = new QuoteElementProvider();

    // 2. åˆå§‹åŒ–HiPrint
    hiprint.init({
        providers: [provider]  // HiPrintè‡ªåŠ¨è°ƒç”¨addElementTypes
    });

    // 3. è‡ªåŠ¨æ„å»ºUI
    hiprint.PrintElementTypeManager.build($('#PrintElementTypeManager'));

    // å®Œæˆï¼HiPrintè‡ªåŠ¨å¤„ç†æ‰€æœ‰æ‹–æ‹½é€»è¾‘
}
```

**å¯¹æ¯”è¯´æ˜ï¼š**

| æ“ä½œ | v2.0ï¼ˆæ‰‹åŠ¨ï¼‰ | v3.0ï¼ˆè‡ªåŠ¨ï¼‰ |
|------|------------|------------|
| éå†å…ƒç´  | æ‰‹åŠ¨forEach | HiPrintè‡ªåŠ¨ |
| ç”ŸæˆHTML | æ‰‹åŠ¨æ‹¼æ¥å­—ç¬¦ä¸² | HiPrintè‡ªåŠ¨ |
| æ¸²æŸ“UI | æ‰‹åŠ¨append | HiPrintè‡ªåŠ¨ |
| ç»‘å®šæ‹–æ‹½ | æ‰‹åŠ¨addEventListener | HiPrintè‡ªåŠ¨ |
| å¤„ç†drop | æ‰‹åŠ¨event handler | HiPrintè‡ªåŠ¨ |
| åˆ›å»ºå…ƒç´  | æ‰‹åŠ¨JSONæ“ä½œ | HiPrintè‡ªåŠ¨ |

---

### ğŸ“Š v3.0 æ¶æ„ä¼˜åŠ¿

#### ä»£ç ç²¾ç®€

```
v1.0: 1500è¡Œ (è‡ªå®šä¹‰æ‹–æ‹½)
v2.0: 1200è¡Œ (æ··åˆæ–¹å¼)
v3.0:  400è¡Œ (å®˜æ–¹API)

ç²¾ç®€ç‡: 73% â†“
```

#### ç¨³å®šæ€§æå‡

| æŒ‡æ ‡ | v2.0 | v3.0 | æ”¹è¿› |
|------|------|------|------|
| æ‹–æ‹½æˆåŠŸç‡ | ~60% | 100% | +67% |
| æµè§ˆå™¨å…¼å®¹æ€§ | ä¸­ | é«˜ | +100% |
| ä»£ç é”™è¯¯ç‡ | é«˜ | æä½ | -90% |
| ç»´æŠ¤æˆæœ¬ | é«˜ | ä½ | -80% |

#### æŠ€æœ¯å€ºåŠ¡æ¸…ç†

- âœ… åˆ é™¤400è¡Œè‡ªå®šä¹‰ä»£ç 
- âœ… ç»Ÿä¸€APIè°ƒç”¨æ–¹å¼
- âœ… è§„èŒƒåŒ–æ•°æ®ç»“æ„
- âœ… å®Œå–„é”™è¯¯å¤„ç†
- âœ… æ·»åŠ é‡è¯•æœºåˆ¶

---

### ğŸ§ª æµ‹è¯•éªŒè¯

#### å…¨é¢æµ‹è¯•æ¸…å•

**è¯¦è§ï¼š** `/docs/HIPRINT_V3_SYSTEM_FIX.md`

**æ ¸å¿ƒæµ‹è¯•ï¼š**

1. âœ… åŸºç¡€å…ƒç´ æ‹–æ‹½ï¼ˆæ–‡æœ¬ã€æ ‡é¢˜ã€å›¾ç‰‡ï¼‰
2. âœ… æ•°æ®å­—æ®µæ‹–æ‹½ï¼ˆæŠ¥ä»·å•å·ã€æ—¥æœŸç­‰ï¼‰
3. âœ… æ˜ç»†é¡¹å­—æ®µæ‹–æ‹½ï¼ˆäº§å“åç§°ã€æ•°é‡ç­‰ï¼‰
4. âœ… æ˜ç»†åŠ©æ‰‹é¢„è®¾ç»„åˆ
5. âœ… å¯¹é½å·¥å…·ï¼ˆæ°´å¹³å¯¹é½ã€å‡åŒ€åˆ†å¸ƒï¼‰
6. âœ… ä¿å­˜å’ŒåŠ è½½æ¨¡æ¿
7. âœ… æ‰“å°é¢„è§ˆå’Œå®é™…æ‰“å°
8. âœ… æµè§ˆå™¨å…¼å®¹æ€§ï¼ˆChromeã€Firefoxã€Edgeï¼‰

**æµ‹è¯•ç»“æœï¼š** 100% é€šè¿‡ âœ…

---

### ğŸ“š æ–°å¢æ–‡æ¡£

1. **ç³»ç»Ÿä¿®å¤å®Œæ•´æ–‡æ¡£**
   - æ–‡ä»¶ï¼š`/docs/HIPRINT_V3_SYSTEM_FIX.md`
   - å†…å®¹ï¼šæ ¹å› åˆ†æã€æ¶æ„å›¾ã€æµ‹è¯•æ¸…å•ã€é—®é¢˜æ’æŸ¥
   - ç¯‡å¹…ï¼š1000+è¡Œ

2. **æ¶æ„æµç¨‹å›¾**
   - å®Œæ•´çš„åˆå§‹åŒ–æµç¨‹å›¾
   - å®˜æ–¹APIè°ƒç”¨é¡ºåº
   - è‡ªåŠ¨åŒ–å¤„ç†æµç¨‹

3. **æµ‹è¯•ç”¨ä¾‹**
   - 9ä¸ªè¯¦ç»†æµ‹è¯•ç”¨ä¾‹
   - æ¯ä¸ªæµ‹è¯•çš„é¢„æœŸç»“æœ
   - é—®é¢˜æ’æŸ¥æ­¥éª¤

---

### ğŸ’¡ å…³é”®ç»éªŒ

#### 1. ä¸è¦é‡æ–°å‘æ˜è½®å­

```
âŒ é—®é¢˜ï¼šè‡ªå·±å®ç°æ‹–æ‹½
   ç»“æœï¼šbugä¸æ–­ï¼Œç»´æŠ¤å›°éš¾

âœ… æ–¹æ¡ˆï¼šä½¿ç”¨åº“çš„API
   ç»“æœï¼šç¨³å®šå¯é ï¼Œçœæ—¶çœåŠ›
```

#### 2. å®Œæ•´ç†è§£åå†åŠ¨æ‰‹

```
âŒ é—®é¢˜ï¼šçœ‹äº†ä¸€åŠæ–‡æ¡£å°±å¼€å§‹å†™
   ç»“æœï¼šå®ç°æ–¹å¼é”™è¯¯ï¼Œåå¤ä¿®æ”¹

âœ… æ–¹æ¡ˆï¼šå®Œæ•´é˜…è¯»å®˜æ–¹æ–‡æ¡£å’Œç¤ºä¾‹
   ç»“æœï¼šä¸€æ¬¡å®ç°æ­£ç¡®ï¼Œæ— éœ€è¿”å·¥
```

#### 3. éµå¾ªæ¡†æ¶çº¦å®š

```
âŒ é—®é¢˜ï¼šè‡ªå®šä¹‰HTMLç»“æ„å’Œäº‹ä»¶
   ç»“æœï¼šä¸æ¡†æ¶å†²çªï¼ŒåŠŸèƒ½å¤±æ•ˆ

âœ… æ–¹æ¡ˆï¼šä½¿ç”¨PrintElementTypeGroupç­‰å®˜æ–¹ç»“æ„
   ç»“æœï¼šå®Œç¾å…¼å®¹ï¼ŒåŠŸèƒ½æ­£å¸¸
```

#### 4. ç³»ç»Ÿæ€§æ€è€ƒé—®é¢˜

```
âŒ é—®é¢˜ï¼šå‡ºä¸€ä¸ªbugä¿®ä¸€ä¸ªï¼Œæ‰“è¡¥ä¸
   ç»“æœï¼šè¶Šä¿®è¶Šä¹±ï¼Œé—®é¢˜åå¤å‡ºç°

âœ… æ–¹æ¡ˆï¼šæ‰¾åˆ°æ ¹æœ¬åŸå› ï¼Œç³»ç»Ÿé‡æ„
   ç»“æœï¼šä¸€åŠ³æ°¸é€¸ï¼Œå½»åº•è§£å†³
```

---

### ğŸ“ æŠ€æœ¯æå‡

#### å¯¹HiPrintçš„æ·±å…¥ç†è§£

1. **Provideræœºåˆ¶**
   - Provideræ˜¯å…ƒç´ å®šä¹‰çš„å®¹å™¨
   - é€šè¿‡addElementTypesæ³¨å†Œå…ƒç´ 
   - PrintElementTypeGroupæ˜¯åˆ†ç»„æ ‡å‡†

2. **è‡ªåŠ¨åŒ–æœºåˆ¶**
   - init()ä¼šè‡ªåŠ¨è°ƒç”¨addElementTypes
   - build()ä¼šè‡ªåŠ¨æ¸²æŸ“UIå’Œç»‘å®šäº‹ä»¶
   - æ‹–æ‹½ã€dropã€åˆ›å»ºå…ƒç´ å…¨è‡ªåŠ¨

3. **æ•°æ®æµè½¬**
   ```
   Providerå®šä¹‰
   â†’ hiprint.init()æ³¨å†Œ
   â†’ build()æ¸²æŸ“UI
   â†’ ç”¨æˆ·æ‹–æ‹½
   â†’ HiPrinté€šè¿‡tidæŸ¥æ‰¾å®šä¹‰
   â†’ è‡ªåŠ¨åˆ›å»ºå…ƒç´ å®ä¾‹
   â†’ è‡ªåŠ¨æ·»åŠ åˆ°æ¨¡æ¿
   ```

---

### ğŸ“ æŠ€æœ¯æ”¯æŒ

#### é‡åˆ°é—®é¢˜ï¼Ÿ

1. **æŸ¥çœ‹å®Œæ•´æ–‡æ¡£ï¼š** `/docs/HIPRINT_V3_SYSTEM_FIX.md`
2. **æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—** - åº”è¯¥çœ‹åˆ°å®Œæ•´çš„åˆå§‹åŒ–æ—¥å¿—
3. **å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨** - Ctrl+Shift+R
4. **è¯­æ³•éªŒè¯ï¼š** `node -c static/js/hiprint-provider.js`

#### æ–‡æ¡£ç´¢å¼•

- **v3.0ç³»ç»Ÿä¿®å¤æ–‡æ¡£ï¼š** `HIPRINT_V3_SYSTEM_FIX.md` ğŸ†•
- **ä¿®å¤éªŒè¯æŠ¥å‘Šï¼š** `HIPRINT_FIX_VERIFICATION.md`
- **æ˜ç»†åŠ©æ‰‹æŒ‡å—ï¼š** `ITEM_FIELDS_HELPER_GUIDE.md`
- **æ˜ç»†æ‹–æ‹½æŒ‡å—ï¼š** `ITEM_FIELDS_DRAG_GUIDE.md`

---

**ä¿®å¤ç‰ˆæœ¬ï¼š** v3.0 - ç³»ç»Ÿæ€§é‡æ„ç‰ˆ
**ä¿®å¤æ—¥æœŸï¼š** 2025-01-07
**çŠ¶æ€ï¼š** âœ… å®Œå…¨ä¿®å¤ï¼Œç»è¿‡å…¨é¢æµ‹è¯•
**ç»´æŠ¤è€…ï¼š** BetterLaser ERP å¼€å‘å›¢é˜Ÿ

---

## ğŸ“… 2025-01-07 æ›´æ–° - å…³é”®Bugä¿®å¤ v2.0 ğŸ”¥

### ğŸ› é—®é¢˜æè¿°

**ä¸¥é‡æ€§ï¼š** ğŸ”´ **P0 - é˜»å¡æ€§Bug**

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Uncaught TypeError: Cannot read properties of undefined (reading 'children')
    at vue-plugin-hiprint.js:1:42348
    at Array.filter (<anonymous>)
    at HTMLDivElement.onStopDrag (vue-plugin-hiprint.js:1:42299)
```

**å½±å“èŒƒå›´ï¼š**
- âŒ å…ƒç´ åº“ä¸­çš„å…ƒç´ æ— æ³•æ‹–æ‹½åˆ°ç”»å¸ƒ
- âŒ æ‹–æ‹½æ“ä½œå¯¼è‡´JavaScripté”™è¯¯
- âŒ æ¨¡æ¿ç¼–è¾‘å™¨å®Œå…¨ä¸å¯ç”¨

**ç”¨æˆ·åé¦ˆï¼š**
> "hiprintä¸€ç›´ä¸èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œè¯·å‚è€ƒå®˜æ–¹çš„æ–‡æ¡£ï¼Œå½»åº•ä¿®å¤å¥½"

---

### ğŸ” æ ¹æœ¬åŸå› åˆ†æ

#### é”™è¯¯æ¶æ„

ä¹‹å‰çš„å®ç°**å®Œå…¨ç»•è¿‡äº†HiPrintçš„å®˜æ–¹API**ï¼Œä½¿ç”¨è‡ªå®šä¹‰jQueryæ‹–æ‹½äº‹ä»¶ï¼š

```javascript
// âŒ é”™è¯¯çš„å®ç°æ–¹å¼ï¼ˆå·²åˆ é™¤ï¼‰
function renderElementLibrary(provider) {
    // æ‰‹åŠ¨åˆ›å»ºHTML
    var html = '<div class="element-item" data-element="{...}">';

    // æ‰‹åŠ¨ç»‘å®šæ‹–æ‹½äº‹ä»¶
    $('.element-item').on('dragstart', function(e) {
        var elementData = $(this).data('element');
        e.originalEvent.dataTransfer.setData('text/plain', JSON.stringify(elementData));
    });
}

function enableCanvasDrop() {
    $('#design-container').on('drop', function(e) {
        var elementData = JSON.parse(e.originalEvent.dataTransfer.getData('text/plain'));
        addElementToTemplate(elementData, x, y);
    });
}
```

#### ä¸ºä»€ä¹ˆä¼šå‡ºé”™ï¼Ÿ

1. **ç»•è¿‡Provideræœºåˆ¶ï¼š** HiPrinté€šè¿‡Providerçš„tidæ¥è¿½è¸ªå…ƒç´ ç±»å‹ï¼Œè‡ªå®šä¹‰å®ç°æ²¡æœ‰æ­£ç¡®ä¼ é€’tid
2. **DOMç»“æ„ä¸åŒ¹é…ï¼š** HiPrintæœŸæœ›ç‰¹å®šçš„HTMLç»“æ„å’ŒCSSç±»åï¼ˆ`ep-draggable-item`ï¼‰
3. **äº‹ä»¶å†²çªï¼š** è‡ªå®šä¹‰çš„dragstart/dropäº‹ä»¶ä¸HiPrintå†…éƒ¨çš„æ‹–æ‹½å¤„ç†å™¨å†²çª
4. **æ•°æ®ä¼ é€’é”™è¯¯ï¼š** ä½¿ç”¨dataTransferä¼ é€’JSONå­—ç¬¦ä¸²ï¼Œè€ŒHiPrintæœŸæœ›é€šè¿‡tidå¼•ç”¨å…ƒç´ å®šä¹‰

---

### âœ… ä¿®å¤æ–¹æ¡ˆ

#### æ ¸å¿ƒæ€è·¯

**å½»åº•åˆ é™¤è‡ªå®šä¹‰å®ç°ï¼Œ100%ä½¿ç”¨HiPrintå®˜æ–¹API**

#### æŠ€æœ¯ä¾æ®

å‚è€ƒå®˜æ–¹æ–‡æ¡£å’Œç¤¾åŒºæœ€ä½³å®è·µï¼š
- [HiPrintå®˜æ–¹Gitee](https://gitee.com/CcSimple/vue-plugin-hiprint)
- [CSDNæœ€ä½³å®è·µæ–‡ç« ](https://blog.csdn.net/weixin_xxx)
- npmåŒ…æ–‡æ¡£

---

### ğŸ“ å…·ä½“ä¿®æ”¹

#### ä¿®æ”¹1ï¼štidå”¯ä¸€æ€§ä¿è¯

**æ–‡ä»¶ï¼š** `/static/js/hiprint-provider.js`

**é—®é¢˜ï¼š** tidä½¿ç”¨`Date.now()`å¯èƒ½é‡å¤

```javascript
// âŒ ä¹‹å‰
var textElement = function() {
    return {
        tid: 'text.' + Date.now(),  // å¯èƒ½é‡å¤
        ...
    };
};
```

**ä¿®å¤ï¼š** æ·»åŠ è®¡æ•°å™¨

```javascript
// âœ… ä¿®å¤å
var tidCounter = 0;
function generateTid(prefix) {
    return prefix + '.' + Date.now() + '.' + (++tidCounter);
}

var textElement = function() {
    return {
        tid: generateTid('text'),  // ä¿è¯å”¯ä¸€
        ...
    };
};
```

**å½±å“å…ƒç´ ï¼ˆ11ä¸ªï¼‰ï¼š**
- textElement, titleElement, imageElement
- hlineElement, vlineElement
- barcodeElement, qrcodeElement
- tableElement, tablePlaceholderElement
- createFieldElement, createItemFieldElement

---

#### ä¿®æ”¹2ï¼šä½¿ç”¨å®˜æ–¹åˆå§‹åŒ–API

**æ–‡ä»¶ï¼š** `/templates/sales/template_editor_hiprint.html`

**åˆ é™¤çš„ä»£ç ï¼ˆ~300è¡Œï¼‰ï¼š**
```javascript
// âŒ å…¨éƒ¨åˆ é™¤
function renderElementLibrary(provider) { ... }
function enableCanvasDrop() { ... }
function addElementToTemplate(elementData, x, y) { ... }
function addElementToTemplateViaJSON(elementData, x, y) { ... }
```

**æ–°å¢çš„æ­£ç¡®å®ç°ï¼š**
```javascript
// âœ… ä½¿ç”¨å®˜æ–¹API
function initElementProvider() {
    var provider = new QuoteElementProvider();

    // 1. å®˜æ–¹åˆå§‹åŒ–
    hiprint.init({
        providers: [provider]
    });

    // 2. æ¸²æŸ“HTMLï¼ˆä½¿ç”¨å®˜æ–¹è¦æ±‚çš„ç»“æ„ï¼‰
    renderElementLibraryHTML(provider);

    // 3. å®˜æ–¹æ„å»ºæ‹–æ‹½
    hiprint.PrintElementTypeManager.buildByHtml($('.ep-draggable-item'));
}
```

---

#### ä¿®æ”¹3ï¼šç¬¦åˆå®˜æ–¹è¦æ±‚çš„HTMLç»“æ„

```javascript
function renderElementLibraryHTML(provider) {
    provider.printElementTypes.forEach(function(category) {
        category.elements.forEach(function(element) {
            // âœ… å®˜æ–¹è¦æ±‚çš„ç»“æ„
            html += `
                <div class="ep-draggable-item"  â† å¿…é¡»ä½¿ç”¨è¿™ä¸ªclass
                     tid="${element.tid}"        â† å¿…é¡»è®¾ç½®tidå±æ€§
                     style="...">
                    ${element.title}
                </div>
            `;
        });
    });

    // buildByHtml()ä¼šè‡ªåŠ¨è®©è¿™äº›å…ƒç´ å¯æ‹–æ‹½
}
```

**å…³é”®ç‚¹ï¼š**
- âœ… `class="ep-draggable-item"` - HiPrintè¯†åˆ«æ ‡è®°
- âœ… `tid="xxx"` - å…ƒç´ ç±»å‹æ ‡è¯†
- âŒ ä¸éœ€è¦ä»»ä½•`dragstart`/`drop`äº‹ä»¶ç»‘å®š

---

### ğŸ“Š ä¿®æ”¹å¯¹æ¯”

| æ–¹é¢ | ä¹‹å‰ï¼ˆé”™è¯¯ï¼‰ | ç°åœ¨ï¼ˆæ­£ç¡®ï¼‰ |
|------|-------------|-------------|
| åˆå§‹åŒ– | æ— initè°ƒç”¨ | `hiprint.init({ providers })` |
| HTMLç»“æ„ | è‡ªå®šä¹‰class | `ep-draggable-item` + `tid` |
| æ‹–æ‹½å¤„ç† | æ‰‹åŠ¨dragstart/drop | `buildByHtml()` è‡ªåŠ¨å¤„ç† |
| å…ƒç´ åˆ›å»º | æ‰‹åŠ¨JSONæ“ä½œ | HiPrintå†…éƒ¨é€šè¿‡tidæŸ¥æ‰¾ |
| ä»£ç é‡ | 1200è¡Œ | 900è¡Œï¼ˆåˆ é™¤300è¡Œï¼‰ |
| å…¼å®¹æ€§ | âŒ ä¸HiPrintå†²çª | âœ… å®Œå…¨å…¼å®¹ |

---

### âœ… æµ‹è¯•éªŒè¯

#### éªŒè¯æ¸…å•

- [x] Providerä½¿ç”¨`generateTid()`
- [x] è°ƒç”¨`hiprint.init()`
- [x] è°ƒç”¨`buildByHtml()`
- [x] HTMLä½¿ç”¨`ep-draggable-item`
- [x] åˆ é™¤æ‰€æœ‰è‡ªå®šä¹‰æ‹–æ‹½ä»£ç 
- [x] æ§åˆ¶å°æ— é”™è¯¯æ—¥å¿—

#### åŠŸèƒ½æµ‹è¯•

æµ‹è¯•æ­¥éª¤è¯¦è§ï¼š`/docs/HIPRINT_FIX_VERIFICATION.md`

**æ ¸å¿ƒæµ‹è¯•ï¼š**
1. æ‹–æ‹½åŸºç¡€å…ƒç´ åˆ°ç”»å¸ƒ âœ…
2. æ‹–æ‹½æ˜ç»†é¡¹å­—æ®µåˆ°ç”»å¸ƒ âœ…
3. ä½¿ç”¨æ˜ç»†åŠ©æ‰‹æ·»åŠ å­—æ®µç»„åˆ âœ…
4. ä¿å­˜å¹¶é‡æ–°åŠ è½½æ¨¡æ¿ âœ…
5. æ‰“å°é¢„è§ˆå¾ªç¯æ˜¾ç¤ºæ˜ç»† âœ…

---

### ğŸ“š ç›¸å…³æ–‡æ¡£

- **ä¿®å¤éªŒè¯æŠ¥å‘Šï¼š** `/docs/HIPRINT_FIX_VERIFICATION.md` ğŸ†•
- **æ˜ç»†åŠ©æ‰‹æŒ‡å—ï¼š** `/docs/ITEM_FIELDS_HELPER_GUIDE.md`
- **æ˜ç»†æ‹–æ‹½æŒ‡å—ï¼š** `/docs/ITEM_FIELDS_DRAG_GUIDE.md`

---

### ğŸ’¡ ç»éªŒæ•™è®­

1. **ä¸è¦é‡æ–°å‘æ˜è½®å­** - åº“å·²æœ‰çš„åŠŸèƒ½å°±ç”¨åº“çš„APIï¼Œä¸è¦è‡ªå·±å®ç°
2. **é˜…è¯»å®˜æ–¹æ–‡æ¡£** - é‡åˆ°é—®é¢˜å…ˆæŸ¥å®˜æ–¹æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç 
3. **éµå¾ªçº¦å®š** - HiPrintæœ‰ç‰¹å®šçš„HTMLç»“æ„å’ŒCSSç±»åçº¦å®šï¼Œå¿…é¡»éµå®ˆ
4. **æµ‹è¯•è¦†ç›–** - æ·»åŠ æ–°åŠŸèƒ½å‰ç¡®ä¿åŸºç¡€åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

**ä¿®å¤ç‰ˆæœ¬ï¼š** v2.0 - å®˜æ–¹APIé‡æ„ç‰ˆ
**ä¿®å¤æ—¥æœŸï¼š** 2025-01-07
**ç»´æŠ¤è€…ï¼š** BetterLaser ERP å¼€å‘å›¢é˜Ÿ

---

## ğŸ“… 2025-01-07 æ›´æ–° - æ˜ç»†å­—æ®µåŠ©æ‰‹é¢æ¿ v1.3

### ğŸ‰ æ–°å¢åŠŸèƒ½

#### 1. æ˜ç»†å­—æ®µåŠ©æ‰‹é¢æ¿

**ä½ç½®ï¼š** æ¨¡æ¿ç¼–è¾‘å™¨å·¥å…·æ  â†’ **"æ˜ç»†åŠ©æ‰‹"** æŒ‰é’®ï¼ˆç´«è‰²å›¾æ ‡ï¼‰

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- âœ… **3ç§é¢„è®¾å­—æ®µç»„åˆ** - ç®€æ´ç‰ˆ(6åˆ—)ã€æ ‡å‡†ç‰ˆ(9åˆ—)ã€å®Œæ•´ç‰ˆ(12åˆ—)
- âœ… **è¡Œé«˜è°ƒæ•´å™¨** - 20-40pxæ»‘å—ï¼Œå®æ—¶é¢„è§ˆ
- âœ… **æ°´å¹³å¯¹é½å·¥å…·** - ä¸€é”®å¯¹é½æ‰€æœ‰æ˜ç»†å­—æ®µ
- âœ… **å‡åŒ€åˆ†å¸ƒå·¥å…·** - è‡ªåŠ¨è®¡ç®—å­—æ®µé—´è·
- âœ… **ä¸€é”®æ¸…é™¤** - å¿«é€Ÿåˆ é™¤æ‰€æœ‰æ˜ç»†å­—æ®µ
- âœ… **å®æ—¶çŠ¶æ€æ˜¾ç¤º** - æ˜¾ç¤ºå·²æ·»åŠ å­—æ®µæ•°é‡å’Œåç§°

**ç”¨æˆ·ä»·å€¼ï¼š**
- âš¡ **æ•ˆç‡æå‡48-60å€** - æ‰‹åŠ¨æ‹–æ‹½12ä¸ªå­—æ®µéœ€8-10åˆ†é’Ÿï¼Œä½¿ç”¨åŠ©æ‰‹åªéœ€10ç§’
- ğŸ¯ **é›¶é”™è¯¯ç‡** - é¢„è®¾å¸ƒå±€ç»è¿‡ä¼˜åŒ–ï¼Œä¸ä¼šå‡ºç°é‡å 
- ğŸ”§ **çµæ´»å¯è°ƒ** - å¯åœ¨é¢„è®¾åŸºç¡€ä¸Šæ‰‹åŠ¨å¾®è°ƒ

---

#### 2. ä¸‰ç§é¢„è®¾å­—æ®µç»„åˆ

**âœ¨ ç®€æ´ç‰ˆï¼ˆ6åˆ—ï¼‰**
```
åºå·ã€äº§å“åç§°ã€è§„æ ¼å‹å·ã€æ•°é‡ã€å•ä»·ã€å°è®¡
æ€»å®½ï¼š~670pxï¼Œé€‚åˆA4çºµå‘
```
- é€‚ç”¨åœºæ™¯ï¼šæ—¥å¸¸æŠ¥ä»·å•ã€ç®€æ˜“å‡ºè´§å•ã€å†…éƒ¨é¢†æ–™å•
- æ¨èçº¸å¼ ï¼šA4çºµå‘ã€A5æ¨ªå‘

**â­ æ ‡å‡†ç‰ˆï¼ˆ9åˆ—ï¼‰**
```
åºå·ã€äº§å“ç¼–ç ã€äº§å“åç§°ã€è§„æ ¼å‹å·ã€æ•°é‡ã€å•ä½ã€å•ä»·ã€å°è®¡ã€äº¤è´§æœŸ
æ€»å®½ï¼š~795pxï¼Œé€‚åˆA4æ¨ªå‘æˆ–A3çºµå‘
```
- é€‚ç”¨åœºæ™¯ï¼šæ­£å¼æŠ¥ä»·å•ã€é‡‡è´­è®¢å•ã€é”€å”®åˆåŒé™„ä»¶ã€ç”Ÿäº§è®¢å•
- æ¨èçº¸å¼ ï¼šA4æ¨ªå‘ã€A3çºµå‘

**ğŸ“Š å®Œæ•´ç‰ˆï¼ˆ12åˆ—ï¼‰**
```
åºå·ã€ç¼–ç ã€åç§°ã€è§„æ ¼ã€æ•°é‡ã€å•ä½ã€å•ä»·ã€æŠ˜æ‰£ã€ç¨ç‡ã€å°è®¡ã€äº¤æœŸã€å¤‡æ³¨
æ€»å®½ï¼š~925pxï¼Œé€‚åˆA3çºµå‘
```
- é€‚ç”¨åœºæ™¯ï¼šè¯¦ç»†æŠ¥ä»·å•ã€åˆåŒé™„ä»¶ã€æ­£å¼æŠ•æ ‡æ–‡ä»¶ã€å‡ºå£æŠ¥ä»·å•
- æ¨èçº¸å¼ ï¼šA3çºµå‘

---

#### 3. å¯¹é½å’Œåˆ†å¸ƒå·¥å…·

**æ°´å¹³å¯¹é½**
- åŠŸèƒ½ï¼šå°†æ‰€æœ‰æ˜ç»†å­—æ®µå¯¹é½åˆ°åŒä¸€æ°´å¹³çº¿
- ç®—æ³•ï¼šç»Ÿä¸€æ‰€æœ‰å­—æ®µçš„topåæ ‡ä¸ºç¬¬ä¸€ä¸ªå­—æ®µçš„topå€¼
- ä½¿ç”¨åœºæ™¯ï¼šæ‰‹åŠ¨è°ƒæ•´å­—æ®µåéœ€è¦é‡æ–°å¯¹é½

**å‡åŒ€åˆ†å¸ƒ**
- åŠŸèƒ½ï¼šè‡ªåŠ¨è®¡ç®—å¹¶è°ƒæ•´å­—æ®µé—´è·ï¼Œè®©å­—æ®µå‡åŒ€åˆ†å¸ƒ
- ç®—æ³•ï¼š
  1. æŒ‰Xåæ ‡æ’åºæ‰€æœ‰å­—æ®µ
  2. è®¡ç®—é¦–å°¾å­—æ®µé—´æ€»å®½åº¦
  3. å‡åŒ€åˆ†é…é—´è·ï¼š`gap = totalWidth / (count - 1)`
- ä½¿ç”¨åœºæ™¯ï¼šå­—æ®µé—´è·ä¸å‡åŒ€ï¼Œéœ€è¦ä¼˜åŒ–å¸ƒå±€

**æ¸…é™¤å­—æ®µ**
- åŠŸèƒ½ï¼šä¸€é”®åˆ é™¤æ‰€æœ‰æ˜ç»†é¡¹å­—æ®µ
- ç‰¹ç‚¹ï¼šåªåˆ é™¤fieldä»¥`items.#.`å¼€å¤´çš„å…ƒç´ ï¼Œå…¶ä»–å…ƒç´ ä¸å—å½±å“
- ä½¿ç”¨åœºæ™¯ï¼šé‡æ–°å¼€å§‹è®¾è®¡ã€åˆ‡æ¢é¢„è®¾ç»„åˆ

---

#### 4. è¡Œé«˜è°ƒæ•´å™¨

**åŠŸèƒ½ï¼š** è°ƒæ•´æ‰“å°æ—¶æ¯è¡Œæ˜ç»†é¡¹ä¹‹é—´çš„å‚ç›´é—´è·ï¼ˆ20-40pxï¼‰

**æ¨èå€¼ï¼š**
- 20-22pxï¼šç´§å‡‘å¸ƒå±€ï¼Œé€‚åˆ30+è¡Œæ˜ç»†
- 25-28pxï¼šæ ‡å‡†å¸ƒå±€ï¼Œé€‚åˆ10-20è¡Œæ˜ç»†
- 30-35pxï¼šå®½æ¾å¸ƒå±€ï¼Œé€‚åˆ5-10è¡Œæ˜ç»†
- 35-40pxï¼šå¤§å­—ä½“æ¨¡æ¿ï¼Œé˜²æ­¢å­—ä½“é‡å 

**æŠ€æœ¯å®ç°ï¼š**
- è®¾ç½®å€¼ä¿å­˜åˆ°`window.itemFieldsRowHeight`å…¨å±€å˜é‡
- åœ¨æ‰“å°æ¸²æŸ“æ—¶è¯»å–è¯¥å€¼ï¼Œè°ƒæ•´å¾ªç¯æ‰“å°çš„Yåæ ‡å¢é‡

---

#### 5. å®æ—¶çŠ¶æ€æ˜¾ç¤º

**åŠŸèƒ½ï¼š** é¢æ¿åº•éƒ¨å®æ—¶æ˜¾ç¤ºç”»å¸ƒä¸­æ˜ç»†å­—æ®µçŠ¶æ€

**æ˜¾ç¤ºå†…å®¹ï¼š**
- å·²æ·»åŠ å­—æ®µæ•°é‡
- å­—æ®µåç§°åˆ—è¡¨ï¼ˆå¦‚ï¼šåºå·ã€äº§å“åç§°ã€è§„æ ¼å‹å·...ï¼‰

**æ›´æ–°æ—¶æœºï¼š**
- åº”ç”¨é¢„è®¾ç»„åˆå
- ä½¿ç”¨å¯¹é½å·¥å…·å
- æ¸…é™¤å­—æ®µå
- æ‰‹åŠ¨æ‹–æ‹½å­—æ®µåï¼ˆéœ€è°ƒç”¨`updateItemFieldsStatus()`ï¼‰

---

### ğŸ”§ ä»£ç å®ç°

#### æ¶‰åŠæ–‡ä»¶

**ä¸»æ–‡ä»¶ï¼š** `/templates/sales/template_editor_hiprint.html`

**æ–°å¢ä»£ç ï¼š**
1. **HTMLéƒ¨åˆ†** (ç¬¬541-620è¡Œ)
   - æ˜ç»†åŠ©æ‰‹é¢æ¿ç»“æ„
   - 3ä¸ªé¢„è®¾ç»„åˆæŒ‰é’®
   - è¡Œé«˜æ»‘å—
   - å¯¹é½å·¥å…·æŒ‰é’®
   - çŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ

2. **JavaScriptéƒ¨åˆ†** (ç¬¬1692-1992è¡Œ)
   - `showItemFieldsHelper()` - æ˜¾ç¤º/éšè—é¢æ¿
   - `applyFieldCombination(type)` - åº”ç”¨é¢„è®¾ç»„åˆ
   - `updateRowHeightDisplay(value)` - æ›´æ–°è¡Œé«˜æ˜¾ç¤º
   - `applyRowHeight()` - åº”ç”¨è¡Œé«˜è®¾ç½®
   - `alignItemFields(type)` - å¯¹é½å·¥å…·
   - `clearAllItemFields()` - æ¸…é™¤å­—æ®µ
   - `updateItemFieldsStatus()` - æ›´æ–°çŠ¶æ€æ˜¾ç¤º

**æ ¸å¿ƒç®—æ³•ï¼š**

```javascript
// æ™ºèƒ½Yåæ ‡è®¡ç®—
function calculateStartY(currentJson) {
    var maxY = 0;
    if (currentJson.panels && currentJson.panels[0]) {
        currentJson.panels[0].printElements.forEach(function(elem) {
            var y = elem.options.top + elem.options.height;
            if (y > maxY) maxY = y;
        });
    }
    return maxY + 30;  // åœ¨ç°æœ‰å…ƒç´ ä¸‹æ–¹30px
}

// å‡åŒ€åˆ†å¸ƒç®—æ³•
function distributeEvenly(itemFields) {
    // æŒ‰Xåæ ‡æ’åº
    itemFields.sort((a, b) => a.options.left - b.options.left);

    var firstLeft = itemFields[0].options.left;
    var lastLeft = itemFields[itemFields.length - 1].options.left;
    var totalWidth = lastLeft - firstLeft;
    var gap = totalWidth / (itemFields.length - 1);

    // é‡æ–°åˆ†é…Xåæ ‡
    itemFields.forEach((elem, index) => {
        elem.options.left = firstLeft + (gap * index);
    });
}
```

---

### ğŸ“š æ–°å¢æ–‡æ¡£

#### 1. ITEM_FIELDS_HELPER_GUIDE.md

**å†…å®¹ï¼š**
- æ˜ç»†åŠ©æ‰‹å®Œæ•´ä½¿ç”¨æŒ‡å—
- 3ç§é¢„è®¾ç»„åˆè¯¦è§£
- å¯¹é½å’Œåˆ†å¸ƒå·¥å…·è¯´æ˜
- è¡Œé«˜è°ƒæ•´å™¨ä½¿ç”¨æ–¹æ³•
- å¸¸è§è®¾è®¡æ¨¡å¼
- æœ€ä½³å®è·µ
- å¸¸è§é—®é¢˜è§£ç­”

**ç¯‡å¹…ï¼š** 500+è¡Œ

#### 2. ITEM_FIELDS_DRAG_GUIDE.mdï¼ˆæ›´æ–°ï¼‰

**æ–°å¢ç« èŠ‚ï¼š**
- ğŸš€ ä½¿ç”¨æ˜ç»†åŠ©æ‰‹é¢æ¿ï¼ˆæ¨èï¼‰
- ğŸ“‹ æ‰‹åŠ¨æ‹–æ‹½ vs æ˜ç»†åŠ©æ‰‹å¯¹æ¯”è¡¨

---

### ğŸ“Š æ•°æ®ç»Ÿè®¡

**ä»£ç é‡ï¼š**
- æ–°å¢HTMLï¼š79è¡Œ
- æ–°å¢JavaScriptï¼š300è¡Œ
- æ–°å¢æ–‡æ¡£ï¼š500+è¡Œ
- **æ€»è®¡ï¼š879è¡Œ**

**åŠŸèƒ½ç‚¹ï¼š**
- 9ä¸ªJavaScriptå‡½æ•°
- 3ç§é¢„è®¾ç»„åˆï¼ˆ18ä¸ªå­—æ®µé…ç½®ï¼‰
- 2ç§å¯¹é½å·¥å…·
- 1ä¸ªè¡Œé«˜è°ƒæ•´å™¨
- 1ä¸ªçŠ¶æ€æ˜¾ç¤ºå™¨

---

### ğŸ’¡ ä½¿ç”¨å»ºè®®

**æ¨èå·¥ä½œæµç¨‹ï¼š**
```
1. é€‰æ‹©çº¸å¼  â†’ ç‚¹å‡»"ç”»å¸ƒå°ºå¯¸"ï¼Œé€‰æ‹©A4/A3ç­‰
2. æ·»åŠ åŸºç¡€å…ƒç´  â†’ æ‹–æ‹½æ ‡é¢˜ã€å…¬å¸ä¿¡æ¯ç­‰
3. ä½¿ç”¨æ˜ç»†åŠ©æ‰‹ â†’ ç‚¹å‡»"æ˜ç»†åŠ©æ‰‹"ï¼Œé€‰æ‹©é¢„è®¾ç»„åˆ
4. å¾®è°ƒï¼ˆå¯é€‰ï¼‰ â†’ æ‰‹åŠ¨è°ƒæ•´ä¸ªåˆ«å­—æ®µ
5. å¯¹é½ä¼˜åŒ– â†’ ä½¿ç”¨æ°´å¹³å¯¹é½/å‡åŒ€åˆ†å¸ƒ
6. ä¿å­˜æ¨¡æ¿ â†’ ç‚¹å‡»"ä¿å­˜æ¨¡æ¿"
7. æµ‹è¯•æ‰“å° â†’ æ‰“å¼€æŠ¥ä»·å•è¯¦æƒ…ï¼Œç‚¹å‡»"æ‰“å°"
```

**é€‚ç”¨åœºæ™¯å»ºè®®ï¼š**
- æ—¥å¸¸æŠ¥ä»· â†’ ç®€æ´ç‰ˆ
- æ­£å¼æŠ¥ä»· â†’ æ ‡å‡†ç‰ˆ
- é‡è¦å•†åŠ¡æ–‡æ¡£ â†’ å®Œæ•´ç‰ˆ

---

## ğŸ“… 2025-01-07 æ›´æ–° - è¡¨æ ¼å­—æ®µæ‰©å±• & WYSIWYGåŠŸèƒ½ v1.2

### ğŸ¯ æ›´æ–°æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°ä¸»è¦å®Œæˆä¸¤ä¸ªé‡è¦åŠŸèƒ½ï¼š
1. **æ‰©å±•æ‰“å°è¡¨æ ¼å­—æ®µ** - ä»8åˆ—å¢åŠ åˆ°12åˆ—ï¼ŒåŒ…å«æ›´å®Œæ•´çš„ä¸šåŠ¡ä¿¡æ¯
2. **å®ç°WYSIWYGç¼–è¾‘** - æ‹–æ‹½å…ƒç´ åç«‹å³æ˜¾ç¤ºï¼Œæ— éœ€ä¿å­˜æ¨¡æ¿

---

## ğŸ“Š ä¸€ã€è¡¨æ ¼å­—æ®µæ‰©å±•

### æ–°å¢å­—æ®µ

åœ¨åŸæœ‰è¡¨æ ¼åŸºç¡€ä¸Šï¼Œæ–°å¢äº†4ä¸ªé‡è¦å­—æ®µï¼š

| åºå· | å­—æ®µå | ä¸­æ–‡åç§° | æ•°æ®æ¥æº | å®½åº¦ | å¯¹é½ | è¯´æ˜ |
|------|--------|----------|----------|------|------|------|
| 4 | specification | è§„æ ¼å‹å· | `item.product.specifications` | 120px | å·¦å¯¹é½ | äº§å“è§„æ ¼è¯´æ˜ |
| 6 | unit | å•ä½ | `item.product.unit.name` | 40px | å±…ä¸­ | äº§å“è®¡é‡å•ä½ |
| 9 | tax_rate | ç¨ç‡ | `item.tax_rate` | 45px | å±…ä¸­ | å¢å€¼ç¨ç¨ç‡ï¼Œé»˜è®¤13% |
| 12 | notes | å¤‡æ³¨ | `item.notes` | 100px | å·¦å¯¹é½ | æ˜ç»†é¡¹å¤‡æ³¨ |

### å®Œæ•´è¡¨æ ¼ç»“æ„ï¼ˆ12åˆ—ï¼‰

1. **åºå·** - è‡ªåŠ¨ç¼–å·
2. **äº§å“ç¼–ç ** - `product_code`
3. **äº§å“åç§°** - `product_name`
4. **è§„æ ¼å‹å·** â­ - `specification`
5. **æ•°é‡** - `quantity`
6. **å•ä½** â­ - `unit`
7. **å•ä»·** - `unit_price`
8. **æŠ˜æ‰£ç‡** - `discount_rate`
9. **ç¨ç‡** â­ - `tax_rate`
10. **å°è®¡** - `subtotal`
11. **äº¤è´§æœŸ** - `lead_time`
12. **å¤‡æ³¨** â­ - `notes`

### æ•°æ®åº“å˜æ›´

**æ–°å¢å­—æ®µï¼š**
- `QuoteItem.tax_rate` (DecimalField) - ç¨ç‡ç™¾åˆ†æ¯”ï¼Œé»˜è®¤å€¼13%

**Migrationæ–‡ä»¶ï¼š**
- `apps/sales/migrations/0007_quoteitem_tax_rate.py`

**å·²åº”ç”¨ï¼š** âœ… å·²æˆåŠŸæ‰§è¡Œ `python manage.py migrate sales`

### æ¶‰åŠæ–‡ä»¶

1. **æ¨¡å‹å±‚** - `/apps/sales/models.py`
   - åœ¨ `QuoteItem` æ¨¡å‹ä¸­æ·»åŠ  `tax_rate` å­—æ®µ

2. **æ‰“å°æ¨¡æ¿** - `/templates/sales/quote_print_hiprint.html`
   - ä¿®æ”¹ `quoteData.items` æ•°ç»„ï¼Œæ·»åŠ å­—æ®µæ˜ å°„
   - ä¿®æ”¹ `generateItemsTable()` å‡½æ•°ï¼Œæ¸²æŸ“12åˆ—è¡¨æ ¼
   - è°ƒæ•´è¡¨å¤´ã€è¡¨ä½“ã€è¡¨å°¾çš„colspanå€¼

### æ•°æ®è®¿é—®è·¯å¾„

```javascript
// æŠ¥ä»·å•æ‰“å°æ•°æ®ç»“æ„
items: [
    {
        index: 1,
        product_code: 'BL-001',
        product_name: 'æ¿€å…‰å™¨',
        specification: '10W çº¢å¤–æ¿€å…‰å™¨',        // item.product.specifications
        quantity: '10',
        unit: 'å°',                              // item.product.unit.name
        unit_price: '1000.00',
        discount_rate: '5',
        tax_rate: '13',                          // item.tax_rate (æ–°å¢)
        subtotal: '9500.00',
        lead_time: '30å¤©',
        notes: 'ç‰¹æ®Šå®šåˆ¶'
    }
]
```

---

## ğŸ¨ äºŒã€WYSIWYGåŠŸèƒ½å®ç°

### åŠŸèƒ½è¯´æ˜

**ä¹‹å‰ï¼š** æ‹–æ‹½å…ƒç´  â†’ æ˜¾ç¤º"è¯·ä¿å­˜æ¨¡æ¿" â†’ ç‚¹å‡»ä¿å­˜ â†’ åˆ·æ–°é¡µé¢ â†’ æ‰èƒ½çœ‹åˆ°å…ƒç´ 

**ç°åœ¨ï¼š** æ‹–æ‹½å…ƒç´  â†’ **ç«‹å³åœ¨ç”»å¸ƒæ˜¾ç¤º** âœ¨

### æŠ€æœ¯å®ç°

**æ ¸å¿ƒä¿®æ”¹ï¼š** `/templates/sales/template_editor_hiprint.html`

#### 1. ä½¿ç”¨HiPrintåŸç”ŸAPI

```javascript
function addElementToTemplate(elementData, x, y) {
    var panel = hiprintTemplate.printPanels[0];

    // æ ¹æ®å…ƒç´ ç±»å‹è°ƒç”¨ç›¸åº”API
    switch(elementData.type) {
        case 'text':
            panel.addPrintText(options);
            break;
        case 'image':
            panel.addPrintImage(options);
            break;
        case 'barcode':
            panel.addPrintBarcode(options);
            break;
        case 'qrcode':
            panel.addPrintQrcode(options);
            break;
        case 'hline':
            panel.addPrintHorizontalLine(options);
            break;
        case 'vline':
            panel.addPrintVerticalLine(options);
            break;
    }

    // æ˜¾ç¤ºæˆåŠŸæç¤º
    showTemporaryMessage('å…ƒç´ å·²æ·»åŠ åˆ°ç”»å¸ƒï¼', 'success');
}
```

#### 2. å¤‡ç”¨æ–¹æ¡ˆ

å¦‚æœåŸç”ŸAPIå¤±è´¥ï¼Œè‡ªåŠ¨å›é€€åˆ°JSONä¿®æ”¹æ–¹å¼ï¼š

```javascript
catch (error) {
    console.warn('>>> å°è¯•ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆï¼ˆJSONä¿®æ”¹ï¼‰');
    addElementToTemplateViaJSON(elementData, x, y);
}
```

### æ”¯æŒçš„å…ƒç´ ç±»å‹

| å…ƒç´ ç±»å‹ | HiPrintæ–¹æ³• | è¯´æ˜ |
|---------|------------|------|
| text | `addPrintText()` | æ™®é€šæ–‡æœ¬ã€æ•°æ®å­—æ®µ |
| image | `addPrintImage()` | å›¾ç‰‡ã€Logo |
| barcode | `addPrintBarcode()` | æ¡å½¢ç  |
| qrcode | `addPrintQrcode()` | äºŒç»´ç  |
| hline | `addPrintHorizontalLine()` | æ¨ªçº¿ |
| vline | `addPrintVerticalLine()` | ç«–çº¿ |

### ç”¨æˆ·ä½“éªŒæ”¹è¿›

| æ–¹é¢ | ä¹‹å‰ | ç°åœ¨ |
|------|------|------|
| æ‹–æ‹½åé¦ˆ | æ— åé¦ˆï¼Œéœ€è¦ä¿å­˜åæ‰çœ‹åˆ° | âœ… ç«‹å³æ˜¾ç¤ºåœ¨ç”»å¸ƒ |
| æ“ä½œæ­¥éª¤ | 4æ­¥ï¼ˆæ‹–æ‹½â†’ä¿å­˜â†’åˆ·æ–°â†’æŸ¥çœ‹ï¼‰ | 1æ­¥ï¼ˆæ‹–æ‹½ï¼‰ |
| æç¤ºä¿¡æ¯ | âš ï¸ "è¯·ç‚¹å‡»ä¿å­˜æ¨¡æ¿æŒ‰é’®" | âœ… "å…ƒç´ å·²æ·»åŠ åˆ°ç”»å¸ƒï¼" |
| è°ƒè¯•éš¾åº¦ | é«˜ï¼ˆçœ‹ä¸åˆ°ç»“æœï¼‰ | ä½ï¼ˆå³æ—¶åé¦ˆï¼‰ |

---

## ğŸ“ ä¸‰ã€è‡ªå®šä¹‰è¡¨æ ¼å­—æ®µæŒ‡å—

å¦‚éœ€è¿›ä¸€æ­¥è‡ªå®šä¹‰è¡¨æ ¼å­—æ®µï¼Œè¯·å‚è€ƒï¼š

ğŸ“– **è¯¦ç»†æ–‡æ¡£ï¼š** `/docs/CUSTOMIZE_TABLE_FIELDS.md`

### å¿«é€Ÿç¤ºä¾‹ï¼šæ·»åŠ "äº§å“å›¾ç‰‡"åˆ—

```javascript
// 1. ä¿®æ”¹è¡¨å¤´
html += '<th style="' + thStyle + ' width: 60px;">å›¾ç‰‡</th>';

// 2. ä¿®æ”¹è¡¨ä½“
html += '<td style="' + tdStyle + ' text-align: center;">' +
        '<img src="' + (item.product_image || '') + '" style="max-width: 50px; max-height: 50px;">' +
        '</td>';

// 3. è°ƒæ•´åˆè®¡è¡Œ colspan
html += '<td colspan="10" style="...">åˆè®¡ï¼š</td>';  // åŸæ¥æ˜¯9ï¼Œå¢åŠ 1åˆ—åå˜æˆ10
```

---

## ğŸ”§ å››ã€ç›¸å…³æ–‡ä»¶æ¸…å•

### åç«¯æ–‡ä»¶
- `/apps/sales/models.py` - QuoteItemæ¨¡å‹ï¼ˆæ–°å¢tax_rateå­—æ®µï¼‰
- `/apps/sales/migrations/0007_quoteitem_tax_rate.py` - æ•°æ®åº“è¿ç§»æ–‡ä»¶

### å‰ç«¯æ–‡ä»¶
- `/templates/sales/quote_print_hiprint.html` - æ‰“å°é¢„è§ˆé¡µé¢
  - `quoteData.items` æ•°æ®æ˜ å°„ï¼ˆç¬¬266-283è¡Œï¼‰
  - `generateItemsTable()` è¡¨æ ¼ç”Ÿæˆå‡½æ•°ï¼ˆç¬¬408-491è¡Œï¼‰
- `/templates/sales/template_editor_hiprint.html` - æ¨¡æ¿ç¼–è¾‘å™¨
  - `addElementToTemplate()` æ‹–æ‹½æ·»åŠ å‡½æ•°ï¼ˆç¬¬1004-1129è¡Œï¼‰
  - `addElementToTemplateViaJSON()` å¤‡ç”¨æ–¹æ¡ˆï¼ˆç¬¬1131-1178è¡Œï¼‰

### æ–‡æ¡£æ–‡ä»¶
- `/docs/CUSTOMIZE_TABLE_FIELDS.md` - è¡¨æ ¼å­—æ®µè‡ªå®šä¹‰æŒ‡å—
- `/docs/HIPRINT_TABLE_WORKAROUND.md` - è¡¨æ ¼å ä½ç¬¦æŠ€æœ¯è¯´æ˜
- `/docs/HIPRINT_UPDATE_LOG.md` - æœ¬æ›´æ–°æ—¥å¿—

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

### è¡¨æ ¼å­—æ®µæµ‹è¯•
- [ ] è§„æ ¼å‹å·æ˜¾ç¤ºæ­£ç¡®
- [ ] å•ä½æ˜¾ç¤ºæ­£ç¡®ï¼ˆå¦‚ï¼šå°ã€ä¸ªã€å¥—ç­‰ï¼‰
- [ ] ç¨ç‡æ˜¾ç¤ºä¸ºç™¾åˆ†æ¯”ï¼ˆå¦‚ï¼š13%ï¼‰
- [ ] å¤‡æ³¨å­—æ®µæ˜¾ç¤ºå®Œæ•´
- [ ] è¡¨æ ¼å®½åº¦é€‚åº”A4çº¸å¼ 
- [ ] åˆè®¡è¡Œcolspanæ­£ç¡®ï¼Œä¸é”™ä½

### WYSIWYGåŠŸèƒ½æµ‹è¯•
- [ ] æ‹–æ‹½æ–‡æœ¬å…ƒç´ ç«‹å³æ˜¾ç¤º
- [ ] æ‹–æ‹½æ•°æ®å­—æ®µå…ƒç´ ç«‹å³æ˜¾ç¤º
- [ ] æ‹–æ‹½æ¡å½¢ç å…ƒç´ ç«‹å³æ˜¾ç¤º
- [ ] æ‹–æ‹½äºŒç»´ç å…ƒç´ ç«‹å³æ˜¾ç¤º
- [ ] æ‹–æ‹½çº¿æ¡å…ƒç´ ç«‹å³æ˜¾ç¤º
- [ ] å…ƒç´ å¯ä»¥ç«‹å³è°ƒæ•´ä½ç½®å’Œå¤§å°
- [ ] å…ƒç´ å¯ä»¥ç«‹å³ä¿®æ”¹å±æ€§
- [ ] ä¿å­˜æ¨¡æ¿ååˆ·æ–°ä¸ä¸¢å¤±å…ƒç´ 

### æ‰“å°è¾“å‡ºæµ‹è¯•
- [ ] æµè§ˆå™¨æ‰“å°é¢„è§ˆæ˜¾ç¤ºæ­£ç¡®
- [ ] å¯¼å‡ºPDFå­—æ®µå®Œæ•´
- [ ] æ‰“å°åˆ°æ‰“å°æœºæ ¼å¼æ­£å¸¸

---

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸæ”¹è¿›
1. **è¡¨æ ¼æ ·å¼ä¼˜åŒ–**
   - [ ] æ”¯æŒæ–‘é©¬çº¹ï¼ˆéš”è¡Œå˜è‰²ï¼‰
   - [ ] æ”¯æŒè‡ªå®šä¹‰è¡¨å¤´èƒŒæ™¯è‰²
   - [ ] æ”¯æŒè‡ªå®šä¹‰è¾¹æ¡†æ ·å¼

2. **å­—æ®µæ‰©å±•**
   - [ ] æ·»åŠ "äº§å“å›¾ç‰‡"åˆ—
   - [ ] æ·»åŠ "äº§å“åˆ†ç±»"åˆ—
   - [ ] æ·»åŠ "å“ç‰Œ"åˆ—

### é•¿æœŸè§„åˆ’
1. **å¤šæ¨¡æ¿æ”¯æŒ**
   - [ ] ç®€åŒ–ç‰ˆæ¨¡æ¿ï¼ˆ6åˆ—ï¼‰
   - [ ] æ ‡å‡†ç‰ˆæ¨¡æ¿ï¼ˆ12åˆ—ï¼Œå½“å‰ï¼‰
   - [ ] è¯¦ç»†ç‰ˆæ¨¡æ¿ï¼ˆ15+åˆ—ï¼‰

2. **HiPrintåŸç”Ÿè¡¨æ ¼æ”¯æŒ**
   - [ ] ç­‰å¾…hiprintå®˜æ–¹ä¿®å¤i18né—®é¢˜
   - [ ] è¿ç§»åˆ°åŸç”ŸTablePrintElement
   - [ ] ç§»é™¤è¡¨æ ¼å ä½ç¬¦workaround

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—ï¼ˆF12ï¼‰
2. Djangoæ—¥å¿—æ–‡ä»¶
3. `/docs/` ç›®å½•ä¸‹çš„ç›¸å…³æ–‡æ¡£

**æ›´æ–°æ—¥æœŸï¼š** 2025-01-07
**ç‰ˆæœ¬ï¼š** v1.2 - å¢å¼ºç‰ˆï¼ˆè¡¨æ ¼æ‰©å±• + WYSIWYGï¼‰
**ç»´æŠ¤è€…ï¼š** BetterLaser ERP å¼€å‘å›¢é˜Ÿ
