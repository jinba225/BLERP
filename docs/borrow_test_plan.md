# é‡‡è´­å€Ÿç”¨æ¨¡å—æµ‹è¯•è®¡åˆ’

**ç‰ˆæœ¬**: v1.0
**æ—¥æœŸ**: 2026-01-06
**è´Ÿè´£äºº**: æµ®æµ®é…± (å¹½æµ®å–µ)

---

## ğŸ“‹ æµ‹è¯•ç›®æ ‡

éªŒè¯é‡‡è´­å€Ÿç”¨ç®¡ç†åŠŸèƒ½çš„æ­£ç¡®æ€§ã€å®Œæ•´æ€§å’Œå¯é æ€§ï¼Œç¡®ä¿ï¼š
1. æ‰€æœ‰åŠŸèƒ½æŒ‰é¢„æœŸå·¥ä½œ
2. æ•°æ®è®¡ç®—å‡†ç¡®æ— è¯¯
3. ä¸šåŠ¡æµç¨‹ç¬¦åˆéœ€æ±‚
4. è¾¹ç•Œæ¡ä»¶å¤„ç†æ­£ç¡®
5. å¼‚å¸¸æƒ…å†µå¦¥å–„å¤„ç†

---

## ğŸ¯ æµ‹è¯•èŒƒå›´

### åŒ…å«çš„æµ‹è¯•å†…å®¹
- âœ… æ¨¡å‹å±‚æµ‹è¯•ï¼ˆModelï¼‰
- âœ… ä¸šåŠ¡é€»è¾‘æµ‹è¯•ï¼ˆBusiness Logicï¼‰
- âœ… è§†å›¾åŠŸèƒ½æµ‹è¯•ï¼ˆView Functionsï¼‰
- âœ… æ•°æ®å®Œæ•´æ€§æµ‹è¯•ï¼ˆData Integrityï¼‰
- âœ… æƒé™æ§åˆ¶æµ‹è¯•ï¼ˆPermissionï¼‰
- âœ… è¾¹ç•Œæ¡ä»¶æµ‹è¯•ï¼ˆBoundaryï¼‰
- âœ… å¼‚å¸¸å¤„ç†æµ‹è¯•ï¼ˆException Handlingï¼‰

### ä¸åŒ…å«çš„æµ‹è¯•å†…å®¹
- âŒ æ€§èƒ½å‹åŠ›æµ‹è¯•ï¼ˆç•™å¾…åç»­ï¼‰
- âŒ å‰ç«¯ UI æµ‹è¯•ï¼ˆéœ€è¦ Seleniumï¼‰
- âŒ å¹¶å‘æµ‹è¯•ï¼ˆéœ€è¦ä¸“é—¨çš„å¹¶å‘æµ‹è¯•å·¥å…·ï¼‰

---

## ğŸ§ª æµ‹è¯•ç¯å¢ƒ

- **Python ç‰ˆæœ¬**: 3.13
- **Django ç‰ˆæœ¬**: 4.2.7
- **æ•°æ®åº“**: SQLiteï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- **æµ‹è¯•æ¡†æ¶**: Django TestCase
- **æµ‹è¯•å‘½ä»¤**: `python manage.py test apps.purchase.tests.test_borrow`

---

## ğŸ“ æµ‹è¯•ç”¨ä¾‹è®¾è®¡

### 1ï¸âƒ£ æ¨¡å‹å±‚æµ‹è¯•ï¼ˆModel Testsï¼‰

#### 1.1 Borrow æ¨¡å‹æµ‹è¯•

| æµ‹è¯•ç”¨ä¾‹ ID | æµ‹è¯•ç”¨ä¾‹åç§° | æµ‹è¯•ç›®çš„ | ä¼˜å…ˆçº§ |
|------------|-------------|---------|--------|
| MT-B-001 | test_borrow_creation | éªŒè¯å€Ÿç”¨å•åˆ›å»º | P0 |
| MT-B-002 | test_borrow_number_unique | éªŒè¯å€Ÿç”¨å•å·å”¯ä¸€æ€§ | P0 |
| MT-B-003 | test_borrow_status_choices | éªŒè¯æ‰€æœ‰çŠ¶æ€é€‰é¡¹ | P1 |
| MT-B-004 | test_total_borrowed_quantity | éªŒè¯æ€»å€Ÿç”¨æ•°é‡è®¡ç®— | P0 |
| MT-B-005 | test_total_returned_quantity | éªŒè¯æ€»å½’è¿˜æ•°é‡è®¡ç®— | P0 |
| MT-B-006 | test_total_remaining_quantity | éªŒè¯å‰©ä½™æ•°é‡è®¡ç®— | P0 |
| MT-B-007 | test_is_fully_returned | éªŒè¯æ˜¯å¦å…¨éƒ¨å½’è¿˜åˆ¤æ–­ | P1 |
| MT-B-008 | test_borrow_soft_delete | éªŒè¯è½¯åˆ é™¤åŠŸèƒ½ | P1 |
| MT-B-009 | test_borrow_str_representation | éªŒè¯å­—ç¬¦ä¸²è¡¨ç¤º | P2 |

#### 1.2 BorrowItem æ¨¡å‹æµ‹è¯•

| æµ‹è¯•ç”¨ä¾‹ ID | æµ‹è¯•ç”¨ä¾‹åç§° | æµ‹è¯•ç›®çš„ | ä¼˜å…ˆçº§ |
|------------|-------------|---------|--------|
| MT-BI-001 | test_borrow_item_creation | éªŒè¯æ˜ç»†åˆ›å»º | P0 |
| MT-BI-002 | test_remaining_quantity_property | éªŒè¯å‰©ä½™æ•°é‡å±æ€§ | P0 |
| MT-BI-003 | test_can_convert_property | éªŒè¯å¯è½¬é‡‡è´­åˆ¤æ–­ | P1 |
| MT-BI-004 | test_quantity_precision | éªŒè¯æ•°é‡ç²¾åº¦ï¼ˆ4ä½å°æ•°ï¼‰| P1 |
| MT-BI-005 | test_price_precision | éªŒè¯ä»·æ ¼ç²¾åº¦ï¼ˆ2ä½å°æ•°ï¼‰| P1 |
| MT-BI-006 | test_cascade_delete | éªŒè¯çº§è”åˆ é™¤ | P1 |
| MT-BI-007 | test_borrow_item_str_representation | éªŒè¯å­—ç¬¦ä¸²è¡¨ç¤º | P2 |

### 2ï¸âƒ£ ä¸šåŠ¡é€»è¾‘æµ‹è¯•ï¼ˆBusiness Logic Testsï¼‰

#### 2.1 å½’è¿˜æµç¨‹æµ‹è¯•

| æµ‹è¯•ç”¨ä¾‹ ID | æµ‹è¯•ç”¨ä¾‹åç§° | æµ‹è¯•ç›®çš„ | ä¼˜å…ˆçº§ |
|------------|-------------|---------|--------|
| BL-R-001 | test_full_return | éªŒè¯å…¨éƒ¨å½’è¿˜åŠŸèƒ½ | P0 |
| BL-R-002 | test_partial_return | éªŒè¯éƒ¨åˆ†å½’è¿˜åŠŸèƒ½ | P0 |
| BL-R-003 | test_multiple_partial_returns | éªŒè¯å¤šæ¬¡éƒ¨åˆ†å½’è¿˜ | P0 |
| BL-R-004 | test_return_exceeds_remaining | éªŒè¯å½’è¿˜æ•°é‡è¶…é™æ£€æŸ¥ | P0 |
| BL-R-005 | test_return_status_update | éªŒè¯å½’è¿˜åçŠ¶æ€æ›´æ–° | P0 |

#### 2.2 è½¬é‡‡è´­æµç¨‹æµ‹è¯•

| æµ‹è¯•ç”¨ä¾‹ ID | æµ‹è¯•ç”¨ä¾‹åç§° | æµ‹è¯•ç›®çš„ | ä¼˜å…ˆçº§ |
|------------|-------------|---------|--------|
| BL-C-001 | test_conversion_request | éªŒè¯è½¬é‡‡è´­è¯·æ±‚æäº¤ | P0 |
| BL-C-002 | test_conversion_approval | éªŒè¯è½¬é‡‡è´­å®¡æ ¸é€šè¿‡ | P0 |
| BL-C-003 | test_purchase_order_generation | éªŒè¯é‡‡è´­è®¢å•ç”Ÿæˆ | P0 |
| BL-C-004 | test_conversion_with_manual_price | éªŒè¯æ‰‹åŠ¨è¾“å…¥ä»·æ ¼ | P0 |
| BL-C-005 | test_partial_conversion | éªŒè¯éƒ¨åˆ†è½¬é‡‡è´­ | P0 |
| BL-C-006 | test_conversion_exceeds_remaining | éªŒè¯è½¬é‡‡è´­æ•°é‡è¶…é™æ£€æŸ¥ | P0 |
| BL-C-007 | test_conversion_idempotency | éªŒè¯è½¬é‡‡è´­å¹‚ç­‰æ€§ | P1 |

#### 2.3 çŠ¶æ€æµè½¬æµ‹è¯•

| æµ‹è¯•ç”¨ä¾‹ ID | æµ‹è¯•ç”¨ä¾‹åç§° | æµ‹è¯•ç›®çš„ | ä¼˜å…ˆçº§ |
|------------|-------------|---------|--------|
| BL-S-001 | test_draft_to_borrowed | éªŒè¯è‰ç¨¿â†’å€Ÿç”¨ä¸­ | P0 |
| BL-S-002 | test_borrowed_to_partially_returned | éªŒè¯å€Ÿç”¨ä¸­â†’éƒ¨åˆ†å½’è¿˜ | P0 |
| BL-S-003 | test_partially_returned_to_fully_returned | éªŒè¯éƒ¨åˆ†å½’è¿˜â†’å…¨éƒ¨å½’è¿˜ | P0 |
| BL-S-004 | test_borrowed_to_converting | éªŒè¯å€Ÿç”¨ä¸­â†’è½¬æ¢ä¸­ | P0 |
| BL-S-005 | test_converting_to_converted | éªŒè¯è½¬æ¢ä¸­â†’å·²è½¬é‡‡è´­ | P0 |
| BL-S-006 | test_invalid_status_transitions | éªŒè¯æ— æ•ˆçŠ¶æ€è½¬æ¢é˜»æ­¢ | P1 |

### 3ï¸âƒ£ è§†å›¾åŠŸèƒ½æµ‹è¯•ï¼ˆView Testsï¼‰

| æµ‹è¯•ç”¨ä¾‹ ID | æµ‹è¯•ç”¨ä¾‹åç§° | æµ‹è¯•ç›®çš„ | ä¼˜å…ˆçº§ |
|------------|-------------|---------|--------|
| VT-001 | test_borrow_list_view | éªŒè¯åˆ—è¡¨é¡µè®¿é—® | P0 |
| VT-002 | test_borrow_list_filtering | éªŒè¯åˆ—è¡¨ç­›é€‰åŠŸèƒ½ | P1 |
| VT-003 | test_borrow_create_view | éªŒè¯åˆ›å»ºé¡µè®¿é—® | P0 |
| VT-004 | test_borrow_create_post | éªŒè¯åˆ›å»ºæäº¤ | P0 |
| VT-005 | test_borrow_detail_view | éªŒè¯è¯¦æƒ…é¡µè®¿é—® | P0 |
| VT-006 | test_borrow_update_view | éªŒè¯ç¼–è¾‘é¡µè®¿é—® | P0 |
| VT-007 | test_borrow_update_post | éªŒè¯ç¼–è¾‘æäº¤ | P0 |
| VT-008 | test_borrow_return_view | éªŒè¯å½’è¿˜é¡µè®¿é—® | P0 |
| VT-009 | test_borrow_return_post | éªŒè¯å½’è¿˜æäº¤ | P0 |
| VT-010 | test_borrow_request_conversion_view | éªŒè¯è½¬é‡‡è´­è¯·æ±‚é¡µè®¿é—® | P0 |
| VT-011 | test_borrow_request_conversion_post | éªŒè¯è½¬é‡‡è´­è¯·æ±‚æäº¤ | P0 |
| VT-012 | test_borrow_approve_conversion | éªŒè¯è½¬é‡‡è´­å®¡æ ¸ | P0 |

### 4ï¸âƒ£ æƒé™æ§åˆ¶æµ‹è¯•ï¼ˆPermission Testsï¼‰

| æµ‹è¯•ç”¨ä¾‹ ID | æµ‹è¯•ç”¨ä¾‹åç§° | æµ‹è¯•ç›®çš„ | ä¼˜å…ˆçº§ |
|------------|-------------|---------|--------|
| PT-001 | test_login_required | éªŒè¯ç™»å½•å¿…éœ€ | P0 |
| PT-002 | test_edit_permission_draft_only | éªŒè¯ä»…è‰ç¨¿å¯ç¼–è¾‘ | P0 |
| PT-003 | test_return_permission_check | éªŒè¯å½’è¿˜æƒé™æ£€æŸ¥ | P0 |
| PT-004 | test_conversion_permission_check | éªŒè¯è½¬é‡‡è´­æƒé™æ£€æŸ¥ | P0 |
| PT-005 | test_approval_staff_only | éªŒè¯å®¡æ ¸ä»…ç®¡ç†å‘˜ | P0 |

### 5ï¸âƒ£ è¾¹ç•Œæ¡ä»¶æµ‹è¯•ï¼ˆBoundary Testsï¼‰

| æµ‹è¯•ç”¨ä¾‹ ID | æµ‹è¯•ç”¨ä¾‹åç§° | æµ‹è¯•ç›®çš„ | ä¼˜å…ˆçº§ |
|------------|-------------|---------|--------|
| BT-001 | test_zero_quantity | éªŒè¯é›¶æ•°é‡å¤„ç† | P0 |
| BT-002 | test_negative_quantity | éªŒè¯è´Ÿæ•°æ•°é‡é˜»æ­¢ | P0 |
| BT-003 | test_decimal_precision | éªŒè¯å°æ•°ç²¾åº¦å¤„ç† | P1 |
| BT-004 | test_large_quantity | éªŒè¯å¤§æ•°é‡å¤„ç† | P1 |
| BT-005 | test_empty_items | éªŒè¯ç©ºæ˜ç»†é˜»æ­¢ | P0 |
| BT-006 | test_zero_price | éªŒè¯é›¶ä»·æ ¼é˜»æ­¢ | P0 |

### 6ï¸âƒ£ å¼‚å¸¸å¤„ç†æµ‹è¯•ï¼ˆException Testsï¼‰

| æµ‹è¯•ç”¨ä¾‹ ID | æµ‹è¯•ç”¨ä¾‹åç§° | æµ‹è¯•ç›®çš„ | ä¼˜å…ˆçº§ |
|------------|-------------|---------|--------|
| ET-001 | test_invalid_supplier | éªŒè¯æ— æ•ˆä¾›åº”å•†å¤„ç† | P1 |
| ET-002 | test_invalid_product | éªŒè¯æ— æ•ˆäº§å“å¤„ç† | P1 |
| ET-003 | test_invalid_status_operation | éªŒè¯æ— æ•ˆçŠ¶æ€æ“ä½œ | P0 |
| ET-004 | test_duplicate_borrow_number | éªŒè¯é‡å¤å•æ®å·å¤„ç† | P1 |
| ET-005 | test_conversion_already_converted | éªŒè¯é‡å¤è½¬é‡‡è´­å¤„ç† | P1 |

---

## ğŸ”§ æµ‹è¯•æ•°æ®å‡†å¤‡

### å¿…éœ€çš„æµ‹è¯•æ•°æ®
1. **ç”¨æˆ·æ•°æ®**:
   - æ™®é€šç”¨æˆ·ï¼ˆç»åŠäººï¼‰
   - ç®¡ç†å‘˜ç”¨æˆ·ï¼ˆå®¡æ ¸äººï¼‰

2. **ä¾›åº”å•†æ•°æ®**:
   - è‡³å°‘2ä¸ªæ´»è·ƒä¾›åº”å•†

3. **äº§å“æ•°æ®**:
   - è‡³å°‘3ä¸ªæ´»è·ƒäº§å“ï¼ˆä¸åŒå•ä½ï¼‰

4. **ä»“åº“æ•°æ®**:
   - è‡³å°‘1ä¸ªæ´»è·ƒä»“åº“

---

## âœ… æµ‹è¯•é€šè¿‡æ ‡å‡†

### å•å…ƒæµ‹è¯•é€šè¿‡æ ‡å‡†
- æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹100%é€šè¿‡
- ä»£ç è¦†ç›–ç‡ â‰¥ 90%
- æ— æµ‹è¯•é”™è¯¯æˆ–å¤±è´¥

### åŠŸèƒ½æµ‹è¯•é€šè¿‡æ ‡å‡†
- æ‰€æœ‰ P0 çº§åˆ«æµ‹è¯•ç”¨ä¾‹é€šè¿‡
- P1 çº§åˆ«æµ‹è¯•ç”¨ä¾‹é€šè¿‡ç‡ â‰¥ 95%
- P2 çº§åˆ«æµ‹è¯•ç”¨ä¾‹é€šè¿‡ç‡ â‰¥ 80%

### æ•°æ®å®Œæ•´æ€§æ ‡å‡†
- æ‰€æœ‰æ•°æ®è®¡ç®—å‡†ç¡®
- çŠ¶æ€æµè½¬æ­£ç¡®
- æ•°æ®åº“çº¦æŸæœ‰æ•ˆ

---

## ğŸ“Š æµ‹è¯•æ‰§è¡Œè®¡åˆ’

### æµ‹è¯•é˜¶æ®µ
1. **Phase 1**: æ¨¡å‹å±‚æµ‹è¯•ï¼ˆä¼˜å…ˆçº§ P0-P1ï¼‰
2. **Phase 2**: ä¸šåŠ¡é€»è¾‘æµ‹è¯•ï¼ˆä¼˜å…ˆçº§ P0ï¼‰
3. **Phase 3**: è§†å›¾åŠŸèƒ½æµ‹è¯•ï¼ˆä¼˜å…ˆçº§ P0ï¼‰
4. **Phase 4**: æƒé™æ§åˆ¶æµ‹è¯•ï¼ˆä¼˜å…ˆçº§ P0ï¼‰
5. **Phase 5**: è¾¹ç•Œå’Œå¼‚å¸¸æµ‹è¯•ï¼ˆä¼˜å…ˆçº§ P0-P1ï¼‰
6. **Phase 6**: è¡¥å……æµ‹è¯•ï¼ˆä¼˜å…ˆçº§ P2ï¼‰

### é¢„è®¡æ—¶é—´
- **æµ‹è¯•å‡†å¤‡**: 30åˆ†é’Ÿï¼ˆåˆ›å»ºæµ‹è¯•æ–‡ä»¶ã€å‡†å¤‡æµ‹è¯•æ•°æ®ï¼‰
- **æµ‹è¯•æ‰§è¡Œ**: 1-2å°æ—¶ï¼ˆç¼–å†™å’Œè¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼‰
- **é—®é¢˜ä¿®å¤**: æ ¹æ®å‘ç°çš„é—®é¢˜è€Œå®š
- **å›å½’æµ‹è¯•**: 30åˆ†é’Ÿ

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Šè¦æ±‚

æµ‹è¯•å®Œæˆåï¼Œå°†ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š
1. æµ‹è¯•æ‰§è¡Œæ‘˜è¦
2. æµ‹è¯•ç”¨ä¾‹é€šè¿‡ç‡ç»Ÿè®¡
3. å‘ç°çš„é—®é¢˜åˆ—è¡¨ï¼ˆå¦‚æœ‰ï¼‰
4. ä»£ç è¦†ç›–ç‡æŠ¥å‘Š
5. æ”¹è¿›å»ºè®®

---

## ğŸ¯ é£é™©è¯„ä¼°

### é«˜é£é™©é¡¹
- â— æ•°é‡è®¡ç®—é”™è¯¯ï¼ˆå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼‰
- â— çŠ¶æ€æµè½¬é”™è¯¯ï¼ˆå¯èƒ½å¯¼è‡´ä¸šåŠ¡æµç¨‹æ··ä¹±ï¼‰
- â— è½¬é‡‡è´­ç”Ÿæˆè®¢å•å¤±è´¥ï¼ˆå¯èƒ½å¯¼è‡´æ•°æ®ä¸å®Œæ•´ï¼‰

### ä¸­é£é™©é¡¹
- âš ï¸ æƒé™æ§åˆ¶ä¸ä¸¥æ ¼ï¼ˆå¯èƒ½å¯¼è‡´è¶Šæƒæ“ä½œï¼‰
- âš ï¸ è¾¹ç•Œæ¡ä»¶å¤„ç†ä¸å½“ï¼ˆå¯èƒ½å¯¼è‡´å¼‚å¸¸ï¼‰

### ä½é£é™©é¡¹
- â„¹ï¸ UI æ˜¾ç¤ºé—®é¢˜ï¼ˆä¸å½±å“æ ¸å¿ƒåŠŸèƒ½ï¼‰
- â„¹ï¸ æ¬¡è¦å­—æ®µéªŒè¯ï¼ˆå¯åç»­ä¼˜åŒ–ï¼‰

---

**æµ‹è¯•è®¡åˆ’åˆ¶è®¢å®Œæˆï¼è¯·ä¸»äººç¡®è®¤åï¼Œæµ®æµ®é…±å°†å¼€å§‹æ‰§è¡Œæµ‹è¯•å–µ Ï†(â‰§Ï‰â‰¦*)â™ª**
