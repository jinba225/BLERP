<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>HiPrint æ˜ç»†é¡¹å¿«é€Ÿæµ‹è¯•</title>
    <style>
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 { color: #3b82f6; margin-bottom: 20px; }
        .section {
            margin: 20px 0;
            padding: 20px;
            background: #f9fafb;
            border-left: 4px solid #3b82f6;
            border-radius: 4px;
        }
        .warning {
            background: #fef3c7;
            border-left-color: #f59e0b;
            padding: 15px;
            margin: 20px 0;
        }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: "Courier New", monospace;
            font-size: 13px;
            line-height: 1.5;
            margin: 15px 0;
        }
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: #3b82f6;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            cursor: pointer;
            border: none;
            font-size: 16px;
            margin: 5px;
        }
        .btn:hover { background: #2563eb; }
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        ol { line-height: 2; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª HiPrint æ˜ç»†é¡¹å¾ªç¯æµ‹è¯•</h1>
        <p style="color: #6b7280;">å¿«é€ŸéªŒè¯ HiPrint æ˜¯å¦èƒ½æ­£ç¡®å¤„ç†æ˜ç»†é¡¹æ•°æ®</p>

        <div class="warning">
            <strong>âš ï¸ æ“ä½œæ­¥éª¤ï¼š</strong>
            <ol style="margin: 10px 0; padding-left: 20px;">
                <li><strong>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜</strong>ï¼šCtrl+Shift+R æˆ– Cmd+Shift+R</li>
                <li>æ‰“å¼€æ¨¡æ¿ç¼–è¾‘å™¨ï¼š<code>http://127.0.0.1:8000/sales/templates/1/edit/</code></li>
                <li>æŒ‰ <strong>F12</strong> æ‰“å¼€å¼€å‘è€…å·¥å…·</li>
                <li>å¤åˆ¶ä¸‹é¢çš„æµ‹è¯•è„šæœ¬åˆ° Console è¿è¡Œ</li>
            </ol>
        </div>

        <div class="section">
            <h2>ğŸ“‹ æµ‹è¯•è„šæœ¬ 1ï¼šéªŒè¯æ•°æ®ç»“æ„</h2>
            <p>å…ˆè¿è¡Œè¿™ä¸ªè„šæœ¬ï¼Œæ£€æŸ¥æµ‹è¯•æ•°æ®æ˜¯å¦æ­£ç¡®ï¼š</p>
            <div class="code-block">
// éªŒè¯æµ‹è¯•æ•°æ®
(function() {
    console.clear();
    console.log('%c=== æµ‹è¯•æ•°æ®éªŒè¯ ===', 'color: #3b82f6; font-size: 16px; font-weight: bold');

    if (typeof getSampleData !== 'function') {
        console.error('âŒ getSampleData å‡½æ•°ä¸å­˜åœ¨ï¼');
        return;
    }

    var data = getSampleData();

    console.log('\n1. åŸºæœ¬ä¿¡æ¯:');
    console.log('  æŠ¥ä»·å•å·:', data.quote_number);
    console.log('  å®¢æˆ·åç§°:', data.customer_name);

    console.log('\n2. æ˜ç»†é¡¹æ£€æŸ¥:');
    console.log('  items æ˜¯æ•°ç»„:', Array.isArray(data.items));
    console.log('  items æ•°é‡:', data.items ? data.items.length : 0);

    if (!data.items || data.items.length === 0) {
        console.error('âŒ æ˜ç»†é¡¹æ•°æ®ä¸ºç©ºï¼');
        return;
    }

    console.log('\n3. æ˜ç»†é¡¹å†…å®¹:');
    console.table(data.items);

    console.log('\n4. ç¬¬ä¸€æ¡æ˜ç»†çš„å­—æ®µ:');
    var firstItem = data.items[0];
    Object.keys(firstItem).forEach(function(key) {
        console.log('  ' + key + ':', firstItem[key]);
    });

    console.log('\n%câœ… æ•°æ®ç»“æ„æ­£ç¡®ï¼', 'color: #10b981; font-weight: bold');
})();
            </div>
        </div>

        <div class="section">
            <h2>ğŸ” æµ‹è¯•è„šæœ¬ 2ï¼šæ£€æŸ¥æ¨¡æ¿é…ç½®</h2>
            <p>æ£€æŸ¥æ¨¡æ¿ä¸­æ˜¯å¦æœ‰æ˜ç»†é¡¹å­—æ®µï¼š</p>
            <div class="code-block">
// æ£€æŸ¥æ¨¡æ¿é…ç½®
(function() {
    console.clear();
    console.log('%c=== æ¨¡æ¿é…ç½®æ£€æŸ¥ ===', 'color: #3b82f6; font-size: 16px; font-weight: bold');

    if (typeof hiprintTemplate === 'undefined') {
        console.error('âŒ hiprintTemplate ä¸å­˜åœ¨ï¼');
        return;
    }

    var json = hiprintTemplate.getJson();

    if (!json.panels || !json.panels[0]) {
        console.error('âŒ æ¨¡æ¿æ²¡æœ‰ç”»å¸ƒï¼');
        return;
    }

    var elements = json.panels[0].printElements || [];
    console.log('1. ç”»å¸ƒä¸Šçš„å…ƒç´ æ€»æ•°:', elements.length);

    // æ‰¾å‡ºæ˜ç»†é¡¹å­—æ®µ
    var itemFields = elements.filter(function(elem) {
        return elem.options && elem.options.field &&
               elem.options.field.indexOf('items.#.') === 0;
    });

    console.log('2. æ˜ç»†é¡¹å­—æ®µæ•°é‡:', itemFields.length);

    if (itemFields.length === 0) {
        console.warn('%câš ï¸ è­¦å‘Šï¼šç”»å¸ƒä¸­æ²¡æœ‰æ˜ç»†é¡¹å­—æ®µï¼', 'color: #f59e0b; font-weight: bold');
        console.log('\nè§£å†³æ–¹æ³•:');
        console.log('  1. ä»å·¦ä¾§å…ƒç´ åº“æ‰¾åˆ° "ğŸ“¦ æ˜ç»†é¡¹å­—æ®µ" åˆ†ç»„');
        console.log('  2. æ‹–æ‹½å­—æ®µï¼ˆå¦‚"äº§å“åç§°"ï¼‰åˆ°ç”»å¸ƒ');
        console.log('  3. å†æ¬¡è¿è¡Œæ­¤è„šæœ¬');
        return;
    }

    console.log('\n3. æ˜ç»†é¡¹å­—æ®µåˆ—è¡¨:');
    itemFields.forEach(function(field, index) {
        var opts = field.options;
        console.log('  ' + (index + 1) + '. ' + opts.field);
        console.log('     ä½ç½®: (' + opts.left + ', ' + opts.top + ')');
        console.log('     å°ºå¯¸: ' + opts.width + 'x' + opts.height);
        console.log('     testData:', opts.testData);
        console.log('');
    });

    console.log('%câœ… æ¨¡æ¿é…ç½®æ­£ç¡®ï¼', 'color: #10b981; font-weight: bold');
})();
            </div>
        </div>

        <div class="section">
            <h2>ğŸ¯ æµ‹è¯•è„šæœ¬ 3ï¼šæ‰‹åŠ¨è§¦å‘é¢„è§ˆï¼ˆå¸¦è¯¦ç»†æ—¥å¿—ï¼‰</h2>
            <p>è¿™ä¸ªè„šæœ¬ä¼šè¯¦ç»†è®°å½•é¢„è§ˆè¿‡ç¨‹ï¼š</p>
            <div class="code-block">
// æ‰‹åŠ¨è§¦å‘é¢„è§ˆï¼ˆå¢å¼ºç‰ˆï¼‰
(function() {
    console.clear();
    console.log('%c=== é¢„è§ˆæµ‹è¯•ï¼ˆå¢å¼ºç‰ˆï¼‰===', 'color: #3b82f6; font-size: 16px; font-weight: bold');

    // 1. æ£€æŸ¥æ¨¡æ¿
    if (!hiprintTemplate) {
        alert('âŒ æ¨¡æ¿æœªåˆå§‹åŒ–ï¼');
        return;
    }

    // 2. è·å–æ•°æ®
    var data = getSampleData();
    console.log('\n1. å‡†å¤‡æ•°æ®:');
    console.log('  æ˜ç»†é¡¹æ•°é‡:', data.items.length);

    // 3. æ£€æŸ¥æ¨¡æ¿ä¸­çš„æ˜ç»†é¡¹å­—æ®µ
    var json = hiprintTemplate.getJson();
    var itemFields = json.panels[0].printElements.filter(function(e) {
        return e.options && e.options.field && e.options.field.indexOf('items.#.') === 0;
    });

    console.log('\n2. æ¨¡æ¿é…ç½®:');
    console.log('  æ˜ç»†é¡¹å­—æ®µæ•°é‡:', itemFields.length);

    if (itemFields.length === 0) {
        alert('âš ï¸ è­¦å‘Šï¼šæ¨¡æ¿ä¸­æ²¡æœ‰æ˜ç»†é¡¹å­—æ®µï¼\n\nè¯·å…ˆä»å·¦ä¾§æ‹–æ‹½æ˜ç»†é¡¹å­—æ®µåˆ°ç”»å¸ƒã€‚');
        return;
    }

    // 4. æ‰“å°æ˜ç»†å­—æ®µå’Œå¯¹åº”æ•°æ®çš„æ˜ å°„
    console.log('\n3. å­—æ®µä¸æ•°æ®æ˜ å°„:');
    itemFields.forEach(function(field) {
        var fieldName = field.options.field.replace('items.#.', '');
        var sampleValue = data.items[0][fieldName];
        console.log('  ' + field.options.field + ' â†’ ' + sampleValue);
    });

    // 5. è°ƒç”¨é¢„è§ˆ
    console.log('\n4. è°ƒç”¨ HiPrint é¢„è§ˆ...');
    try {
        hiprintTemplate.print(data, {}, {
            callback: function() {
                console.log('%câœ… é¢„è§ˆçª—å£å·²æ‰“å¼€ï¼', 'color: #10b981; font-weight: bold');
                console.log('\nè¯·æ£€æŸ¥é¢„è§ˆçª—å£ä¸­:');
                console.log('  - æ˜¯å¦æ˜¾ç¤ºäº† ' + data.items.length + ' æ¡æ˜ç»†æ•°æ®ï¼Ÿ');
                console.log('  - æ•°æ®å†…å®¹æ˜¯å¦æ­£ç¡®ï¼Ÿ');
            }
        });
    } catch (e) {
        console.error('âŒ é¢„è§ˆå¤±è´¥:', e);
        alert('é¢„è§ˆå¤±è´¥: ' + e.message);
    }
})();
            </div>
        </div>

        <div class="section">
            <h2>ğŸš€ æµ‹è¯•è„šæœ¬ 4ï¼šä¸€é”®è‡ªåŠ¨æµ‹è¯•ï¼ˆæ¨èï¼‰</h2>
            <p>è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨æ·»åŠ æµ‹è¯•å­—æ®µå¹¶è§¦å‘é¢„è§ˆï¼š</p>
            <div class="code-block">
// ä¸€é”®è‡ªåŠ¨æµ‹è¯•
(function() {
    console.clear();
    console.log('%c=== ä¸€é”®è‡ªåŠ¨æµ‹è¯• ===', 'color: #3b82f6; font-size: 16px; font-weight: bold');

    if (!hiprintTemplate || !hiprintTemplate.printPanels || !hiprintTemplate.printPanels[0]) {
        alert('âŒ æ¨¡æ¿æœªåˆå§‹åŒ–ï¼');
        return;
    }

    var panel = hiprintTemplate.printPanels[0];
    var json = hiprintTemplate.getJson();

    // æ£€æŸ¥æ˜¯å¦å·²æœ‰æ˜ç»†å­—æ®µ
    var itemFields = json.panels[0].printElements.filter(function(e) {
        return e.options && e.options.field && e.options.field.indexOf('items.#.') === 0;
    });

    if (itemFields.length === 0) {
        console.log('1. ç”»å¸ƒä¸­æ²¡æœ‰æ˜ç»†å­—æ®µï¼Œæ­£åœ¨è‡ªåŠ¨æ·»åŠ ...');

        // è‡ªåŠ¨æ·»åŠ æ˜ç»†å­—æ®µ
        var fields = [
            { field: 'index', title: 'åºå·', left: 50, width: 40, testData: '1' },
            { field: 'product_name', title: 'äº§å“åç§°', left: 100, width: 200, testData: 'å…‰çº¤æ¿€å…‰å™¨ 1000W' },
            { field: 'specification', title: 'è§„æ ¼', left: 310, width: 150, testData: 'IPG YLR-1000' },
            { field: 'quantity', title: 'æ•°é‡', left: 470, width: 60, testData: '2' },
            { field: 'unit', title: 'å•ä½', left: 540, width: 50, testData: 'å°' },
            { field: 'unit_price', title: 'å•ä»·', left: 600, width: 80, testData: '35000.00' },
            { field: 'subtotal', title: 'å°è®¡', left: 690, width: 90, testData: '70000.00' }
        ];

        fields.forEach(function(f) {
            panel.addPrintText({
                left: f.left,
                top: 150,
                width: f.width,
                height: 20,
                field: 'items.#.' + f.field,
                testData: f.testData,
                title: f.title,
                hideTitle: true,
                fontSize: 11,
                textAlign: f.field === 'index' || f.field === 'unit' ? 'center' :
                          f.field === 'product_name' || f.field === 'specification' ? 'left' : 'right',
                borderWidth: 1,
                borderColor: '#d1d5db',
                borderStyle: 'solid'
            });
        });

        console.log('  âœ… å·²æ·»åŠ  ' + fields.length + ' ä¸ªæ˜ç»†å­—æ®µ');
    } else {
        console.log('1. ç”»å¸ƒä¸­å·²æœ‰ ' + itemFields.length + ' ä¸ªæ˜ç»†å­—æ®µ');
    }

    // è§¦å‘é¢„è§ˆ
    console.log('\n2. å‡†å¤‡é¢„è§ˆæ•°æ®...');
    var data = getSampleData();
    console.log('  æ˜ç»†é¡¹æ•°é‡:', data.items.length);
    console.log('  æ˜ç»†å†…å®¹:');
    data.items.forEach(function(item, i) {
        console.log('    ' + (i+1) + '. ' + item.product_name);
    });

    console.log('\n3. æ‰“å¼€é¢„è§ˆçª—å£...');
    setTimeout(function() {
        try {
            hiprintTemplate.print(data);
            console.log('%câœ… é¢„è§ˆå·²å¯åŠ¨ï¼', 'color: #10b981; font-size: 14px; font-weight: bold');
            console.log('\nè¯·æ£€æŸ¥é¢„è§ˆçª—å£ï¼š');
            console.log('  - åº”è¯¥æ˜¾ç¤º ' + data.items.length + ' è¡Œæ˜ç»†æ•°æ®');
            console.log('  - åŒ…å«ï¼šå…‰çº¤æ¿€å…‰å™¨ã€æ¿€å…‰åˆ‡å‰²æœºã€é˜²æŠ¤çœ¼é•œã€å®‰è£…æœåŠ¡');
        } catch (e) {
            console.error('âŒ é¢„è§ˆå¤±è´¥:', e);
        }
    }, 500);
})();
            </div>
        </div>

        <div style="margin-top: 40px; padding: 20px; background: #dbeafe; border-radius: 6px;">
            <h3 style="color: #1e40af; margin-top: 0;">ğŸ’¡ ä½¿ç”¨å»ºè®®</h3>
            <ol style="line-height: 2; color: #1e3a8a;">
                <li><strong>æŒ‰é¡ºåºè¿è¡Œ</strong>ï¼šå…ˆè¿è¡Œè„šæœ¬ 1ã€2 æ£€æŸ¥é…ç½®</li>
                <li><strong>å¿«é€Ÿæµ‹è¯•</strong>ï¼šç›´æ¥è¿è¡Œè„šæœ¬ 4ï¼ˆä¸€é”®è‡ªåŠ¨æµ‹è¯•ï¼‰</li>
                <li><strong>è¯¦ç»†è°ƒè¯•</strong>ï¼šå¦‚æœæœ‰é—®é¢˜ï¼Œè¿è¡Œè„šæœ¬ 3 æŸ¥çœ‹è¯¦ç»†æ—¥å¿—</li>
            </ol>
        </div>

        <div style="margin-top: 30px; text-align: center; color: #6b7280;">
            <p>HiPrint æ˜ç»†é¡¹æµ‹è¯•å·¥å…· v1.0</p>
            <p>å¦‚ä»æœ‰é—®é¢˜ï¼Œè¯·æä¾› Console å®Œæ•´æ—¥å¿—æˆªå›¾</p>
        </div>
    </div>
</body>
</html>
